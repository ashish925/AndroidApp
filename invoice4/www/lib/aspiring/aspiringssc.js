var SocialCalc;if(!SocialCalc){alert("Main SocialCalc code module needed");SocialCalc={}}if(!SocialCalc.TableEditor){alert("SocialCalc TableEditor code module needed")}SocialCalc.CurrentSpreadsheetControlObject=null;SocialCalc.SpreadsheetControl=function(){var a=SocialCalc.Constants;this.parentNode=null;this.spreadsheetDiv=null;this.requestedHeight=0;this.requestedWidth=0;this.requestedSpaceBelow=0;this.height=0;this.width=0;this.viewheight=0;this.tabs=[];this.tabnums={};this.tabreplacements={};this.currentTab=-1;this.views={};this.sheet=null;this.context=null;this.editor=null;this.spreadsheetDiv=null;this.editorDiv=null;this.sortrange="";this.moverange="";this.idPrefix="SocialCalc-";this.multipartBoundary="SocialCalcSpreadsheetControlSave";this.imagePrefix=a.defaultImagePrefix;this.toolbarbackground=a.SCToolbarbackground;this.tabbackground=a.SCTabbackground;this.tabselectedCSS=a.SCTabselectedCSS;this.tabplainCSS=a.SCTabplainCSS;this.toolbartext=a.SCToolbartext;this.formulabarheight=a.SCFormulabarheight;if(a.doWorkBook){this.sheetbarheight=a.SCSheetBarHeight;this.sheetbarCSS=a.SCSheetBarCSS}else{this.sheetbarheight=0}this.statuslineheight=a.SCStatuslineheight;this.statuslineCSS=a.SCStatuslineCSS;this.ExportCallback=null;this.sheet=new SocialCalc.Sheet();this.context=new SocialCalc.RenderContext(this.sheet);this.context.showGrid=true;this.context.showRCHeaders=true;this.editor=new SocialCalc.TableEditor(this.context);this.editor.StatusCallback.statusline={func:SocialCalc.SpreadsheetControlStatuslineCallback,params:{statuslineid:this.idPrefix+"statusline",recalcid1:this.idPrefix+"divider_recalc",recalcid2:this.idPrefix+"button_recalc"}};SocialCalc.CurrentSpreadsheetControlObject=this;this.editor.MoveECellCallback.movefrom=function(c){var d;var b=SocialCalc.GetSpreadsheetControlObject();b.context.cursorsuffix="";if(c.range2.hasrange&&!c.cellhandles.noCursorSuffix){if(c.ecell.row==c.range2.top&&(c.ecell.col<c.range2.left||c.ecell.col>c.range2.right+1)){b.context.cursorsuffix="insertleft"}if(c.ecell.col==c.range2.left&&(c.ecell.row<c.range2.top||c.ecell.row>c.range2.bottom+1)){b.context.cursorsuffix="insertup"}}};this.formulabuttons={formulafunctions:{image:"formuladialog.gif",tooltip:"Functions",command:SocialCalc.SpreadsheetControl.DoFunctionList},multilineinput:{image:"multilinedialog.gif",tooltip:"Multi-line Input Box",command:SocialCalc.SpreadsheetControl.DoMultiline},link:{image:"linkdialog.gif",tooltip:"Link Input Box",command:SocialCalc.SpreadsheetControl.DoLink},sum:{image:"sumdialog.gif",tooltip:"Auto Sum",command:SocialCalc.SpreadsheetControl.DoSum},};this.tabnums.edit=this.tabs.length;this.tabs.push({name:"edit",text:"Edit",html:' <div id="%id.edittools" style="padding:10px 0px 0px 0px;">&nbsp;<img id="%id.button_undo" src="%img.undo.gif" style="vertical-align:bottom;"> <img id="%id.button_redo" src="%img.redo.gif" style="vertical-align:bottom;"> &nbsp;<img src="%img.divider1.gif" style="vertical-align:bottom;">&nbsp; <img id="%id.button_copy" src="%img.copy.gif" style="vertical-align:bottom;"> <img id="%id.button_cut" src="%img.cut.gif" style="vertical-align:bottom;"> <img id="%id.button_paste" src="%img.paste.gif" style="vertical-align:bottom;"> &nbsp;<img src="%img.divider1.gif" style="vertical-align:bottom;">&nbsp; <img id="%id.button_delete" src="%img.delete.gif" style="vertical-align:bottom;"> <img id="%id.button_pasteformats" src="%img.pasteformats.gif" style="vertical-align:bottom;"> &nbsp;<img src="%img.divider1.gif" style="vertical-align:bottom;">&nbsp; <img id="%id.button_filldown" src="%img.filldown.gif" style="vertical-align:bottom;"> <img id="%id.button_fillright" src="%img.fillright.gif" style="vertical-align:bottom;"> &nbsp;<img src="%img.divider1.gif" style="vertical-align:bottom;">&nbsp; <img id="%id.button_movefrom" src="%img.movefromoff.gif" style="vertical-align:bottom;"> <img id="%id.button_movepaste" src="%img.movepasteoff.gif" style="vertical-align:bottom;"> <img id="%id.button_moveinsert" src="%img.moveinsertoff.gif" style="vertical-align:bottom;"> &nbsp;<img src="%img.divider1.gif" style="vertical-align:bottom;">&nbsp; <img id="%id.button_alignleft" src="%img.alignleft.gif" style="vertical-align:bottom;"> <img id="%id.button_aligncenter" src="%img.aligncenter.gif" style="vertical-align:bottom;"> <img id="%id.button_alignright" src="%img.alignright.gif" style="vertical-align:bottom;"> &nbsp;<img src="%img.divider1.gif" style="vertical-align:bottom;">&nbsp; <img id="%id.button_borderon" src="%img.borderson.gif" style="vertical-align:bottom;">  <img id="%id.button_borderoff" src="%img.bordersoff.gif" style="vertical-align:bottom;">  <img id="%id.button_swapcolors" src="%img.swapcolors.gif" style="vertical-align:bottom;">  &nbsp;<img src="%img.divider1.gif" style="vertical-align:bottom;">&nbsp; <img id="%id.button_merge" src="%img.merge.gif" style="vertical-align:bottom;">  <img id="%id.button_unmerge" src="%img.unmerge.gif" style="vertical-align:bottom;">  &nbsp;<img src="%img.divider1.gif" style="vertical-align:bottom;">&nbsp; <img id="%id.button_insertrow" src="%img.insertrow.gif" style="vertical-align:bottom;">  <img id="%id.button_insertcol" src="%img.insertcol.gif" style="vertical-align:bottom;"> &nbsp; <img id="%id.button_deleterow" src="%img.deleterow.gif" style="vertical-align:bottom;">  <img id="%id.button_deletecol" src="%img.deletecol.gif" style="vertical-align:bottom;">  &nbsp;<img id="%id.divider_recalc" src="%img.divider1.gif" style="vertical-align:bottom;">&nbsp; <img id="%id.button_recalc" src="%img.recalc.gif" style="vertical-align:bottom;">  </div>',oncreate:null,onclick:null});this.tabnums.settings=this.tabs.length;this.tabs.push({name:"settings",text:"Format",html:'<div id="%id.settingstools" style="display:none;"> <div id="%id.sheetsettingstoolbar" style="display:none;">  <table cellspacing="0" cellpadding="0"><tr><td>   <div style="%tbt.">%loc!SHEET SETTINGS!:</div>   </td></tr><tr><td>   <input id="%id.settings-savesheet" type="button" value="%loc!Save!" onclick="SocialCalc.SettingsControlSave(\'sheet\');">   <input type="button" value="%loc!Cancel!" onclick="SocialCalc.SettingsControlSave(\'cancel\');">   <input type="button" value="%loc!Show Cell Settings!" onclick="SocialCalc.SpreadsheetControlSettingsSwitch(\'cell\');return false;">   </td></tr></table> </div> <div id="%id.cellsettingstoolbar" style="display:none;">  <table cellspacing="0" cellpadding="0"><tr><td>   <div style="%tbt.">%loc!CELL SETTINGS!: <span id="%id.settingsecell">&nbsp;</span></div>   </td></tr><tr><td>  <input id="%id.settings-savecell" type="button" value="%loc!Save!" onclick="SocialCalc.SettingsControlSave(\'cell\');">  <input type="button" value="%loc!Cancel!" onclick="SocialCalc.SettingsControlSave(\'cancel\');">  <input type="button" value="%loc!Show Sheet Settings!" onclick="SocialCalc.SpreadsheetControlSettingsSwitch(\'sheet\');return false;">  </td></tr></table> </div></div>',view:"settings",onclick:function(d,c){SocialCalc.SettingsControls.idPrefix=d.idPrefix;SocialCalc.SettingControlReset();var e=d.sheet.EncodeSheetAttributes();var f=d.sheet.EncodeCellAttributes(d.editor.ecell.coord);SocialCalc.SettingsControlLoadPanel(d.views.settings.values.sheetspanel,e);SocialCalc.SettingsControlLoadPanel(d.views.settings.values.cellspanel,f);document.getElementById(d.idPrefix+"settingsecell").innerHTML=d.editor.ecell.coord;SocialCalc.SpreadsheetControlSettingsSwitch("cell");d.views.settings.element.style.height=d.viewheight+"px";d.views.settings.element.firstChild.style.height=d.viewheight+"px";var b;if(d.editor.range.hasrange){b=SocialCalc.crToCoord(d.editor.range.left,d.editor.range.top)+":"+SocialCalc.crToCoord(d.editor.range.right,d.editor.range.bottom)}else{b=d.editor.ecell.coord}document.getElementById(d.idPrefix+"settings-savecell").value=SocialCalc.LocalizeString("Save to")+": "+b},onclickFocus:true});this.views.settings={name:"settings",values:{},oncreate:function(d,c){var b=SocialCalc.Constants;c.values.sheetspanel={colorchooser:{id:d.idPrefix+"scolorchooser"},formatnumber:{setting:"numberformat",type:"PopupList",id:d.idPrefix+"formatnumber",initialdata:b.SCFormatNumberFormats},formattext:{setting:"textformat",type:"PopupList",id:d.idPrefix+"formattext",initialdata:b.SCFormatTextFormats},fontfamily:{setting:"fontfamily",type:"PopupList",id:d.idPrefix+"fontfamily",initialdata:b.SCFormatFontfamilies},fontlook:{setting:"fontlook",type:"PopupList",id:d.idPrefix+"fontlook",initialdata:b.SCFormatFontlook},fontsize:{setting:"fontsize",type:"PopupList",id:d.idPrefix+"fontsize",initialdata:b.SCFormatFontsizes},textalignhoriz:{setting:"textalignhoriz",type:"PopupList",id:d.idPrefix+"textalignhoriz",initialdata:b.SCFormatTextAlignhoriz},numberalignhoriz:{setting:"numberalignhoriz",type:"PopupList",id:d.idPrefix+"numberalignhoriz",initialdata:b.SCFormatNumberAlignhoriz},alignvert:{setting:"alignvert",type:"PopupList",id:d.idPrefix+"alignvert",initialdata:b.SCFormatAlignVertical},textcolor:{setting:"textcolor",type:"ColorChooser",id:d.idPrefix+"textcolor"},bgcolor:{setting:"bgcolor",type:"ColorChooser",id:d.idPrefix+"bgcolor"},padtop:{setting:"padtop",type:"PopupList",id:d.idPrefix+"padtop",initialdata:b.SCFormatPadsizes},padright:{setting:"padright",type:"PopupList",id:d.idPrefix+"padright",initialdata:b.SCFormatPadsizes},padbottom:{setting:"padbottom",type:"PopupList",id:d.idPrefix+"padbottom",initialdata:b.SCFormatPadsizes},padleft:{setting:"padleft",type:"PopupList",id:d.idPrefix+"padleft",initialdata:b.SCFormatPadsizes},colwidth:{setting:"colwidth",type:"PopupList",id:d.idPrefix+"colwidth",initialdata:b.SCFormatColwidth},recalc:{setting:"recalc",type:"PopupList",id:d.idPrefix+"recalc",initialdata:b.SCFormatRecalc}};c.values.cellspanel={name:"cell",colorchooser:{id:d.idPrefix+"scolorchooser"},cformatnumber:{setting:"numberformat",type:"PopupList",id:d.idPrefix+"cformatnumber",initialdata:b.SCFormatNumberFormats},cformattext:{setting:"textformat",type:"PopupList",id:d.idPrefix+"cformattext",initialdata:b.SCFormatTextFormats},cfontfamily:{setting:"fontfamily",type:"PopupList",id:d.idPrefix+"cfontfamily",initialdata:b.SCFormatFontfamilies},cfontlook:{setting:"fontlook",type:"PopupList",id:d.idPrefix+"cfontlook",initialdata:b.SCFormatFontlook},cfontsize:{setting:"fontsize",type:"PopupList",id:d.idPrefix+"cfontsize",initialdata:b.SCFormatFontsizes},calignhoriz:{setting:"alignhoriz",type:"PopupList",id:d.idPrefix+"calignhoriz",initialdata:b.SCFormatTextAlignhoriz},calignvert:{setting:"alignvert",type:"PopupList",id:d.idPrefix+"calignvert",initialdata:b.SCFormatAlignVertical},ctextcolor:{setting:"textcolor",type:"ColorChooser",id:d.idPrefix+"ctextcolor"},cbgcolor:{setting:"bgcolor",type:"ColorChooser",id:d.idPrefix+"cbgcolor"},cbt:{setting:"bt",type:"BorderSide",id:d.idPrefix+"cbt"},cbr:{setting:"br",type:"BorderSide",id:d.idPrefix+"cbr"},cbb:{setting:"bb",type:"BorderSide",id:d.idPrefix+"cbb"},cbl:{setting:"bl",type:"BorderSide",id:d.idPrefix+"cbl"},cpadtop:{setting:"padtop",type:"PopupList",id:d.idPrefix+"cpadtop",initialdata:b.SCFormatPadsizes},cpadright:{setting:"padright",type:"PopupList",id:d.idPrefix+"cpadright",initialdata:b.SCFormatPadsizes},cpadbottom:{setting:"padbottom",type:"PopupList",id:d.idPrefix+"cpadbottom",initialdata:b.SCFormatPadsizes},cpadleft:{setting:"padleft",type:"PopupList",id:d.idPrefix+"cpadleft",initialdata:b.SCFormatPadsizes}};SocialCalc.SettingsControlInitializePanel(c.values.sheetspanel);SocialCalc.SettingsControlInitializePanel(c.values.cellspanel)},replacements:{itemtitle:{regex:/\%itemtitle\./g,replacement:'style="padding:12px 10px 0px 10px;font-weight:bold;text-align:right;vertical-align:top;font-size:small;"'},sectiontitle:{regex:/\%sectiontitle\./g,replacement:'style="padding:16px 10px 0px 0px;font-weight:bold;vertical-align:top;font-size:small;color:#C00;"'},parttitle:{regex:/\%parttitle\./g,replacement:'style="font-weight:bold;font-size:x-small;padding:0px 0px 3px 0px;"'},itembody:{regex:/\%itembody\./g,replacement:'style="padding:12px 0px 0px 0px;vertical-align:top;font-size:small;"'},bodypart:{regex:/\%bodypart\./g,replacement:'style="padding:0px 10px 0px 0px;font-size:small;vertical-align:top;"'}},divStyle:"border:1px solid black;overflow:auto;",html:'<div id="%id.scolorchooser" style="display:none;position:absolute;z-index:20;"></div><table cellspacing="0" cellpadding="0"> <tr><td style="vertical-align:top;"><table id="%id.sheetsettingstable" style="display:none;" cellspacing="0" cellpadding="0"><tr> <td %itemtitle.><br>%loc!Default Format!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0"><tr>    <td %bodypart.>     <div %parttitle.>%loc!Number!</div>     <span id="%id.formatnumber"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Text!</div>     <span id="%id.formattext"></span>    </td>   </tr></table> </td></tr><tr> <td %itemtitle.><br>%loc!Default Alignment!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0"><tr>    <td %bodypart.>     <div %parttitle.>%loc!Text Horizontal!</div>     <span id="%id.textalignhoriz"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Number Horizontal!</div>     <span id="%id.numberalignhoriz"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Vertical!</div>     <span id="%id.alignvert"></span>    </td>   </tr></table> </td></tr><tr> <td %itemtitle.><br>%loc!Default Font!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0"><tr>    <td %bodypart.>     <div %parttitle.>%loc!Family!</div>     <span id="%id.fontfamily"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Bold &amp; Italics!</div>     <span id="%id.fontlook"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Size!</div>     <span id="%id.fontsize"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Color!</div>     <div id="%id.textcolor"></div>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Background!</div>     <div id="%id.bgcolor"></div>    </td>   </tr></table> </td></tr><tr> <td %itemtitle.><br>%loc!Default Padding!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0"><tr>    <td %bodypart.>     <div %parttitle.>%loc!Top!</div>     <span id="%id.padtop"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Right!</div>     <span id="%id.padright"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Bottom!</div>     <span id="%id.padbottom"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Left!</div>     <span id="%id.padleft"></span>    </td>   </tr></table> </td></tr><tr> <td %itemtitle.><br>%loc!Default Column Width!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0"><tr>    <td %bodypart.>     <div %parttitle.>&nbsp;</div>     <span id="%id.colwidth"></span>    </td>   </tr></table> </td></tr><tr> <td %itemtitle.><br>%loc!Recalculation!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0"><tr>    <td %bodypart.>     <div %parttitle.>&nbsp;</div>     <span id="%id.recalc"></span>    </td>   </tr></table> </td></tr></table><table id="%id.cellsettingstable" cellspacing="0" cellpadding="0"><tr> <td %itemtitle.><br>%loc!Format!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0"><tr>    <td %bodypart.>     <div %parttitle.>%loc!Number!</div>     <span id="%id.cformatnumber"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Text!</div>     <span id="%id.cformattext"></span>    </td>   </tr></table> </td></tr><tr> <td %itemtitle.><br>%loc!Alignment!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0"><tr>    <td %bodypart.>     <div %parttitle.>%loc!Horizontal!</div>     <span id="%id.calignhoriz"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Vertical!</div>     <span id="%id.calignvert"></span>    </td>   </tr></table> </td></tr><tr> <td %itemtitle.><br>%loc!Font!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0"><tr>    <td %bodypart.>     <div %parttitle.>%loc!Family!</div>     <span id="%id.cfontfamily"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Bold &amp; Italics!</div>     <span id="%id.cfontlook"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Size!</div>     <span id="%id.cfontsize"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Color!</div>     <div id="%id.ctextcolor"></div>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Background!</div>     <div id="%id.cbgcolor"></div>    </td>   </tr></table> </td></tr><tr> <td %itemtitle.><br>%loc!Borders!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0">    <tr><td %bodypart. colspan="3"><div %parttitle.>%loc!Top Border!</div></td>     <td %bodypart. colspan="3"><div %parttitle.>%loc!Right Border!</div></td>     <td %bodypart. colspan="3"><div %parttitle.>%loc!Bottom Border!</div></td>     <td %bodypart. colspan="3"><div %parttitle.>%loc!Left Border!</div></td>    </tr><tr>    <td %bodypart.>     <input id="%id.cbt-onoff-bcb" onclick="SocialCalc.SettingsControlOnchangeBorder(this);" type="checkbox">    </td>    <td %bodypart.>     <div id="%id.cbt-color"></div>    </td>    <td>&nbsp;&nbsp;&nbsp;&nbsp;</td>    <td %bodypart.>     <input id="%id.cbr-onoff-bcb" onclick="SocialCalc.SettingsControlOnchangeBorder(this);" type="checkbox">    </td>    <td %bodypart.>     <div id="%id.cbr-color"></div>    </td>    <td>&nbsp;&nbsp;&nbsp;&nbsp;</td>    <td %bodypart.>     <input id="%id.cbb-onoff-bcb" onclick="SocialCalc.SettingsControlOnchangeBorder(this);" type="checkbox">    </td>    <td %bodypart.>     <div id="%id.cbb-color"></div>    </td>    <td>&nbsp;&nbsp;&nbsp;&nbsp;</td>    <td %bodypart.>     <input id="%id.cbl-onoff-bcb" onclick="SocialCalc.SettingsControlOnchangeBorder(this);" type="checkbox">    </td>    <td %bodypart.>     <div id="%id.cbl-color"></div>    </td>    <td>&nbsp;&nbsp;&nbsp;&nbsp;</td>   </tr></table> </td></tr><tr> <td %itemtitle.><br>%loc!Padding!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0"><tr>    <td %bodypart.>     <div %parttitle.>%loc!Top!</div>     <span id="%id.cpadtop"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Right!</div>     <span id="%id.cpadright"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Bottom!</div>     <span id="%id.cpadbottom"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Left!</div>     <span id="%id.cpadleft"></span>    </td>   </tr></table> </td></tr></table> </td><td style="vertical-align:top;padding:12px 0px 0px 12px;">  <div style="width:100px;height:100px;overflow:hidden;border:1px solid black;background-color:#EEE;padding:6px;">   <table cellspacing="0" cellpadding="0"><tr>    <td id="sample-text" style="height:100px;width:100px;"><div>%loc!This is a<br>sample!</div><div>-1234.5</div></td>   </tr></table>  </div> </td></tr></table><br>'};this.tabnums.sort=this.tabs.length;this.tabs.push({name:"sort",text:"Sort",html:' <div id="%id.sorttools" style="display:none;">  <table cellspacing="0" cellpadding="0"><tr>   <td style="vertical-align:top;padding-right:4px;width:160px;">    <div style="%tbt.">%loc!Set Cells To Sort!</div>    <select id="%id.sortlist" size="1" onfocus="%s.CmdGotFocus(this);"><option selected>[select range]</option></select>    <input type="button" value="%loc!OK!" onclick="%s.DoCmd(this, \'ok-setsort\');" style="font-size:x-small;">   </td>   <td style="vertical-align:middle;padding-right:16px;width:100px;text-align:right;">    <div style="%tbt.">&nbsp;</div>    <input type="button" id="%id.sortbutton" value="%loc!Sort Cells! A1:A1" onclick="%s.DoCmd(this, \'dosort\');" style="visibility:hidden;">   </td>   <td style="vertical-align:top;padding-right:16px;">    <table cellspacing="0" cellpadding="0"><tr>     <td style="vertical-align:top;">      <div style="%tbt.">%loc!Major Sort!</div>      <select id="%id.majorsort" size="1" onfocus="%s.CmdGotFocus(this);"></select>     </td><td>      <input type="radio" name="majorsort" id="%id.majorsortup" value="up" checked><span style="font-size:x-small;color:#FFF;">%loc!Up!</span><br>      <input type="radio" name="majorsort" id="%id.majorsortdown" value="down"><span style="font-size:x-small;color:#FFF;">%loc!Down!</span>     </td>    </tr></table>   </td>   <td style="vertical-align:top;padding-right:16px;">    <table cellspacing="0" cellpadding="0"><tr>     <td style="vertical-align:top;">      <div style="%tbt.">%loc!Minor Sort!</div>      <select id="%id.minorsort" size="1" onfocus="%s.CmdGotFocus(this);"></select>     </td><td>      <input type="radio" name="minorsort" id="%id.minorsortup" value="up" checked><span style="font-size:x-small;color:#FFF;">%loc!Up!</span><br>      <input type="radio" name="minorsort" id="%id.minorsortdown" value="down"><span style="font-size:x-small;color:#FFF;">%loc!Down!</span>     </td>    </tr></table>   </td>   <td style="vertical-align:top;padding-right:16px;">    <table cellspacing="0" cellpadding="0"><tr>     <td style="vertical-align:top;">      <div style="%tbt.">%loc!Last Sort!</div>      <select id="%id.lastsort" size="1" onfocus="%s.CmdGotFocus(this);"></select>     </td><td>      <input type="radio" name="lastsort" id="%id.lastsortup" value="up" checked><span style="font-size:x-small;color:#FFF;">%loc!Up!</span><br>      <input type="radio" name="lastsort" id="%id.lastsortdown" value="down"><span style="font-size:x-small;color:#FFF;">%loc!Down!</span>     </td>    </tr></table>   </td>  </tr></table> </div>',onclick:SocialCalc.SpreadsheetControlSortOnclick});this.editor.SettingsCallbacks.sort={save:SocialCalc.SpreadsheetControlSortSave,load:SocialCalc.SpreadsheetControlSortLoad};this.tabnums.audit=this.tabs.length;this.tabs.push({name:"audit",text:"Audit",html:'<div id="%id.audittools" style="display:none;"> <div style="%tbt.">&nbsp;</div></div>',view:"audit",onclick:function(h,e){var g=SocialCalc.LocalizeString;var d,c;var k='<table cellspacing="0" cellpadding="0" style="margin-bottom:10px;"><tr><td style="font-size:small;padding:6px;"><b>'+g("Audit Trail This Session")+":</b><br><br>";var b=h.sheet.changes.stack;var f=h.sheet.changes.tos;for(d=0;d<b.length;d++){if(d==f+1){k+='<br></td></tr><tr><td style="font-size:small;background-color:#EEE;padding:6px;">'+g("UNDONE STEPS")+":<br>"}for(c=0;c<b[d].command.length;c++){k+=SocialCalc.special_chars(b[d].command[c])+"<br>"}}h.views.audit.element.innerHTML=k+"</td></tr></table>";SocialCalc.CmdGotFocus(true)},onclickFocus:true});this.views.audit={name:"audit",divStyle:"border:1px solid black;overflow:auto;",html:"Audit Trail"};this.tabnums.comment=this.tabs.length;this.tabs.push({name:"comment",text:"Comment",html:'<div id="%id.commenttools" style="display:none;"><table cellspacing="0" cellpadding="0"><tr><td><textarea id="%id.commenttext" style="font-size:small;height:32px;width:600px;overflow:auto;" onfocus="%s.CmdGotFocus(this);"></textarea></td><td style="vertical-align:top;">&nbsp;<input type="button" value="%loc!Save!" onclick="%s.SpreadsheetControlCommentSet();" style="font-size:x-small;"></td></tr></table></div>',view:"sheet",onclick:SocialCalc.SpreadsheetControlCommentOnclick,onunclick:SocialCalc.SpreadsheetControlCommentOnunclick});this.tabnums.names=this.tabs.length;this.tabs.push({name:"names",text:"Names",html:'<div id="%id.namestools" style="display:none;">  <table cellspacing="0" cellpadding="0"><tr>   <td style="vertical-align:top;padding-right:24px;">    <div style="%tbt.">%loc!Existing Names!</div>    <select id="%id.nameslist" size="1" onchange="%s.SpreadsheetControlNamesChangedName();" onfocus="%s.CmdGotFocus(this);"><option selected>[New]</option></select>   </td>   <td style="vertical-align:top;padding-right:6px;">    <div style="%tbt.">%loc!Name!</div>    <input type="text" id="%id.namesname" style="font-size:x-small;width:75px;" onfocus="%s.CmdGotFocus(this);">   </td>   <td style="vertical-align:top;padding-right:6px;">    <div style="%tbt.">%loc!Description!</div>    <input type="text" id="%id.namesdesc" style="font-size:x-small;width:150px;" onfocus="%s.CmdGotFocus(this);">   </td>   <td style="vertical-align:top;padding-right:6px;">    <div style="%tbt.">%loc!Value!</div>    <input type="text" id="%id.namesvalue" width="16" style="font-size:x-small;width:100px;" onfocus="%s.CmdGotFocus(this);">   </td>   <td style="vertical-align:top;padding-right:12px;width:100px;">    <div style="%tbt.">%loc!Set Value To!</div>    <input type="button" id="%id.namesrangeproposal" value="A1" onclick="%s.SpreadsheetControlNamesSetValue();" style="font-size:x-small;">   </td>   <td style="vertical-align:top;padding-right:6px;">    <div style="%tbt.">&nbsp;</div>    <input type="button" value="%loc!Save!" onclick="%s.SpreadsheetControlNamesSave();" style="font-size:x-small;">    <input type="button" value="%loc!Delete!" onclick="%s.SpreadsheetControlNamesDelete()" style="font-size:x-small;">   </td>  </tr></table></div>',view:"sheet",onclick:SocialCalc.SpreadsheetControlNamesOnclick,onunclick:SocialCalc.SpreadsheetControlNamesOnunclick});this.tabnums.clipboard=this.tabs.length;this.tabs.push({name:"clipboard",text:"Clipboard",html:'<div id="%id.clipboardtools" style="display:none;">  <table cellspacing="0" cellpadding="0"><tr>   <td style="vertical-align:top;padding-right:24px;">    <div style="%tbt.">     &nbsp;    </div>   </td>  </tr></table></div>',view:"clipboard",onclick:SocialCalc.SpreadsheetControlClipboardOnclick,onclickFocus:"clipboardtext"});this.views.clipboard={name:"clipboard",divStyle:"overflow:auto;",html:' <div style="font-size:x-small;padding:5px 0px 10px 0px;">  <b>%loc!Display Clipboard in!:</b>  <input type="radio" id="%id.clipboardformat-tab" name="%id.clipboardformat" checked onclick="%s.SpreadsheetControlClipboardFormat(\'tab\');"> %loc!Tab-delimited format! &nbsp;  <input type="radio" id="%id.clipboardformat-csv" name="%id.clipboardformat" onclick="%s.SpreadsheetControlClipboardFormat(\'csv\');"> %loc!CSV format! &nbsp;  <input type="radio" id="%id.clipboardformat-scsave" name="%id.clipboardformat" onclick="%s.SpreadsheetControlClipboardFormat(\'scsave\');"> %loc!SocialCalc-save format! </div> <input type="button" value="%loc!Load SocialCalc Clipboard With This!" style="font-size:x-small;" onclick="%s.SpreadsheetControlClipboardLoad();">&nbsp;  <input type="button" value="%loc!Clear SocialCalc Clipboard!" style="font-size:x-small;" onclick="%s.SpreadsheetControlClipboardClear();">&nbsp;  <br> <textarea id="%id.clipboardtext" style="font-size:small;height:350px;width:800px;overflow:auto;" onfocus="%s.CmdGotFocus(this);"></textarea>'};return};SocialCalc.SpreadsheetControl.prototype.InitializeSpreadsheetControl=function(c,a,b,d){return SocialCalc.InitializeSpreadsheetControl(this,c,a,b,d)};SocialCalc.SpreadsheetControl.prototype.DoOnResize=function(){return SocialCalc.DoOnResize(this)};SocialCalc.SpreadsheetControl.prototype.SizeSSDiv=function(){return SocialCalc.SizeSSDiv(this)};SocialCalc.SpreadsheetControl.prototype.ExecuteCommand=function(a,b){return SocialCalc.SpreadsheetControlExecuteCommand(this,a,b)};SocialCalc.SpreadsheetControl.prototype.CreateSheetHTML=function(){return SocialCalc.SpreadsheetControlCreateSheetHTML(this)};SocialCalc.SpreadsheetControl.prototype.CreateSpreadsheetSave=function(a){return SocialCalc.SpreadsheetControlCreateSpreadsheetSave(this,a)};SocialCalc.SpreadsheetControl.prototype.DecodeSpreadsheetSave=function(a){return SocialCalc.SpreadsheetControlDecodeSpreadsheetSave(this,a)};SocialCalc.SpreadsheetControl.prototype.CreateCellHTML=function(a){return SocialCalc.SpreadsheetControlCreateCellHTML(this,a)};SocialCalc.SpreadsheetControl.prototype.CreateCellHTMLSave=function(a){return SocialCalc.SpreadsheetControlCreateCellHTMLSave(this,a)};SocialCalc.SpreadsheetControl.prototype.ParseSheetSave=function(a){return this.sheet.ParseSheetSave(a)};SocialCalc.SpreadsheetControl.prototype.CreateSheetSave=function(){return this.sheet.CreateSheetSave()};SocialCalc.InitializeSpreadsheetControl=function(d,m,k,l,p){var c=SocialCalc.Constants;var s=SocialCalc.LocalizeString;var f=SocialCalc.LocalizeSubstrings;var h,e,n,q,j,o,a,b;var r=d.tabs;var g=d.views;d.requestedHeight=k;d.requestedWidth=l;d.requestedSpaceBelow=p;if(typeof m=="string"){m=document.getElementById(m)}if(m==null){alert("SocialCalc.SpreadsheetControl not given parent node.")}d.parentNode=m;d.spreadsheetDiv=document.createElement("div");d.SizeSSDiv();for(e=m.firstChild;e!=null;e=m.firstChild){m.removeChild(e)}h='<div><div style="'+d.toolbarbackground+'padding:12px 10px 10px 4px;height:40px;display:none;">';for(n=0;n<r.length;n++){h+=r[n].html}h+='</div><div style="'+d.tabbackground+'padding-bottom:4px;margin:0px 0px 8px 0px;display:none;"><table cellpadding="0" cellspacing="0"><tr>';for(n=0;n<r.length;n++){h+='  <td id="%id.'+r[n].name+'tab" style="'+(n==0?d.tabselectedCSS:d.tabplainCSS)+'" onclick="%s.SetTab(this);">'+s(r[n].text)+"</td>"}h+=" </tr></table></div></div>";d.currentTab=0;for(o in d.tabreplacements){h=h.replace(d.tabreplacements[o].regex,d.tabreplacements[o].replacement)}h=h.replace(/\%s\./g,"SocialCalc.");h=h.replace(/\%id\./g,d.idPrefix);h=h.replace(/\%tbt\./g,d.toolbartext);h=h.replace(/\%img\./g,d.imagePrefix);h=f(h);d.spreadsheetDiv.innerHTML=h;m.appendChild(d.spreadsheetDiv);d.Buttons={button_undo:{tooltip:"Undo",command:"undo"},button_redo:{tooltip:"Redo",command:"redo"},button_copy:{tooltip:"Copy",command:"copy"},button_cut:{tooltip:"Cut",command:"cut"},button_paste:{tooltip:"Paste",command:"paste"},button_pasteformats:{tooltip:"Paste Formats",command:"pasteformats"},button_delete:{tooltip:"Delete Contents",command:"delete"},button_filldown:{tooltip:"Fill Down",command:"filldown"},button_fillright:{tooltip:"Fill Right",command:"fillright"},button_movefrom:{tooltip:"Set/Clear Move From",command:"movefrom"},button_movepaste:{tooltip:"Move Paste",command:"movepaste"},button_moveinsert:{tooltip:"Move Insert",command:"moveinsert"},button_alignleft:{tooltip:"Align Left",command:"align-left"},button_aligncenter:{tooltip:"Align Center",command:"align-center"},button_alignright:{tooltip:"Align Right",command:"align-right"},button_borderon:{tooltip:"Borders On",command:"borderon"},button_borderoff:{tooltip:"Borders Off",command:"borderoff"},button_swapcolors:{tooltip:"Swap Colors",command:"swapcolors"},button_merge:{tooltip:"Merge Cells",command:"merge"},button_unmerge:{tooltip:"Unmerge Cells",command:"unmerge"},button_insertrow:{tooltip:"Insert Row",command:"insertrow"},button_insertcol:{tooltip:"Insert Column",command:"insertcol"},button_deleterow:{tooltip:"Delete Row",command:"deleterow"},button_deletecol:{tooltip:"Delete Column",command:"deletecol"},button_recalc:{tooltip:"Recalc",command:"recalc"}};for(a in d.Buttons){b=document.getElementById(d.idPrefix+a);if(!b){continue}b.style.border="1px solid "+c.ISCButtonBorderNormal;SocialCalc.TooltipRegister(b,s(d.Buttons[a].tooltip),{});SocialCalc.ButtonRegister(b,{normalstyle:"border:1px solid "+c.ISCButtonBorderNormal+";backgroundColor:"+c.ISCButtonBorderNormal+";",hoverstyle:"border:1px solid "+c.ISCButtonBorderHover+";backgroundColor:"+c.ISCButtonBorderNormal+";",downstyle:"border:1px solid "+c.ISCButtonBorderDown+";backgroundColor:"+c.ISCButtonDownBackground+";"},{MouseDown:SocialCalc.DoButtonCmd,command:d.Buttons[a].command})}d.dummyFormulaDiv=document.createElement("div");d.dummyFormulaDiv.style.height=d.formulabarheight+"px";d.spreadsheetDiv.appendChild(d.dummyFormulaDiv);d.formulabarDiv=document.createElement("div");d.formulabarDiv.id="formulabardiv";d.formulabarDiv.style.height=d.formulabarheight+"px";d.formulabarDiv.innerHTML='<input type="text" size="20" value="" disabled="true">';var t=new SocialCalc.InputBox(d.formulabarDiv.firstChild,d.editor);b=document.createElement("img");b.id="testtest";b.src="lib/aspiring/images/delete24.png";b.style.verticalAlign="middle";b.style.display="none";SocialCalc.ButtonRegister(b,{normalstyle:"",hoverstyle:"",downstyle:""},{MouseDown:SocialCalc.InputLineClearText});d.formulabarDiv.appendChild(b);for(n=0;n<r.length;n++){if(r[n].oncreate){r[n].oncreate(d,r[n].name)}}if(!c.doWorkBook){d.nonviewheight=d.statuslineheight+d.spreadsheetDiv.firstChild.offsetHeight+d.spreadsheetDiv.lastChild.offsetHeight}else{d.nonviewheight=28+d.sheetbarheight+d.spreadsheetDiv.firstChild.offsetHeight+d.spreadsheetDiv.lastChild.offsetHeight}d.viewheight=d.height-d.nonviewheight;d.editorDiv=d.editor.CreateTableEditor(d.width,d.viewheight);d.spreadsheetDiv.appendChild(d.editorDiv);for(q in g){h=g[q].html;for(o in g[q].replacements){h=h.replace(g[q].replacements[o].regex,g[q].replacements[o].replacement)}h=h.replace(/\%s\./g,"SocialCalc.");h=h.replace(/\%id\./g,d.idPrefix);h=h.replace(/\%tbt\./g,d.toolbartext);h=h.replace(/\%img\./g,d.imagePrefix);j=document.createElement("div");SocialCalc.setStyles(j,g[q].divStyle);j.style.display="none";j.style.width=d.width+"px";j.style.height=d.viewheight+"px";h=f(h);j.innerHTML=h;d.spreadsheetDiv.appendChild(j);g[q].element=j;if(g[q].oncreate){g[q].oncreate(d,g[q])}}g.sheet={name:"sheet",element:d.editorDiv};if(!c.doWorkBook){d.statuslineDiv=document.createElement("div");d.statuslineDiv.style.cssText=d.statuslineCSS;d.statuslineDiv.style.height=d.statuslineheight-(d.statuslineDiv.style.paddingTop.slice(0,-2)-0)-(d.statuslineDiv.style.paddingBottom.slice(0,-2)-0)+"px";d.statuslineDiv.id=d.idPrefix+"statusline";d.spreadsheetDiv.appendChild(d.statuslineDiv)}else{SocialCalc.CreateSheetStatusBar(d,c)}return};SocialCalc.CreateSheetStatusBar=function(a,b){if(!b.doWorkBook){return}a.sheetstatusbarDiv=document.createElement("div");a.sheetstatusbarDiv.style.height=a.sheetbarheight+3+"px";a.sheetstatusbarDiv.style.backgroundColor="#CCC";a.sheetstatusbarDiv.id=a.idPrefix+"sheetstatusbar";a.sheetbarDiv=document.createElement("div");a.sheetbarDiv.id=a.idPrefix+"sheetbar";a.statuslineDiv=document.createElement("div");a.statuslineDiv.style.cssText=a.statuslineCSS;a.statuslineDiv.id=a.idPrefix+"statusline";var d=document.createElement("table");a.sheetstatusbartable=d;d.cellSpacing=0;d.cellPadding=0;d.width="100%";var c=document.createElement("tbody");d.appendChild(c);var e=document.createElement("tr");c.appendChild(e);var f=document.createElement("td");f.appendChild(a.sheetbarDiv);f.width=b.SCSheetBarWidth;e.appendChild(f);f=document.createElement("td");f.innerHTML="<span>&nbsp|&nbsp</span>";f.width="1%";e.appendChild(f);f=document.createElement("td");f.appendChild(a.statuslineDiv);e.appendChild(f);a.sheetstatusbarDiv.appendChild(d);a.spreadsheetDiv.appendChild(a.sheetstatusbarDiv);a.sheetstatusbarDiv.style.display="none"};SocialCalc.LocalizeString=function(b){var a=SocialCalc.LocalizeStringList[b];if(!a){a=SocialCalc.Constants["s_loc_"+b.toLowerCase().replace(/\s/g,"_").replace(/\W/g,"X")]||b;SocialCalc.LocalizeStringList[b]=a}return a};SocialCalc.LocalizeStringList={};SocialCalc.LocalizeSubstrings=function(b){var a=SocialCalc.LocalizeString;return b.replace(/%(loc|ssc)!(.*?)!/g,function(d,e,f){if(e=="ssc"){return SocialCalc.Constants[f]||alert("Missing constant: "+f)}else{return a(f)}})};SocialCalc.GetSpreadsheetControlObject=function(){var a=SocialCalc.CurrentSpreadsheetControlObject;if(a){return a}};SocialCalc.DoOnResize=function(a){var c;var b=a.views;var d=a.SizeSSDiv();if(!d){return}for(vname in b){c=b[vname].element;c.style.width=a.width+"px";c.style.height=(a.height-a.nonviewheight)+"px"}a.editor.ResizeTableEditor(a.width,a.height-a.nonviewheight)};SocialCalc.SizeSSDiv=function(a){var f,h,c,e,g;var d=10;var b=10;c=false;f=SocialCalc.GetViewportInfo();h=SocialCalc.GetElementPosition(a.parentNode);h.bottom=0;h.right=0;e=a.parentNode.style;if(e.marginTop){h.top+=e.marginTop.slice(0,-2)-0}if(e.marginBottom){h.bottom+=e.marginBottom.slice(0,-2)-0}if(e.marginLeft){h.left+=e.marginLeft.slice(0,-2)-0}if(e.marginRight){h.right+=e.marginRight.slice(0,-2)-0}g=a.requestedHeight||f.height-(h.top+h.bottom+b)-(a.requestedSpaceBelow||0);if(a.height!=g){a.height=g;a.spreadsheetDiv.style.height=g+"px";c=true}g=a.requestedWidth||f.width-(h.left+h.right+d)||700;if(a.width!=g){a.width=g;a.spreadsheetDiv.style.width=g+"px";c=true}return c};SocialCalc.SetTab=function(d){var a,n,c,l,e,j,m;var f={};var g={};var b=SocialCalc.GetSpreadsheetControlObject();var h=b.tabs;var k=b.views;if(typeof d=="string"){a=d}else{a=d.id.slice(b.idPrefix.length,-3)}if(b.editor.busy&&(!h[b.currentTab].view||h[b.currentTab].view=="sheet")){for(e=0;e<h.length;e++){if(h[e].name==a&&(h[e].view&&h[e].view!="sheet")){return}}}if(b.tabs[b.currentTab].onunclick){b.tabs[b.currentTab].onunclick(b,b.tabs[b.currentTab].name)}for(e=0;e<h.length;e++){n=h[e].name;f[n]=document.getElementById(b.idPrefix+n+"tab");g[n]=document.getElementById(b.idPrefix+n+"tools");if(n==a){c=e;g[n].style.display="block";f[n].style.cssText=b.tabselectedCSS}else{g[n].style.display="none";f[n].style.cssText=b.tabplainCSS}}b.currentTab=c;if(h[c].onclick){h[c].onclick(b,a)}for(j in k){if((!h[c].view&&j=="sheet")||h[c].view==j){k[j].element.style.display="block";l=j}else{k[j].element.style.display="none"}}if(h[c].onclickFocus){m=h[c].onclickFocus;if(typeof m=="string"){m=document.getElementById(b.idPrefix+m);m.focus()}SocialCalc.CmdGotFocus(m)}else{SocialCalc.KeyboardFocus()}if(k[l].needsresize&&k[l].onresize){k[l].needsresize=false;k[l].onresize(b,k[l])}if(l=="sheet"){b.statuslineDiv.style.display="block";b.editor.ScheduleRender()}else{b.statuslineDiv.style.display="none"}return};SocialCalc.SpreadsheetControlStatuslineCallback=function(e,c,a,g){var d,b;var f=document.getElementById(g.statuslineid);if(f){f.innerHTML=e.GetStatuslineString(c,a,g)}switch(c){case"cmdendnorender":case"calcfinished":case"doneposcalc":d=document.getElementById(g.recalcid1);b=document.getElementById(g.recalcid2);if(!d||!b){break}if(e.context.sheetobj.attribs.needsrecalc=="yes"){d.style.display="inline";b.style.display="inline"}else{d.style.display="none";b.style.display="none"}break;default:break}};SocialCalc.UpdateSortRangeProposal=function(a){var b=document.getElementById(SocialCalc.GetSpreadsheetControlObject().idPrefix+"sortlist");if(a.range.hasrange){b.options[0].text=SocialCalc.crToCoord(a.range.left,a.range.top)+":"+SocialCalc.crToCoord(a.range.right,a.range.bottom)}else{b.options[0].text=SocialCalc.LocalizeString("[select range]")}};SocialCalc.LoadColumnChoosers=function(a){var h=SocialCalc.LocalizeString;var g,b,d,c,f,j,i;if(a.sortrange&&a.sortrange.indexOf(":")==-1){b=SocialCalc.Formula.LookupName(a.sheet,a.sortrange||"");if(b.type=="range"){d=b.value.match(/^(.*)\|(.*)\|$/);g=d[1]+":"+d[2]}else{g="A1:A1"}}else{g=a.sortrange}var e=SocialCalc.ParseRange(g);j=document.getElementById(a.idPrefix+"majorsort");i=j.selectedIndex;j.options.length=0;j.options[j.options.length]=new Option(h("[None]"),"");for(var c=e.cr1.col;c<=e.cr2.col;c++){f=SocialCalc.rcColname(c);j.options[j.options.length]=new Option(h("Column ")+f,f)}j.selectedIndex=i>1&&i<=(e.cr2.col-e.cr1.col+1)?i:1;j=document.getElementById(a.idPrefix+"minorsort");i=j.selectedIndex;j.options.length=0;j.options[j.options.length]=new Option(h("[None]"),"");for(var c=e.cr1.col;c<=e.cr2.col;c++){f=SocialCalc.rcColname(c);j.options[j.options.length]=new Option(f,f)}j.selectedIndex=i>0&&i<=(e.cr2.col-e.cr1.col+1)?i:0;j=document.getElementById(a.idPrefix+"lastsort");i=j.selectedIndex;j.options.length=0;j.options[j.options.length]=new Option(h("[None]"),"");for(var c=e.cr1.col;c<=e.cr2.col;c++){f=SocialCalc.rcColname(c);j.options[j.options.length]=new Option(f,f)}j.selectedIndex=i>0&&i<=(e.cr2.col-e.cr1.col+1)?i:0};SocialCalc.CmdGotFocus=function(a){SocialCalc.Keyboard.passThru=a};SocialCalc.DoButtonCmd=function(c,b,a){SocialCalc.DoCmd(a.element,a.functionobj.command)};SocialCalc.DoCmd=function(m,l){var z,x,g,w,t,y,n,u,q,h,o,k,r,b,s;var e,c,v,a,j,p;var f=SocialCalc.GetSpreadsheetControlObject();var d=f.editor;switch(l){case"undo":f.ExecuteCommand("undo","");break;case"redo":f.ExecuteCommand("redo","");break;case"fill-rowcolstuff":case"fill-text":g=l.substring(5);t=document.getElementById(f.idPrefix+g+"list");t.length=0;for(w=0;w<SocialCalc.SpreadsheetCmdTable[g].length;w++){t.options[w]=new Option(SocialCalc.SpreadsheetCmdTable[g][w].t)}l="changed-"+g;case"changed-rowcolstuff":case"changed-text":g=l.substring(8);t=document.getElementById(f.idPrefix+g+"list");y=SocialCalc.SpreadsheetCmdTable.slists[SocialCalc.SpreadsheetCmdTable[g][t.selectedIndex].s];n=document.getElementById(f.idPrefix+g+"slist");n.length=0;for(w=0;w<(y.length||0);w++){n.options[w]=new Option(y[w].t,y[w].s)}return;case"ok-rowcolstuff":case"ok-text":g=l.substring(3);t=document.getElementById(f.idPrefix+g+"list");n=document.getElementById(f.idPrefix+g+"slist");z=SocialCalc.SpreadsheetCmdTable[g][t.selectedIndex].c;x=n[n.selectedIndex].value;SocialCalc.SpreadsheetControlExecuteCommand(m,z,x);break;case"ok-setsort":o=document.getElementById(f.idPrefix+"sortlist");if(o.selectedIndex==0){if(d.range.hasrange){f.sortrange=SocialCalc.crToCoord(d.range.left,d.range.top)+":"+SocialCalc.crToCoord(d.range.right,d.range.bottom)}else{f.sortrange=d.ecell.coord+":"+d.ecell.coord}}else{f.sortrange=o.options[o.selectedIndex].value}k=document.getElementById(f.idPrefix+"sortbutton");k.value=SocialCalc.LocalizeString("Sort ")+f.sortrange;k.style.visibility="visible";SocialCalc.LoadColumnChoosers(f);if(m&&m.blur){m.blur()}SocialCalc.KeyboardFocus();return;case"dosort":if(f.sortrange&&f.sortrange.indexOf(":")==-1){b=SocialCalc.Formula.LookupName(f.sheet,f.sortrange||"");if(b.type!="range"){return}s=b.value.match(/^(.*)\|(.*)\|$/);r=s[1]+":"+s[2]}else{r=f.sortrange}if(r=="A1:A1"){return}u="sort "+r+" ";q=document.getElementById(f.idPrefix+"majorsort");h=document.getElementById(f.idPrefix+"majorsortup");u+=q.options[q.selectedIndex].value+(h.checked?" up":" down");q=document.getElementById(f.idPrefix+"minorsort");if(q.selectedIndex>0){h=document.getElementById(f.idPrefix+"minorsortup");u+=" "+q.options[q.selectedIndex].value+(h.checked?" up":" down")}q=document.getElementById(f.idPrefix+"lastsort");if(q.selectedIndex>0){h=document.getElementById(f.idPrefix+"lastsortup");u+=" "+q.options[q.selectedIndex].value+(h.checked?" up":" down")}f.ExecuteCommand(u,"");break;case"merge":z=SocialCalc.SpreadsheetCmdLookup[l]||"";x=SocialCalc.SpreadsheetCmdSLookup[l]||"";f.ExecuteCommand(z,x);if(d.range.hasrange){d.MoveECell(SocialCalc.crToCoord(d.range.left,d.range.top));d.RangeRemove()}break;case"movefrom":if(d.range2.hasrange){f.context.cursorsuffix="";d.Range2Remove();f.ExecuteCommand("redisplay","")}else{if(d.range.hasrange){d.range2.top=d.range.top;d.range2.right=d.range.right;d.range2.bottom=d.range.bottom;d.range2.left=d.range.left;d.range2.hasrange=true;d.MoveECell(SocialCalc.crToCoord(d.range.left,d.range.top))}else{d.range2.top=d.ecell.row;d.range2.right=d.ecell.col;d.range2.bottom=d.ecell.row;d.range2.left=d.ecell.col;d.range2.hasrange=true}}u=d.range2.hasrange?"":"off";k=document.getElementById(f.idPrefix+"button_movefrom");k.src=f.imagePrefix+"movefrom"+u+".gif";k=document.getElementById(f.idPrefix+"button_movepaste");k.src=f.imagePrefix+"movepaste"+u+".gif";k=document.getElementById(f.idPrefix+"button_moveinsert");k.src=f.imagePrefix+"moveinsert"+u+".gif";if(d.range2.hasrange){d.RangeRemove()}break;case"movepaste":case"moveinsert":if(d.range2.hasrange){f.context.cursorsuffix="";z=l+" "+SocialCalc.crToCoord(d.range2.left,d.range2.top)+":"+SocialCalc.crToCoord(d.range2.right,d.range2.bottom)+" "+d.ecell.coord;f.ExecuteCommand(z,"");d.Range2Remove();k=document.getElementById(f.idPrefix+"button_movefrom");k.src=f.imagePrefix+"movefromoff.gif";k=document.getElementById(f.idPrefix+"button_movepaste");k.src=f.imagePrefix+"movepasteoff.gif";k=document.getElementById(f.idPrefix+"button_moveinsert");k.src=f.imagePrefix+"moveinsertoff.gif"}break;case"swapcolors":e=f.sheet;c=e.GetAssuredCell(d.ecell.coord);j=e.attribs.defaultcolor?e.colors[e.attribs.defaultcolor]:"rgb(0,0,0)";p=e.attribs.defaultbgcolor?e.colors[e.attribs.defaultbgcolor]:"rgb(255,255,255)";v=c.color?e.colors[c.color]:j;if(v==p){v=""}a=c.bgcolor?e.colors[c.bgcolor]:p;if(a==j){a=""}f.ExecuteCommand("set %C color "+a+"%Nset %C bgcolor "+v,"");break;default:z=SocialCalc.SpreadsheetCmdLookup[l]||"";x=SocialCalc.SpreadsheetCmdSLookup[l]||"";f.ExecuteCommand(z,x);break}if(m&&m.blur){m.blur()}SocialCalc.KeyboardFocus()};SocialCalc.SpreadsheetCmdLookup={copy:"copy %C all",cut:"cut %C all",paste:"paste %C all",pasteformats:"paste %C formats","delete":"erase %C formulas",filldown:"filldown %C all",fillright:"fillright %C all",erase:"erase %C all",borderon:"set %C bt %S%Nset %C br %S%Nset %C bb %S%Nset %C bl %S",borderoff:"set %C bt %S%Nset %C br %S%Nset %C bb %S%Nset %C bl %S",merge:"merge %C",unmerge:"unmerge %C","align-left":"set %C cellformat left","align-center":"set %C cellformat center","align-right":"set %C cellformat right","align-default":"set %C cellformat",insertrow:"insertrow %C",insertcol:"insertcol %C",deleterow:"deleterow %C",deletecol:"deletecol %C",undo:"undo",redo:"redo",recalc:"recalc"};SocialCalc.SpreadsheetCmdSLookup={borderon:"1px solid rgb(0,0,0)",borderoff:""};SocialCalc.SpreadsheetControlExecuteCommand=function(g,e,f){var d,b;var a=SocialCalc.GetSpreadsheetControlObject();var c=a.editor;var h={};h.P="%";h.N="\n";if(c.range.hasrange){h.R=SocialCalc.crToCoord(c.range.left,c.range.top)+":"+SocialCalc.crToCoord(c.range.right,c.range.bottom);h.C=h.R;h.W=SocialCalc.rcColname(c.range.left)+":"+SocialCalc.rcColname(c.range.right)}else{h.C=c.ecell.coord;h.R=c.ecell.coord+":"+c.ecell.coord;h.W=SocialCalc.rcColname(SocialCalc.coordToCr(c.ecell.coord).col)}h.S=f;e=e.replace(/%C/g,h.C);e=e.replace(/%R/g,h.R);e=e.replace(/%N/g,h.N);e=e.replace(/%S/g,h.S);e=e.replace(/%W/g,h.W);e=e.replace(/%P/g,h.P);c.EditorScheduleSheetCommands(e,true,false)};SocialCalc.SpreadsheetControlCreateSheetHTML=function(b){var c,e,d;var a="";c=new SocialCalc.RenderContext(b.sheet);e=document.createElement("div");d=c.RenderSheet(null,{type:"html"});e.appendChild(d);delete c;a=e.innerHTML;delete d;delete e;return a};SocialCalc.SpreadsheetControlCreateCellHTML=function(c,e,d){var b="";var a=c.sheet.cells[e];if(!a){return""}if(a.displaystring==undefined){b=SocialCalc.FormatValueForDisplay(c.sheet,a.datavalue,e,(d||c.context.defaultHTMLlinkstyle))}else{b=a.displaystring}if(b=="&nbsp;"){b=""}return b};SocialCalc.SpreadsheetControlCreateCellHTMLSave=function(b,d,e){var h,g,l,c,f,j,a;var k=[];var i;if(d){i=SocialCalc.ParseRange(d)}else{i={cr1:{row:1,col:1},cr2:{row:b.sheet.attribs.lastrow,col:b.sheet.attribs.lastcol}}}h=i.cr1;g=i.cr2;k.push("version:1.0");for(l=h.row;l<=g.row;l++){for(c=h.col;c<=g.col;c++){f=SocialCalc.crToCoord(c,l);j=b.sheet.cells[f];if(!j){continue}if(j.displaystring==undefined){a=SocialCalc.FormatValueForDisplay(b.sheet,j.datavalue,f,(e||b.context.defaultHTMLlinkstyle))}else{a=j.displaystring}if(a=="&nbsp;"){continue}k.push(f+":"+SocialCalc.encodeForSave(a))}}k.push("");return k.join("\n")};SocialCalc.SpreadsheetControl.DoFunctionList=function(){var j,k,m,l,n;var c=SocialCalc.Formula;var g=SocialCalc.Constants;var a=g.function_classlist;var e=SocialCalc.GetSpreadsheetControlObject();var d=e.idPrefix+"function";n=document.getElementById(d+"dialog");if(n){return}c.FillFunctionInfo();m='<table><tr><td><span style="font-size:x-small;font-weight:bold">%loc!Category!</span><br><select id="'+d+'class" size="'+a.length+'" style="width:120px;" onchange="SocialCalc.SpreadsheetControl.FunctionClassChosen(this.options[this.selectedIndex].value);">';for(j=0;j<a.length;j++){m+='<option value="'+a[j]+'"'+(j==0?" selected>":">")+SocialCalc.special_chars(c.FunctionClasses[a[j]].name)+"</option>"}m+='</select></td><td>&nbsp;&nbsp;</td><td id="'+d+'list"><span style="font-size:x-small;font-weight:bold">%loc!Functions!</span><br><select id="'+d+'name" size="'+a.length+'" style="width:240px;" onchange="SocialCalc.SpreadsheetControl.FunctionChosen(this.options[this.selectedIndex].value);" ondblclick="SocialCalc.SpreadsheetControl.DoFunctionPaste();">';m+=SocialCalc.SpreadsheetControl.GetFunctionNamesStr("all");m+='</td></tr><tr><td colspan="3"><div id="'+d+'desc" style="width:380px;height:80px;overflow:auto;font-size:x-small;">'+SocialCalc.SpreadsheetControl.GetFunctionInfoStr(c.FunctionClasses[a[0]].items[0])+'</div><div style="width:380px;text-align:right;padding-top:6px;font-size:small;"><input type="button" value="%loc!Paste!" style="font-size:smaller;" onclick="SocialCalc.SpreadsheetControl.DoFunctionPaste();">&nbsp;<input type="button" value="%loc!Cancel!" style="font-size:smaller;" onclick="SocialCalc.SpreadsheetControl.HideFunctions();"></div></td></tr></table>';var h=document.createElement("div");h.id=d+"dialog";h.style.position="absolute";var b=SocialCalc.GetViewportInfo();h.style.top=(b.height/3)+"px";h.style.left=(b.width/3)+"px";h.style.zIndex=100;h.style.backgroundColor="#FFF";h.style.border="1px solid black";h.style.width="400px";m='<table cellspacing="0" cellpadding="0" style="border-bottom:1px solid black;"><tr><td style="font-size:10px;cursor:default;width:100%;background-color:#999;color:#FFF;">&nbsp;%loc!Function List!</td><td style="font-size:10px;cursor:default;color:#666;" onclick="SocialCalc.SpreadsheetControl.HideFunctions();">&nbsp;X&nbsp;</td></tr></table><div style="background-color:#DDD;">'+m+"</div>";m=SocialCalc.LocalizeSubstrings(m);h.innerHTML=m;SocialCalc.DragRegister(h.firstChild.firstChild.firstChild.firstChild,true,true,{MouseDown:SocialCalc.DragFunctionStart,MouseMove:SocialCalc.DragFunctionPosition,MouseUp:SocialCalc.DragFunctionPosition,Disabled:null,positionobj:h});e.spreadsheetDiv.appendChild(h);n=document.getElementById(d+"name");n.focus();SocialCalc.CmdGotFocus(n)};SocialCalc.SpreadsheetControl.GetFunctionNamesStr=function(a){var b,c;var e=SocialCalc.Formula;var d="";c=e.FunctionClasses[a];for(b=0;b<c.items.length;b++){d+='<option value="'+c.items[b]+'"'+(b==0?" selected>":">")+c.items[b]+"</option>"}return d};SocialCalc.SpreadsheetControl.FillFunctionNames=function(a,d){var b,c;var e=SocialCalc.Formula;d.length=0;c=e.FunctionClasses[a];for(b=0;b<c.items.length;b++){d.options[b]=new Option(c.items[b],c.items[b]);if(b==0){d.options[b].selected=true}}};SocialCalc.SpreadsheetControl.GetFunctionInfoStr=function(e){var d=SocialCalc.Formula;var b=d.FunctionList[e];var a=SocialCalc.special_chars;var c="<b>"+e+"("+a(d.FunctionArgString(e))+")</b><br>";c+=a(b[3]);return c};SocialCalc.SpreadsheetControl.FunctionClassChosen=function(b){var a=SocialCalc.GetSpreadsheetControlObject();var c=a.idPrefix+"function";var d=SocialCalc.Formula;SocialCalc.SpreadsheetControl.FillFunctionNames(b,document.getElementById(c+"name"));SocialCalc.SpreadsheetControl.FunctionChosen(d.FunctionClasses[b].items[0])};SocialCalc.SpreadsheetControl.FunctionChosen=function(c){var a=SocialCalc.GetSpreadsheetControlObject();var b=a.idPrefix+"function";document.getElementById(b+"desc").innerHTML=SocialCalc.SpreadsheetControl.GetFunctionInfoStr(c)};SocialCalc.SpreadsheetControl.HideFunctions=function(){var a=SocialCalc.GetSpreadsheetControlObject();var b=document.getElementById(a.idPrefix+"functiondialog");b.innerHTML="";SocialCalc.DragUnregister(b);SocialCalc.KeyboardFocus();if(b.parentNode){b.parentNode.removeChild(b)}};SocialCalc.SpreadsheetControl.DoFunctionPaste=function(){var a=SocialCalc.GetSpreadsheetControlObject();var b=a.editor;var c=document.getElementById(a.idPrefix+"functionname");var e=document.getElementById(a.idPrefix+"multilinetextarea");var d=c.value+"(";SocialCalc.SpreadsheetControl.HideFunctions();if(e){e.value+=d;e.focus();SocialCalc.CmdGotFocus(e)}else{b.EditorAddToInput(d,"=")}};SocialCalc.SpreadsheetControl.DoMultiline=function(){var b=SocialCalc.LocalizeSubstrings;var i,k,j;var f=SocialCalc.Constants;var e=SocialCalc.GetSpreadsheetControlObject();var h=e.editor;var d=h.workingvalues;var e=SocialCalc.GetSpreadsheetControlObject();var c=e.idPrefix+"multiline";k=document.getElementById(c+"dialog");if(k){return}switch(h.state){case"start":d.ecoord=h.ecell.coord;d.erow=h.ecell.row;d.ecol=h.ecell.col;h.RangeRemove();j=SocialCalc.GetCellContents(h.context.sheetobj,d.ecoord);break;case"input":case"inputboxdirect":j=h.inputBox.GetText();break}h.inputBox.element.disabled=true;j=SocialCalc.special_chars(j);i='<textarea id="'+c+'textarea" style="width:380px;height:120px;margin:10px 0px 0px 6px;">'+j+'</textarea><div style="width:380px;text-align:right;padding:6px 0px 4px 6px;font-size:small;">'+b('<input type="button" value="%loc!Set Cell Contents!" style="font-size:smaller;" onclick="SocialCalc.SpreadsheetControl.DoMultilinePaste();">&nbsp;<input type="button" value="%loc!Clear!" style="font-size:smaller;" onclick="SocialCalc.SpreadsheetControl.DoMultilineClear();">&nbsp;<input type="button" value="%loc!Cancel!" style="font-size:smaller;" onclick="SocialCalc.SpreadsheetControl.HideMultiline();"></div></div>');var g=document.createElement("div");g.id=c+"dialog";g.style.position="absolute";var a=SocialCalc.GetViewportInfo();g.style.top=(a.height/3)+"px";g.style.left=(a.width/3)+"px";g.style.zIndex=100;g.style.backgroundColor="#FFF";g.style.border="1px solid black";g.style.width="400px";g.innerHTML='<table cellspacing="0" cellpadding="0" style="border-bottom:1px solid black;"><tr><td style="font-size:10px;cursor:default;width:100%;background-color:#999;color:#FFF;">'+b("&nbsp;%loc!Multi-line Input Box!")+'</td><td style="font-size:10px;cursor:default;color:#666;" onclick="SocialCalc.SpreadsheetControl.HideMultiline();">&nbsp;X&nbsp;</td></tr></table><div style="background-color:#DDD;">'+i+"</div>";SocialCalc.DragRegister(g.firstChild.firstChild.firstChild.firstChild,true,true,{MouseDown:SocialCalc.DragFunctionStart,MouseMove:SocialCalc.DragFunctionPosition,MouseUp:SocialCalc.DragFunctionPosition,Disabled:null,positionobj:g});e.spreadsheetDiv.appendChild(g);k=document.getElementById(c+"textarea");k.focus();SocialCalc.CmdGotFocus(k)};SocialCalc.SpreadsheetControl.HideMultiline=function(){var b=SocialCalc.Constants;var a=SocialCalc.GetSpreadsheetControlObject();var c=a.editor;var d=document.getElementById(a.idPrefix+"multilinedialog");d.innerHTML="";SocialCalc.DragUnregister(d);SocialCalc.KeyboardFocus();if(d.parentNode){d.parentNode.removeChild(d)}switch(c.state){case"start":c.inputBox.DisplayCellContents(null);break;case"input":case"inputboxdirect":c.inputBox.element.disabled=false;c.inputBox.Focus();break}};SocialCalc.SpreadsheetControl.DoMultilineClear=function(){var a=SocialCalc.GetSpreadsheetControlObject();var b=document.getElementById(a.idPrefix+"multilinetextarea");b.value="";b.focus()};SocialCalc.SpreadsheetControl.DoMultilinePaste=function(){var a=SocialCalc.GetSpreadsheetControlObject();var c=a.editor;var b=c.workingvalues;var d=document.getElementById(a.idPrefix+"multilinetextarea");var e=d.value;SocialCalc.SpreadsheetControl.HideMultiline();switch(c.state){case"start":b.partialexpr="";b.ecoord=c.ecell.coord;b.erow=c.ecell.row;b.ecol=c.ecell.col;break;case"input":case"inputboxdirect":c.inputBox.Blur();c.inputBox.ShowInputBox(false);c.state="start";break}c.EditorSaveEdit(e)};SocialCalc.SpreadsheetControl.DoLink=function(){var n=SocialCalc.LocalizeString;var k,o,m,l,h,b;var f=SocialCalc.Constants;var e=SocialCalc.GetSpreadsheetControlObject();var j=e.editor;var d=j.workingvalues;var e=SocialCalc.GetSpreadsheetControlObject();var c=e.idPrefix+"link";o=document.getElementById(c+"dialog");if(o){return}switch(j.state){case"start":d.ecoord=j.ecell.coord;d.erow=j.ecell.row;d.ecol=j.ecell.col;j.RangeRemove();m=SocialCalc.GetCellContents(j.context.sheetobj,d.ecoord);break;case"input":case"inputboxdirect":m=j.inputBox.GetText();break}j.inputBox.element.disabled=true;if(m.charAt(0)=="'"){m=m.slice(1)}var i=SocialCalc.ParseCellLinkText(m);m=SocialCalc.special_chars(m);l=e.sheet.cells[j.ecell.coord];if(!l||!l.textvalueformat){h=" checked"}else{h=""}b=i.newwin?" checked":"";k='<div style="padding:6px 0px 4px 6px;"><span style="font-size:smaller;">'+n("Description")+'</span><br><input type="text" id="'+c+'desc" style="width:380px;" value="'+SocialCalc.special_chars(i.desc)+'"><br><span style="font-size:smaller;">'+n("URL")+'</span><br><input type="text" id="'+c+'url" style="width:380px;" value="'+SocialCalc.special_chars(i.url)+'"><br>';if(SocialCalc.Callbacks.MakePageLink){k+='<span style="font-size:smaller;">'+n("Page Name")+'</span><br><input type="text" id="'+c+'pagename" style="width:380px;" value="'+SocialCalc.special_chars(i.pagename)+'"><br><span style="font-size:smaller;">'+n("Workspace")+'</span><br><input type="text" id="'+c+'workspace" style="width:380px;" value="'+SocialCalc.special_chars(i.workspace)+'"><br>'}k+=SocialCalc.LocalizeSubstrings('<input type="checkbox" id="'+c+'format"'+h+'>&nbsp;<span style="font-size:smaller;">%loc!Set to Link format!</span><br><input type="checkbox" id="'+c+'popup"'+b+'>&nbsp;<span style="font-size:smaller;">%loc!Show in new browser window!</span></div><div style="width:380px;text-align:right;padding:6px 0px 4px 6px;font-size:small;"><input type="button" value="%loc!Set Cell Contents!" style="font-size:smaller;" onclick="SocialCalc.SpreadsheetControl.DoLinkPaste();">&nbsp;<input type="button" value="%loc!Clear!" style="font-size:smaller;" onclick="SocialCalc.SpreadsheetControl.DoLinkClear();">&nbsp;<input type="button" value="%loc!Cancel!" style="font-size:smaller;" onclick="SocialCalc.SpreadsheetControl.HideLink();"></div></div>');var g=document.createElement("div");g.id=c+"dialog";g.style.position="absolute";var a=SocialCalc.GetViewportInfo();g.style.top=(a.height/3)+"px";g.style.left=(a.width/3)+"px";g.style.zIndex=100;g.style.backgroundColor="#FFF";g.style.border="1px solid black";g.style.width="400px";g.innerHTML='<table cellspacing="0" cellpadding="0" style="border-bottom:1px solid black;"><tr><td style="font-size:10px;cursor:default;width:100%;background-color:#999;color:#FFF;">&nbsp;'+n("Link Input Box")+'</td><td style="font-size:10px;cursor:default;color:#666;" onclick="SocialCalc.SpreadsheetControl.HideLink();">&nbsp;X&nbsp;</td></tr></table><div style="background-color:#DDD;">'+k+"</div>";SocialCalc.DragRegister(g.firstChild.firstChild.firstChild.firstChild,true,true,{MouseDown:SocialCalc.DragFunctionStart,MouseMove:SocialCalc.DragFunctionPosition,MouseUp:SocialCalc.DragFunctionPosition,Disabled:null,positionobj:g});e.spreadsheetDiv.appendChild(g);o=document.getElementById(c+"url");o.focus();SocialCalc.CmdGotFocus(o)};SocialCalc.SpreadsheetControl.HideLink=function(){var b=SocialCalc.Constants;var a=SocialCalc.GetSpreadsheetControlObject();var c=a.editor;var d=document.getElementById(a.idPrefix+"linkdialog");d.innerHTML="";SocialCalc.DragUnregister(d);SocialCalc.KeyboardFocus();if(d.parentNode){d.parentNode.removeChild(d)}switch(c.state){case"start":c.inputBox.DisplayCellContents(null);break;case"input":case"inputboxdirect":c.inputBox.element.disabled=false;c.inputBox.Focus();break}};SocialCalc.SpreadsheetControl.DoLinkClear=function(){var a=SocialCalc.GetSpreadsheetControlObject();document.getElementById(a.idPrefix+"linkdesc").value="";document.getElementById(a.idPrefix+"linkpagename").value="";document.getElementById(a.idPrefix+"linkworkspace").value="";var b=document.getElementById(a.idPrefix+"linkurl");b.value="";b.focus()};SocialCalc.SpreadsheetControl.DoLinkPaste=function(){var c=SocialCalc.GetSpreadsheetControlObject();var g=c.editor;var b=g.workingvalues;var e=document.getElementById(c.idPrefix+"linkdesc");var j=document.getElementById(c.idPrefix+"linkurl");var h=document.getElementById(c.idPrefix+"linkpagename");var d=document.getElementById(c.idPrefix+"linkworkspace");var i=document.getElementById(c.idPrefix+"linkformat");var a=document.getElementById(c.idPrefix+"linkpopup");var k="";var f,m,l,n;if(a.checked){f="<<";m=">>";l="[[";n="]]"}else{f="<";m=">";l="[";n="]"}if(h&&h.value){if(d.value){k=e.value+"{"+d.value+l+h.value+n+"}"}else{k=e.value+l+h.value+n}}else{k=e.value+f+j.value+m}SocialCalc.SpreadsheetControl.HideLink();switch(g.state){case"start":b.partialexpr="";b.ecoord=g.ecell.coord;b.erow=g.ecell.row;b.ecol=g.ecell.col;break;case"input":case"inputboxdirect":g.inputBox.Blur();g.inputBox.ShowInputBox(false);g.state="start";break}if(i.checked){SocialCalc.SpreadsheetControlExecuteCommand(null,"set %C textvalueformat text-link","")}g.EditorSaveEdit(k)};SocialCalc.SpreadsheetControl.DoSum=function(){var e,i,j,d,a,g,c;var b=SocialCalc.GetSpreadsheetControlObject();var f=b.editor;var h=f.context.sheetobj;if(f.range.hasrange){a=SocialCalc.crToCoord(f.range.left,f.range.top)+":"+SocialCalc.crToCoord(f.range.right,f.range.bottom);e="set "+SocialCalc.crToCoord(f.range.right,f.range.bottom+1)+" formula sum("+a+")"}else{j=f.ecell.row-1;d=f.ecell.col;if(j<=1){e="set "+f.ecell.coord+" constant e#REF! 0 #REF!"}else{c=false;while(j>0){g=SocialCalc.crToCoord(d,j);i=h.GetAssuredCell(g);if(!i.datatype||i.datatype=="t"){if(c){j++;break}}else{c=true}j--}e="set "+f.ecell.coord+" formula sum("+SocialCalc.crToCoord(d,j)+":"+SocialCalc.crToCoord(d,f.ecell.row-1)+")"}}f.EditorScheduleSheetCommands(e,true,false)};SocialCalc.SpreadsheetControlSortOnclick=function(f,e){var c,d;var b=[];var a=document.getElementById(f.idPrefix+"sortlist");SocialCalc.LoadColumnChoosers(f);f.editor.RangeChangeCallback.sort=SocialCalc.UpdateSortRangeProposal;for(c in f.sheet.names){b.push(c)}b.sort();a.length=0;a.options[0]=new Option(SocialCalc.LocalizeString("[select range]"));for(d=0;d<b.length;d++){c=b[d];a.options[d+1]=new Option(c,c);if(c==f.sortrange){a.options[d+1].selected=true}}if(f.sortrange==""){a.options[0].selected=true}SocialCalc.UpdateSortRangeProposal(f.editor);SocialCalc.KeyboardFocus();return};SocialCalc.SpreadsheetControlSortSave=function(d,c){var a=SocialCalc.GetSpreadsheetControlObject();var f,b,e;f="sort:"+SocialCalc.encodeForSave(a.sortrange)+":";b=document.getElementById(a.idPrefix+"majorsort");e=document.getElementById(a.idPrefix+"majorsortup");f+=b.selectedIndex+(e.checked?":up":":down");b=document.getElementById(a.idPrefix+"minorsort");if(b.selectedIndex>0){e=document.getElementById(a.idPrefix+"minorsortup");f+=":"+b.selectedIndex+(e.checked?":up":":down")}else{f+="::"}b=document.getElementById(a.idPrefix+"lastsort");if(b.selectedIndex>0){e=document.getElementById(a.idPrefix+"lastsortup");f+=":"+b.selectedIndex+(e.checked?":up":":down")}else{f+="::"}return f+"\n"};SocialCalc.SpreadsheetControlSortLoad=function(e,d,c,b){var g,f;var a=SocialCalc.GetSpreadsheetControlObject();g=c.split(":");a.sortrange=SocialCalc.decodeFromSave(g[1]);f=document.getElementById(a.idPrefix+"sortbutton");if(a.sortrange){f.value=SocialCalc.LocalizeString("Sort ")+a.sortrange;f.style.visibility="visible"}else{f.style.visibility="hidden"}SocialCalc.LoadColumnChoosers(a);sele=document.getElementById(a.idPrefix+"majorsort");sele.selectedIndex=g[2]-0;document.getElementById(a.idPrefix+"majorsort"+g[3]).checked=true;sele=document.getElementById(a.idPrefix+"minorsort");if(g[4]){sele.selectedIndex=g[4]-0;document.getElementById(a.idPrefix+"minorsort"+g[5]).checked=true}else{sele.selectedIndex=0;document.getElementById(a.idPrefix+"minorsortup").checked=true}sele=document.getElementById(a.idPrefix+"lastsort");if(g[6]){sele.selectedIndex=g[6]-0;document.getElementById(a.idPrefix+"lastsort"+g[7]).checked=true}else{sele.selectedIndex=0;document.getElementById(a.idPrefix+"lastsortup").checked=true}return true};SocialCalc.SpreadsheetControlCommentOnclick=function(b,a){b.editor.MoveECellCallback.comment=SocialCalc.SpreadsheetControlCommentMoveECell;SocialCalc.SpreadsheetControlCommentDisplay(b,a);SocialCalc.KeyboardFocus();return};SocialCalc.SpreadsheetControlCommentDisplay=function(b,a){var d="";if(b.editor.ecell&&b.editor.ecell.coord&&b.sheet.cells[b.editor.ecell.coord]){d=b.sheet.cells[b.editor.ecell.coord].comment||""}document.getElementById(b.idPrefix+"commenttext").value=d};SocialCalc.SpreadsheetControlCommentMoveECell=function(a){SocialCalc.SpreadsheetControlCommentDisplay(SocialCalc.GetSpreadsheetControlObject(),"comment")};SocialCalc.SpreadsheetControlCommentSet=function(){var b=SocialCalc.GetSpreadsheetControlObject();b.ExecuteCommand("set %C comment "+SocialCalc.encodeForSave(document.getElementById(b.idPrefix+"commenttext").value));var a=SocialCalc.GetEditorCellElement(b.editor,b.editor.ecell.row,b.editor.ecell.col);b.editor.UpdateCellCSS(a,b.editor.ecell.row,b.editor.ecell.col);SocialCalc.KeyboardFocus()};SocialCalc.SpreadsheetControlCommentOnunclick=function(b,a){delete b.editor.MoveECellCallback.comment};SocialCalc.SpreadsheetControlNamesOnclick=function(b,a){document.getElementById(b.idPrefix+"namesname").value="";document.getElementById(b.idPrefix+"namesdesc").value="";document.getElementById(b.idPrefix+"namesvalue").value="";b.editor.RangeChangeCallback.names=SocialCalc.SpreadsheetControlNamesRangeChange;b.editor.MoveECellCallback.names=SocialCalc.SpreadsheetControlNamesRangeChange;SocialCalc.SpreadsheetControlNamesRangeChange(b.editor);SocialCalc.SpreadsheetControlNamesFillNameList();SocialCalc.SpreadsheetControlNamesChangedName()};SocialCalc.SpreadsheetControlNamesFillNameList=function(){var g=SocialCalc.LocalizeString;var c,e;var b=[];var f=SocialCalc.GetSpreadsheetControlObject();var a=document.getElementById(f.idPrefix+"nameslist");var d=document.getElementById(f.idPrefix+"namesname").value.toUpperCase().replace(/[^A-Z0-9_\.]/g,"");for(c in f.sheet.names){b.push(c)}b.sort();a.length=0;if(b.length>0){a.options[0]=new Option(g("[New]"))}else{a.options[0]=new Option(g("[None]"))}for(e=0;e<b.length;e++){c=b[e];a.options[e+1]=new Option(c,c);if(c==d){a.options[e+1].selected=true}}if(d==""){a.options[0].selected=true}};SocialCalc.SpreadsheetControlNamesChangedName=function(){var c=SocialCalc.GetSpreadsheetControlObject();var a=document.getElementById(c.idPrefix+"nameslist");var b=a.options[a.selectedIndex].value;if(c.sheet.names[b]){document.getElementById(c.idPrefix+"namesname").value=b;document.getElementById(c.idPrefix+"namesdesc").value=c.sheet.names[b].desc||"";document.getElementById(c.idPrefix+"namesvalue").value=c.sheet.names[b].definition||""}else{document.getElementById(c.idPrefix+"namesname").value="";document.getElementById(c.idPrefix+"namesdesc").value="";document.getElementById(c.idPrefix+"namesvalue").value=""}};SocialCalc.SpreadsheetControlNamesRangeChange=function(b){var a=SocialCalc.GetSpreadsheetControlObject();var c=document.getElementById(a.idPrefix+"namesrangeproposal");if(b.range.hasrange){c.value=SocialCalc.crToCoord(b.range.left,b.range.top)+":"+SocialCalc.crToCoord(b.range.right,b.range.bottom)}else{c.value=b.ecell.coord}};SocialCalc.SpreadsheetControlNamesOnunclick=function(b,a){delete b.editor.RangeChangeCallback.names;delete b.editor.MoveECellCallback.names};SocialCalc.SpreadsheetControlNamesSetValue=function(){var a=SocialCalc.GetSpreadsheetControlObject();document.getElementById(a.idPrefix+"namesvalue").value=document.getElementById(a.idPrefix+"namesrangeproposal").value;SocialCalc.KeyboardFocus()};SocialCalc.SpreadsheetControlNamesSave=function(){var b=SocialCalc.GetSpreadsheetControlObject();var a=document.getElementById(b.idPrefix+"namesname").value;SocialCalc.SetTab(b.tabs[0].name);SocialCalc.KeyboardFocus();if(a!=""){b.ExecuteCommand("name define "+a+" "+document.getElementById(b.idPrefix+"namesvalue").value+"\nname desc "+a+" "+document.getElementById(b.idPrefix+"namesdesc").value)}};SocialCalc.SpreadsheetControlNamesDelete=function(){var b=SocialCalc.GetSpreadsheetControlObject();var a=document.getElementById(b.idPrefix+"namesname").value;SocialCalc.SetTab(b.tabs[0].name);SocialCalc.KeyboardFocus();if(a!=""){b.ExecuteCommand("name delete "+a)}SocialCalc.KeyboardFocus()};SocialCalc.SpreadsheetControlClipboardOnclick=function(b,a){var b=SocialCalc.GetSpreadsheetControlObject();clipele=document.getElementById(b.idPrefix+"clipboardtext");document.getElementById(b.idPrefix+"clipboardformat-tab").checked=true;clipele.value=SocialCalc.ConvertSaveToOtherFormat(SocialCalc.Clipboard.clipboard,"tab");return};SocialCalc.SpreadsheetControlClipboardFormat=function(b){var a=SocialCalc.GetSpreadsheetControlObject();clipele=document.getElementById(a.idPrefix+"clipboardtext");clipele.value=SocialCalc.ConvertSaveToOtherFormat(SocialCalc.Clipboard.clipboard,b)};SocialCalc.SpreadsheetControlClipboardLoad=function(){var b=SocialCalc.GetSpreadsheetControlObject();var a="tab";SocialCalc.SetTab(b.tabs[0].name);SocialCalc.KeyboardFocus();if(document.getElementById(b.idPrefix+"clipboardformat-csv").checked){a="csv"}else{if(document.getElementById(b.idPrefix+"clipboardformat-scsave").checked){a="scsave"}}b.editor.EditorScheduleSheetCommands("loadclipboard "+SocialCalc.encodeForSave(SocialCalc.ConvertOtherFormatToSave(document.getElementById(b.idPrefix+"clipboardtext").value,a)),true,false)};SocialCalc.SpreadsheetControlClipboardClear=function(){var b=SocialCalc.GetSpreadsheetControlObject();var a=document.getElementById(b.idPrefix+"clipboardtext");a.value="";b.editor.EditorScheduleSheetCommands("clearclipboard",true,false);a.focus()};SocialCalc.SpreadsheetControlClipboardExport=function(){var a=SocialCalc.GetSpreadsheetControlObject();if(a.ExportCallback){a.ExportCallback(a)}SocialCalc.SetTab(a.tabs[0].name);SocialCalc.KeyboardFocus()};SocialCalc.SpreadsheetControlSettingsSwitch=function(e){SocialCalc.SettingControlReset();var c=SocialCalc.GetSpreadsheetControlObject();var f=document.getElementById(c.idPrefix+"sheetsettingstable");var a=document.getElementById(c.idPrefix+"cellsettingstable");var b=document.getElementById(c.idPrefix+"sheetsettingstoolbar");var d=document.getElementById(c.idPrefix+"cellsettingstoolbar");if(e=="sheet"){f.style.display="block";a.style.display="none";b.style.display="block";d.style.display="none";SocialCalc.SettingsControlSetCurrentPanel(c.views.settings.values.sheetspanel)}else{f.style.display="none";a.style.display="block";b.style.display="none";d.style.display="block";SocialCalc.SettingsControlSetCurrentPanel(c.views.settings.values.cellspanel)}};SocialCalc.SettingsControlSave=function(e){var b,a;var c=SocialCalc.GetSpreadsheetControlObject();var g=SocialCalc.SettingsControls;var d=g.CurrentPanel;var f=SocialCalc.SettingsControlUnloadPanel(d);SocialCalc.SetTab(c.tabs[0].name);SocialCalc.KeyboardFocus();if(e=="sheet"){a=c.sheet.DecodeSheetAttributes(f)}else{if(e=="cell"){if(c.editor.range.hasrange){b=SocialCalc.crToCoord(c.editor.range.left,c.editor.range.top)+":"+SocialCalc.crToCoord(c.editor.range.right,c.editor.range.bottom)}a=c.sheet.DecodeCellAttributes(c.editor.ecell.coord,f,b)}else{}}if(a){c.editor.EditorScheduleSheetCommands(a,true,false)}};SocialCalc.SpreadsheetControlCreateSpreadsheetSave=function(b,g){var a;var f="";var d="";var e,c;if(g){for(e in g){if(g[e].charAt(g[e]-1)!="\n"){c="\n"}else{c=""}f+="--"+b.multipartBoundary+"\nContent-type: text/plain; charset=UTF-8\n\n"+g[e]+c;d+="part:"+e+"\n"}}a="socialcalc:version:1.0\nMIME-Version: 1.0\nContent-Type: multipart/mixed; boundary="+b.multipartBoundary+"\n--"+b.multipartBoundary+"\nContent-type: text/plain; charset=UTF-8\n\n# SocialCalc Spreadsheet Control Save\nversion:1.0\npart:sheet\npart:edit\npart:audit\n"+d+"--"+b.multipartBoundary+"\nContent-type: text/plain; charset=UTF-8\n\n"+b.CreateSheetSave()+"--"+b.multipartBoundary+"\nContent-type: text/plain; charset=UTF-8\n\n"+b.editor.SaveEditorSettings()+"--"+b.multipartBoundary+"\nContent-type: text/plain; charset=UTF-8\n\n"+b.sheet.CreateAuditString()+f+"--"+b.multipartBoundary+"--\n";return a};SocialCalc.SpreadsheetControlDecodeSpreadsheetSave=function(d,k){var m,f,o,c,l,n,b,j,r,h,r,a,e;var g={};var q=[];m=k.search(/^MIME-Version:\s1\.0/mi);if(m<0){return g}f=/^Content-Type:\s*multipart\/mixed;\s*boundary=(\S+)/mig;f.lastIndex=m;o=f.exec(k);if(f.lastIndex<=0){return g}c=o[1];l=new RegExp("^--"+c+"(?:\r\n|\n)","mg");l.lastIndex=f.lastIndex;o=l.exec(k);n=/(?:\r\n|\n)(?:\r\n|\n)/gm;n.lastIndex=l.lastIndex;o=n.exec(k);if(!o){return g}b=n.lastIndex;l.lastIndex=b;o=l.exec(k);if(!o){return g}j=o.index;r=k.substring(b,j).split(/\r\n|\n/);for(h=0;h<r.length;h++){line=r[h];a=line.split(":");switch(a[0]){case"version":break;case"part":q.push(a[1]);break}}for(pnum=0;pnum<q.length;pnum++){n.lastIndex=j;o=n.exec(k);if(!o){return g}b=n.lastIndex;if(pnum==q.length-1){l=new RegExp("^--"+c+"--$","mg")}l.lastIndex=b;o=l.exec(k);if(!o){return g}j=o.index;g[q[pnum]]={start:b,end:j}}return g};SocialCalc.SettingsControls={Controls:{},CurrentPanel:null};SocialCalc.SettingsControlSetCurrentPanel=function(a){SocialCalc.SettingsControls.CurrentPanel=a;SocialCalc.SettingsControls.PopupChangeCallback({panelobj:a},"",null)};SocialCalc.SettingsControlInitializePanel=function(b){var a;var c=SocialCalc.SettingsControls;for(a in b){if(a=="name"){continue}ctrl=c.Controls[b[a].type];if(ctrl&&ctrl.Initialize){ctrl.Initialize(b,a)}}};SocialCalc.SettingsControlLoadPanel=function(b,d){var a;var c=SocialCalc.SettingsControls;for(a in b){if(a=="name"){continue}ctrl=c.Controls[b[a].type];if(ctrl&&ctrl.SetValue){ctrl.SetValue(b,a,d[b[a].setting])}}};SocialCalc.SettingsControlUnloadPanel=function(b){var a;var d=SocialCalc.SettingsControls;var c={};for(a in b){if(a=="name"){continue}ctrl=d.Controls[b[a].type];if(ctrl&&ctrl.GetValue){c[b[a].setting]=ctrl.GetValue(b,a)}}return c};SocialCalc.SettingsControls.PopupChangeCallback=function(d,e,o){var m=SocialCalc.Constants;var q=document.getElementById("sample-text");if(!q||!d||!d.panelobj){return}var b=SocialCalc.CurrentSpreadsheetControlObject.idPrefix;var l=d.panelobj.name=="cell"?"c":"";var p,n,g,k,f,j;g=m.defaultCellLayout.match(/^padding.(\S+) (\S+) (\S+) (\S+).vertical.align.(\S+);$/)||[];var h={color:["textcolor"],backgroundColor:["bgcolor","#FFF"],fontSize:["fontsize",m.defaultCellFontSize],fontFamily:["fontfamily"],paddingTop:["padtop",g[1]],paddingRight:["padright",g[2]],paddingBottom:["padbottom",g[3]],paddingLeft:["padleft",g[4]],verticalAlign:["alignvert",g[5]]};for(n in h){p=SocialCalc.Popup.GetValue(b+l+h[n][0])||h[n][1]||"";q.style[n]=p}if(l=="c"){h={borderTop:"cbt",borderRight:"cbr",borderBottom:"cbb",borderLeft:"cbl"};for(n in h){p=SocialCalc.SettingsControls.BorderSideGetValue(d.panelobj,h[n]);q.style[n]=p?(p.val||""):""}p=SocialCalc.Popup.GetValue(b+"calignhoriz");q.style.textAlign=p||"left";q.childNodes[1].style.textAlign=p||"right"}else{q.style.border="";p=SocialCalc.Popup.GetValue(b+"textalignhoriz");q.style.textAlign=p||"left";p=SocialCalc.Popup.GetValue(b+"numberalignhoriz");q.childNodes[1].style.textAlign=p||"right"}p=SocialCalc.Popup.GetValue(b+l+"fontlook");g=p?(p.match(/^(\S+) (\S+)$/)||[]):[];q.style.fontStyle=g[1]||"";q.style.fontWeight=g[2]||"";p=SocialCalc.Popup.GetValue(b+l+"formatnumber")||"General";k=SocialCalc.FormatNumber.formatNumberWithFormat(9.8765,p,"");f=SocialCalc.FormatNumber.formatNumberWithFormat(-1234.5,p,"");if(f!="??-???-??&nbsp;??:??:??"){k+="<br>"+f}q.childNodes[1].innerHTML=k};SocialCalc.SettingsControls.PopupListSetValue=function(d,a,c){if(!c){alert(a+" no value");return}var b=SocialCalc.Popup;if(!c.def){b.SetValue(d[a].id,c.val)}else{b.SetValue(d[a].id,"")}};SocialCalc.SettingsControls.PopupListGetValue=function(d,b){var a=d[b];if(!a){return null}var c=SocialCalc.Popup.GetValue(a.id);if(c){return{def:false,val:c}}else{return{def:true,val:0}}};SocialCalc.SettingsControls.PopupListInitialize=function(h,j){var e,b,g,c;var f=SocialCalc.SettingsControls;var a=h[j].initialdata||f.Controls[h[j].type].InitialData||"";a=SocialCalc.LocalizeSubstrings(a);var d=a.split(/\|/);var k=[];for(e=0;e<(d.length||0);e++){b=d[e];g=b.indexOf(":");c=b.substring(0,g);if(c.indexOf("\\")!=-1){c=c.replace(/\\c/g,":");c=c.replace(/\\b/g,"\\")}c=SocialCalc.special_chars(c);if(c=="[custom]"){k[e]={o:SocialCalc.Constants.s_PopupListCustom,v:b.substring(g+1),a:{custom:true}}}else{if(c=="[cancel]"){k[e]={o:SocialCalc.Constants.s_PopupListCancel,v:"",a:{cancel:true}}}else{if(c=="[break]"){k[e]={o:"-----",v:"",a:{skip:true}}}else{if(c=="[newcol]"){k[e]={o:"",v:"",a:{newcol:true}}}else{k[e]={o:c,v:b.substring(g+1)}}}}}}SocialCalc.Popup.Create("List",h[j].id,{});SocialCalc.Popup.Initialize(h[j].id,{options:k,attribs:{changedcallback:SocialCalc.SettingsControls.PopupChangeCallback,panelobj:h}})};SocialCalc.SettingsControls.PopupListReset=function(a){SocialCalc.Popup.Reset("List")};SocialCalc.SettingsControls.Controls.PopupList={SetValue:SocialCalc.SettingsControls.PopupListSetValue,GetValue:SocialCalc.SettingsControls.PopupListGetValue,Initialize:SocialCalc.SettingsControls.PopupListInitialize,OnReset:SocialCalc.SettingsControls.PopupListReset,ChangedCallback:null};SocialCalc.SettingsControls.ColorChooserSetValue=function(d,a,c){if(!c){alert(a+" no value");return}var b=SocialCalc.Popup;if(!c.def){b.SetValue(d[a].id,c.val)}else{b.SetValue(d[a].id,"")}};SocialCalc.SettingsControls.ColorChooserGetValue=function(c,a){var b=SocialCalc.Popup.GetValue(c[a].id);if(b){return{def:false,val:b}}else{return{def:true,val:0}}};SocialCalc.SettingsControls.ColorChooserInitialize=function(d,c){var b,f,g,a;var e=SocialCalc.SettingsControls;SocialCalc.Popup.Create("ColorChooser",d[c].id,{});SocialCalc.Popup.Initialize(d[c].id,{attribs:{title:"&nbsp;",moveable:true,width:"106px",changedcallback:SocialCalc.SettingsControls.PopupChangeCallback,panelobj:d}})};SocialCalc.SettingsControls.ColorChooserReset=function(a){SocialCalc.Popup.Reset("ColorChooser")};SocialCalc.SettingsControls.Controls.ColorChooser={SetValue:SocialCalc.SettingsControls.ColorChooserSetValue,GetValue:SocialCalc.SettingsControls.ColorChooserGetValue,Initialize:SocialCalc.SettingsControls.ColorChooserInitialize,OnReset:SocialCalc.SettingsControls.ColorChooserReset,ChangedCallback:null};SocialCalc.SettingsControls.BorderSideSetValue=function(e,f,g){var d=SocialCalc.SettingsControls;var h,i,b,a;var c=e[f].id;if(!g){alert(f+" no value");return}h=document.getElementById(c+"-onoff-bcb");if(!h){return}if(g.val){h.checked=true;h.value=g.val;a=g.val.match(/(\S+)\s+(\S+)\s+(\S.+)/);b=c+"-color";SocialCalc.Popup.SetValue(b,a[3]);SocialCalc.Popup.SetDisabled(b,false)}else{h.checked=false;h.value=g.val;b=c+"-color";SocialCalc.Popup.SetValue(b,"");SocialCalc.Popup.SetDisabled(b,true)}};SocialCalc.SettingsControls.BorderSideGetValue=function(d,a){var e=SocialCalc.SettingsControls;var c,b;var f=d[a].id;c=document.getElementById(f+"-onoff-bcb");if(!c){return}if(c.checked){b=SocialCalc.Popup.GetValue(f+"-color");b="1px solid "+(b||"rgb(0,0,0)");return{def:false,val:b}}else{return{def:false,val:""}}};SocialCalc.SettingsControls.BorderSideInitialize=function(b,a){var c=SocialCalc.SettingsControls;var d=b[a].id;SocialCalc.Popup.Create("ColorChooser",d+"-color",{});SocialCalc.Popup.Initialize(d+"-color",{attribs:{title:"&nbsp;",width:"106px",moveable:true,changedcallback:SocialCalc.SettingsControls.PopupChangeCallback,panelobj:b}})};SocialCalc.SettingsControlOnchangeBorder=function(l){var d,j,m,i;var f=SocialCalc.SettingsControls;var h=f.CurrentPanel;var e=l.id.match(/(^.*\-)(\w+)\-(\w+)\-(\w+)$/);if(!e){return}var c=e[1];var g=e[2];var k=e[3];var a=e[4];var b=h[g].type;switch(a){case"bcb":if(l.checked){f.Controls[b].SetValue(f.CurrentPanel,g,{def:false,val:l.value||"1px solid rgb(0,0,0)"})}else{f.Controls[b].SetValue(f.CurrentPanel,g,{def:false,val:""})}break}};SocialCalc.SettingsControls.Controls.BorderSide={SetValue:SocialCalc.SettingsControls.BorderSideSetValue,GetValue:SocialCalc.SettingsControls.BorderSideGetValue,OnClick:SocialCalc.SettingsControls.ColorComboOnClick,Initialize:SocialCalc.SettingsControls.BorderSideInitialize,InitialData:{thickness:"1 pixel:1px",style:"Solid:solid"},ChangedCallback:null};SocialCalc.SettingControlReset=function(){var b=SocialCalc.SettingsControls;var a;for(a in b.Controls){if(b.Controls[a].OnReset){b.Controls[a].OnReset(a)}}};SocialCalc.OtherSaveParts={};SocialCalc.CtrlSEditor=function(d){var b,e;if(d.length>0){b=SocialCalc.special_chars(SocialCalc.OtherSaveParts[d]||"")}else{b="Listing of Parts\n";for(e in SocialCalc.OtherSaveParts){b+=SocialCalc.special_chars("\nPart: "+e+"\n=====\n"+SocialCalc.OtherSaveParts[e]+"\n")}}var c=document.createElement("div");c.style.cssText="position:absolute;z-index:500;width:300px;height:300px;left:100px;top:200px;border:1px solid black;background-color:#EEE;text-align:center;";c.id="socialcalc-editbox";c.innerHTML=d+'<br><br><textarea id="socialcalc-editbox-textarea" style="width:250px;height:200px;">'+b+"</textarea><br><br><input type=button onclick=\"SocialCalc.CtrlSEditorDone ('socialcalc-editbox', '"+d+'\');" value="OK">';document.body.appendChild(c);var a=document.getElementById("socialcalc-editbox-textarea");a.focus();SocialCalc.CmdGotFocus(a)};SocialCalc.CtrlSEditorDone=function(e,b){var c=document.getElementById(e+"-textarea");var d=c.value;if(b.length>0){if(d.length>0){SocialCalc.OtherSaveParts[b]=d}else{delete SocialCalc.OtherSaveParts[b]}}var a=document.getElementById(e);SocialCalc.KeyboardFocus();a.parentNode.removeChild(a)};