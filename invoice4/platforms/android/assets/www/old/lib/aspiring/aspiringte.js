var SocialCalc;if(!SocialCalc){SocialCalc={}}SocialCalc.TableEditor=function(b){var a=SocialCalc.Constants;this.context=b;this.toplevel=null;this.fullgrid=null;this.noEdit=false;this.width=null;this.tablewidth=null;this.height=null;this.tableheight=null;this.inputBox=null;this.inputEcho=null;this.verticaltablecontrol=null;this.horizontaltablecontrol=null;this.logo=null;this.cellhandles=null;this.timeout=null;this.busy=false;this.ensureecell=false;this.deferredCommands=[];this.gridposition=null;this.headposition=null;this.firstscrollingrow=null;this.firstscrollingrowtop=null;this.lastnonscrollingrow=null;this.lastvisiblerow=null;this.firstscrollingcol=null;this.firstscrollingcolleft=null;this.lastnonscrollingcol=null;this.lastvisiblecol=null;this.rowpositions=[];this.colpositions=[];this.rowheight=[];this.colwidth=[];this.ecell=null;this.state="start";this.workingvalues={};this.imageprefix=a.defaultImagePrefix;this.idPrefix=a.defaultTableEditorIDPrefix;this.pageUpDnAmount=a.defaultPageUpDnAmount;this.recalcFunction=function(c){if(c.context.sheetobj.RecalcSheet){c.context.sheetobj.RecalcSheet(SocialCalc.EditorSheetStatusCallback,c)}else{return null}};this.ctrlkeyFunction=function(j,i){var g,k,l,h,e,c,d;switch(i){case"[ctrl-c]":case"[ctrl-x]":g=j.pasteTextarea;g.value="";l=SocialCalc.GetEditorCellElement(j,j.ecell.row,j.ecell.col);if(l){h=SocialCalc.GetElementPosition(l.element);g.style.left=(h.left-1)+"px";g.style.top=(h.top-1)+"px"}if(j.range.hasrange){c=SocialCalc.crToCoord(j.range.left,j.range.top)+":"+SocialCalc.crToCoord(j.range.right,j.range.bottom)}else{c=j.ecell.coord}d=SocialCalc.ConvertSaveToOtherFormat(SocialCalc.CreateSheetSave(j.context.sheetobj,c),"tab");if(i=="[ctrl-c]"||j.noEdit||(SocialCalc.Callbacks.IsCellEditable&&(!SocialCalc.Callbacks.IsCellEditable(j)))){e="copy "+c+" formulas"}else{e="cut "+c+" formulas"}j.EditorScheduleSheetCommands(e,true,false);g.style.display="block";g.value=d;g.focus();g.select();window.setTimeout(function(){if(!SocialCalc.GetSpreadsheetControlObject){return}var p=SocialCalc.GetSpreadsheetControlObject();if(!p){return}var o=p.editor;var n=o.pasteTextarea;n.blur();n.style.display="none";SocialCalc.KeyboardFocus()},200);return true;case"[ctrl-v]":if(j.noEdit){return true}if(SocialCalc.Callbacks&&SocialCalc.Callbacks.IsCellEditable){if(!SocialCalc.Callbacks.IsCellEditable(j)){return true}}var m=function(){g=j.pasteTextarea;g.value="";l=SocialCalc.GetEditorCellElement(j,j.ecell.row,j.ecell.col);if(l){h=SocialCalc.GetElementPosition(l.element);g.style.left=(h.left-1)+"px";g.style.top=(h.top-1)+"px"}g.style.display="block";g.value="";g.focus()};k=j.pasteHTMLarea;if(k){k.style.visibility="visible";k.focus()}else{m()}window.setTimeout(function(){if(!SocialCalc.GetSpreadsheetControlObject){return}var x=SocialCalc.GetSpreadsheetControlObject();if(!x){return}var r=x.editor;var u=null;var v=false;k=r.pasteHTMLarea;if(k){var w=String.fromCharCode(65532);var q=k.innerHTML;if(q.search(/<(?![Bb][Rr])[A-Za-z]/)>=0){k.innerHTML=q.replace(/(?:<\/[Tt][Dd]>)/g,w)}else{k.innerHTML=q.replace(/&[Nn][Bb][Ss][Pp];/g,w)}u=k.innerText.replace(new RegExp(w,"g"),"\t");k.innerHTML="";k.blur();k.style.visibility="hidden"}else{var p=r.pasteTextarea;u=p.value;p.blur();p.style.display="none"}u=u.replace(/\r\n/g,"\n").replace(/\n?$/,"\n");var n=SocialCalc.ConvertSaveToOtherFormat(SocialCalc.Clipboard.clipboard,"tab");if(u==n||(u.length-n.length==1&&u.substring(0,u.length-1)==n)){v=true}var o="";if(!v){o="loadclipboard "+SocialCalc.encodeForSave(SocialCalc.ConvertOtherFormatToSave(u,"tab"))+"\n"}var t;if(r.range.hasrange){t=SocialCalc.crToCoord(r.range.left,r.range.top)}else{t=r.ecell.coord}o+="paste "+t+" formulas";r.EditorScheduleSheetCommands(o,true,false);SocialCalc.KeyboardFocus()},200);return true;case"[ctrl-z]":j.EditorScheduleSheetCommands("undo",true,false);return false;case"[ctrl-s]":window.setTimeout(function(){if(!SocialCalc.GetSpreadsheetControlObject){return}var r=SocialCalc.GetSpreadsheetControlObject();if(!r){return}var q=r.editor;var p=q.context.sheetobj;var o=p.GetAssuredCell(q.ecell.coord);var t=o.nontextvalueformat?p.valueformats[o.nontextvalueformat-0]||"":"";var n=window.prompt("Advanced Feature:\n\nCustom Numeric Format or Command",t);if(n!=null){if(n.match(/^cmd:/)){e=n.substring(4)}else{if(n.match(/^edit:/)){e=n.substring(5);if(SocialCalc.CtrlSEditor){SocialCalc.CtrlSEditor(e)}return}else{if(q.range.hasrange){c=SocialCalc.crToCoord(q.range.left,q.range.top)+":"+SocialCalc.crToCoord(q.range.right,q.range.bottom)}else{c=q.ecell.coord}e="set "+c+" nontextvalueformat "+n}}q.EditorScheduleSheetCommands(e,true,false)}},200);return false;default:break}return true};b.sheetobj.statuscallback=SocialCalc.EditorSheetStatusCallback;b.sheetobj.statuscallbackparams=this;this.StatusCallback={};this.MoveECellCallback={};this.RangeChangeCallback={};this.SettingsCallbacks={};this.ecell={coord:"A1",row:1,col:1};b.highlights[this.ecell.coord]="cursor";this.range={hasrange:false};this.range2={hasrange:false}};SocialCalc.TableEditor.prototype.CreateTableEditor=function(b,a){return SocialCalc.CreateTableEditor(this,b,a)};SocialCalc.TableEditor.prototype.ResizeTableEditor=function(b,a){return SocialCalc.ResizeTableEditor(this,b,a)};SocialCalc.TableEditor.prototype.SaveEditorSettings=function(){return SocialCalc.SaveEditorSettings(this)};SocialCalc.TableEditor.prototype.LoadEditorSettings=function(b,a){return SocialCalc.LoadEditorSettings(this,b,a)};SocialCalc.TableEditor.prototype.EditorRenderSheet=function(){SocialCalc.EditorRenderSheet(this)};SocialCalc.TableEditor.prototype.EditorScheduleSheetCommands=function(a,c,b){SocialCalc.EditorScheduleSheetCommands(this,a,c,b)};SocialCalc.TableEditor.prototype.ScheduleSheetCommands=function(a,b){this.context.sheetobj.ScheduleSheetCommands(a,b)};SocialCalc.TableEditor.prototype.SheetUndo=function(){this.context.sheetobj.SheetUndo()};SocialCalc.TableEditor.prototype.SheetRedo=function(){this.context.sheetobj.SheetRedo()};SocialCalc.TableEditor.prototype.EditorStepSet=function(b,a){SocialCalc.EditorStepSet(this,b,a)};SocialCalc.TableEditor.prototype.GetStatuslineString=function(b,a,c){return SocialCalc.EditorGetStatuslineString(this,b,a,c)};SocialCalc.TableEditor.prototype.EditorMouseRegister=function(){return SocialCalc.EditorMouseRegister(this)};SocialCalc.TableEditor.prototype.EditorMouseUnregister=function(){return SocialCalc.EditorMouseUnregister(this)};SocialCalc.TableEditor.prototype.EditorMouseRange=function(a){return SocialCalc.EditorMouseRange(this,a)};SocialCalc.TableEditor.prototype.EditorProcessKey=function(a,b){return SocialCalc.EditorProcessKey(this,a,b)};SocialCalc.TableEditor.prototype.EditorAddToInput=function(b,a){return SocialCalc.EditorAddToInput(this,b,a)};SocialCalc.TableEditor.prototype.DisplayCellContents=function(){return SocialCalc.EditorDisplayCellContents(this)};SocialCalc.TableEditor.prototype.EditorSaveEdit=function(a){return SocialCalc.EditorSaveEdit(this,a)};SocialCalc.TableEditor.prototype.EditorApplySetCommandsToRange=function(a,b){return SocialCalc.EditorApplySetCommandsToRange(this,a,b)};SocialCalc.TableEditor.prototype.MoveECellWithKey=function(a){return SocialCalc.MoveECellWithKey(this,a)};SocialCalc.TableEditor.prototype.MoveECell=function(a){return SocialCalc.MoveECell(this,a)};SocialCalc.TableEditor.prototype.ReplaceCell=function(a,c,b){SocialCalc.ReplaceCell(this,a,c,b)};SocialCalc.TableEditor.prototype.UpdateCellCSS=function(a,c,b){SocialCalc.UpdateCellCSS(this,a,c,b)};SocialCalc.TableEditor.prototype.SetECellHeaders=function(a){SocialCalc.SetECellHeaders(this,a)};SocialCalc.TableEditor.prototype.EnsureECellVisible=function(){SocialCalc.EnsureECellVisible(this)};SocialCalc.TableEditor.prototype.RangeAnchor=function(a){SocialCalc.RangeAnchor(this,a)};SocialCalc.TableEditor.prototype.RangeExtend=function(a){SocialCalc.RangeExtend(this,a)};SocialCalc.TableEditor.prototype.RangeRemove=function(){SocialCalc.RangeRemove(this)};SocialCalc.TableEditor.prototype.Range2Remove=function(){SocialCalc.Range2Remove(this)};SocialCalc.TableEditor.prototype.FitToEditTable=function(){SocialCalc.FitToEditTable(this)};SocialCalc.TableEditor.prototype.CalculateEditorPositions=function(){SocialCalc.CalculateEditorPositions(this)};SocialCalc.TableEditor.prototype.ScheduleRender=function(){SocialCalc.ScheduleRender(this)};SocialCalc.TableEditor.prototype.DoRenderStep=function(){SocialCalc.DoRenderStep(this)};SocialCalc.TableEditor.prototype.SchedulePositionCalculations=function(){SocialCalc.SchedulePositionCalculations(this)};SocialCalc.TableEditor.prototype.DoPositionCalculations=function(){SocialCalc.DoPositionCalculations(this)};SocialCalc.TableEditor.prototype.CalculateRowPositions=function(c,a,b){return SocialCalc.CalculateRowPositions(this,c,a,b)};SocialCalc.TableEditor.prototype.CalculateColPositions=function(c,a,b){return SocialCalc.CalculateColPositions(this,c,a,b)};SocialCalc.TableEditor.prototype.ScrollRelative=function(a,b){SocialCalc.ScrollRelative(this,a,b)};SocialCalc.TableEditor.prototype.ScrollRelativeBoth=function(b,a){SocialCalc.ScrollRelativeBoth(this,b,a)};SocialCalc.TableEditor.prototype.PageRelative=function(a,b){SocialCalc.PageRelative(this,a,b)};SocialCalc.TableEditor.prototype.LimitLastPanes=function(){SocialCalc.LimitLastPanes(this)};SocialCalc.TableEditor.prototype.ScrollTableUpOneRow=function(){return SocialCalc.ScrollTableUpOneRow(this)};SocialCalc.TableEditor.prototype.ScrollTableDownOneRow=function(){return SocialCalc.ScrollTableDownOneRow(this)};SocialCalc.TableEditor.prototype.ScrollTableLeftOneCol=function(){return SocialCalc.ScrollTableLeftOneCol(this)};SocialCalc.TableEditor.prototype.ScrollTableRightOneCol=function(){return SocialCalc.ScrollTableRightOneCol(this)};SocialCalc.CreateTableEditor=function(k,b,n){var c=SocialCalc.Constants;var j=SocialCalc.AssignID;k.toplevel=document.createElement("div");k.width=b;k.height=n;k.griddiv=document.createElement("div");k.tablewidth=Math.max(0,b-c.defaultTableControlThickness);k.tableheight=Math.max(0,n-c.defaultTableControlThickness);k.griddiv.style.width=k.tablewidth+"px";k.griddiv.style.height=k.tableheight+"px";k.griddiv.style.overflow="hidden";k.griddiv.style.cursor="default";if(c.cteGriddivClass){k.griddiv.className=c.cteGriddivClass}j(k,k.griddiv,"griddiv");k.FitToEditTable();k.EditorRenderSheet();k.griddiv.appendChild(k.fullgrid);k.verticaltablecontrol=new SocialCalc.TableControl(k,true,k.tableheight);k.verticaltablecontrol.CreateTableControl();j(k,k.verticaltablecontrol.main,"tablecontrolv");k.horizontaltablecontrol=new SocialCalc.TableControl(k,false,k.tablewidth);k.horizontaltablecontrol.CreateTableControl();j(k,k.horizontaltablecontrol.main,"tablecontrolh");var o,i,m,d,h,g,e,l;o=document.createElement("table");k.layouttable=o;o.cellSpacing=0;o.cellPadding=0;j(k,o,"layouttable");i=document.createElement("tbody");o.appendChild(i);m=document.createElement("tr");i.appendChild(m);d=document.createElement("td");d.appendChild(k.griddiv);m.appendChild(d);d=document.createElement("td");m.appendChild(d);m=document.createElement("tr");i.appendChild(m);d=document.createElement("td");m.appendChild(d);d=document.createElement("td");d.innerHTML="<div style='cursor:pointer;font-size:1px;'><img src='"+k.imageprefix+"1x1.gif' border='0' width='18' height='18'></div>";m.appendChild(d);k.logo=d;j(k,k.logo,"logo");SocialCalc.TooltipRegister(d.firstChild.firstChild,"SocialCalc",null);k.toplevel.appendChild(k.layouttable);if(!k.noEdit){k.inputEcho=new SocialCalc.InputEcho(k);j(k,k.inputEcho.main,"inputecho")}k.cellhandles=new SocialCalc.CellHandles(k);e=document.createElement("textarea");SocialCalc.setStyles(e,"display:none;position:absolute;height:1px;width:1px;opacity:0;filter:alpha(opacity=0);");e.value="";k.pasteTextarea=e;j(k,k.pasteTextarea,"pastetextarea");if(navigator.userAgent.match(/Safari\//)&&!navigator.userAgent.match(/Chrome\//)){window.removeEventListener("beforepaste",SocialCalc.SafariPasteFunction,false);window.addEventListener("beforepaste",SocialCalc.SafariPasteFunction,false);window.removeEventListener("beforecopy",SocialCalc.SafariPasteFunction,false);window.addEventListener("beforecopy",SocialCalc.SafariPasteFunction,false);window.removeEventListener("beforecut",SocialCalc.SafariPasteFunction,false);window.addEventListener("beforecut",SocialCalc.SafariPasteFunction,false)}k.toplevel.appendChild(k.pasteTextarea);var a=document.createElement("div");a.innerHTML="    <br/>";if(a.firstChild.nodeType==1){l=document.createElement("div");k.pasteHTMLarea=l;k.toplevel.appendChild(k.pasteHTMLarea);l.contentEditable=true;j(k,k.pasteHTMLarea,"pastehtmlarea");SocialCalc.setStyles(l,"display:block;visibility:hidden;position:absolute;height:1px;width:1px;opacity:0;filter:alpha(opacity=0);overflow:hidden")}SocialCalc.MouseWheelRegister(k.toplevel,{WheelMove:SocialCalc.EditorProcessMouseWheel,editor:k});if(SocialCalc.HasTouch){SocialCalc.TouchRegister(k.toplevel,{Swipe:SocialCalc.EditorProcessSwipe,DoubleTap:SocialCalc.EditorProcessDoubleTap,SingleTap:SocialCalc.EditorProcessSingleTap,editor:k})}if(k.inputBox){if(k.inputBox.element){k.inputBox.element.focus();k.inputBox.element.blur()}}SocialCalc.KeyboardSetFocus(k);SocialCalc.EditorSheetStatusCallback(null,"startup",null,k);return k.toplevel};SocialCalc.SafariPasteFunction=function(a){a.preventDefault()};SocialCalc.ResizeTableEditor=function(d,c,a){var b=SocialCalc.Constants;d.width=c;d.height=a;d.toplevel.style.width=c+"px";d.toplevel.style.height=a+"px";d.tablewidth=Math.max(0,c-b.defaultTableControlThickness);d.tableheight=Math.max(0,a-b.defaultTableControlThickness);d.griddiv.style.width=d.tablewidth+"px";d.griddiv.style.height=d.tableheight+"px";d.verticaltablecontrol.main.style.height=d.tableheight+"px";d.horizontaltablecontrol.main.style.width=d.tablewidth+"px";d.FitToEditTable();d.ScheduleRender();return};SocialCalc.SaveEditorSettings=function(g){var d,e;var c=g.context;var b=g.range;var a="";a+="version:1.0\n";for(d=0;d<c.rowpanes.length;d++){a+="rowpane:"+d+":"+c.rowpanes[d].first+":"+c.rowpanes[d].last+"\n"}for(d=0;d<c.colpanes.length;d++){a+="colpane:"+d+":"+c.colpanes[d].first+":"+c.colpanes[d].last+"\n"}if(g.ecell){a+="ecell:"+g.ecell.coord+"\n"}if(b.hasrange){a+="range:"+b.anchorcoord+":"+b.top+":"+b.bottom+":"+b.left+":"+b.right+"\n"}for(e in g.SettingsCallbacks){a+=g.SettingsCallbacks[e].save(g,e)}return a};SocialCalc.LoadEditorSettings=function(k,m,c){var p=m.split(/\r\n|\n/);var d=[];var q,e,l,o,b,j,n;var a=k.context;var h,g;a.rowpanes=[{first:1,last:1}];a.colpanes=[{first:1,last:1}];k.ecell=null;k.range={hasrange:false};k.range2={hasrange:false};g=k.range;a.highlights={};h=a.highlights;for(e=0;e<p.length;e++){q=p[e];d=q.split(":");n=d[0];switch(n){case"version":break;case"rowpane":a.rowpanes[d[1]-0]={first:d[2]-0,last:d[3]-0};break;case"colpane":a.colpanes[d[1]-0]={first:d[2]-0,last:d[3]-0};break;case"ecell":k.ecell=SocialCalc.coordToCr(d[1]);k.ecell.coord=d[1];h[d[1]]="cursor";break;case"range":g.hasrange=true;g.anchorcoord=d[1];l=SocialCalc.coordToCr(g.anchorcoord);g.anchorrow=l.row;g.anchorcol=l.col;g.top=d[2]-0;g.bottom=d[3]-0;g.left=d[4]-0;g.right=d[5]-0;for(o=g.top;o<=g.bottom;o++){for(b=g.left;b<=g.right;b++){j=SocialCalc.crToCoord(b,o);if(h[j]!="cursor"){h[j]="range"}}}break;default:if(k.SettingsCallbacks[n]){k.SettingsCallbacks[n].load(k,n,q,c)}break}}return};SocialCalc.EditorRenderSheet=function(a){a.EditorMouseUnregister();a.fullgrid=a.context.RenderSheet(a.fullgrid);if(a.ecell){a.SetECellHeaders("selected")}SocialCalc.AssignID(a,a.fullgrid,"fullgrid");a.EditorMouseRegister()};SocialCalc.EditorScheduleSheetCommands=function(b,a,d,c){if(b.state!="start"&&!c){return}if(b.busy&&!c){b.deferredCommands.push({cmdstr:a,saveundo:d});return}switch(a){case"recalc":case"redisplay":b.context.sheetobj.ScheduleSheetCommands(a,false);break;case"undo":b.SheetUndo();break;case"redo":b.SheetRedo();break;default:b.context.sheetobj.ScheduleSheetCommands(a,d);break}};SocialCalc.EditorSheetStatusCallback=function(c,d,j,g){var e,i,b;var a=g.context.sheetobj;var h=function(k){for(e in g.StatusCallback){if(g.StatusCallback[e].func){g.StatusCallback[e].func(g,k,j,g.StatusCallback[e].params)}}};switch(d){case"startup":break;case"cmdstart":g.busy=true;a.celldisplayneeded="";break;case"cmdextension":break;case"cmdend":h(d);if(a.changedrendervalues){g.context.PrecomputeSheetFontsAndLayouts();g.context.CalculateCellSkipData();a.changedrendervalues=false}if(a.celldisplayneeded&&!a.renderneeded){cr=SocialCalc.coordToCr(a.celldisplayneeded);i=SocialCalc.GetEditorCellElement(g,cr.row,cr.col);g.ReplaceCell(i,cr.row,cr.col)}if(g.deferredCommands.length){b=g.deferredCommands.shift();g.EditorScheduleSheetCommands(b.cmdstr,b.saveundo,true);return}if(a.attribs.needsrecalc&&(a.attribs.recalc!="off"||a.recalconce)&&g.recalcFunction){g.FitToEditTable();a.renderneeded=false;if(a.recalconce){delete a.recalconce}g.recalcFunction(g)}else{if(a.renderneeded){g.FitToEditTable();a.renderneeded=false;g.ScheduleRender()}else{g.SchedulePositionCalculations()}}return;case"calcstart":g.busy=true;break;case"calccheckdone":case"calcorder":case"calcstep":case"calcloading":case"calcserverfunc":break;case"calcfinished":h(d);g.ScheduleRender();return;case"schedrender":g.busy=true;break;case"renderdone":break;case"schedposcalc":g.busy=true;break;case"doneposcalc":if(g.deferredCommands.length){h(d);b=g.deferredCommands.shift();g.EditorScheduleSheetCommands(b.cmdstr,b.saveundo,true)}else{g.busy=false;h(d);if(g.state=="start"){g.DisplayCellContents()}}return;default:addmsg("Unknown status: "+d);break}h(d);return};SocialCalc.EditorStepInfo={editor:null};SocialCalc.EditorGetStatuslineString=function(k,h,o,g){var e=SocialCalc.Constants;var m,d,j,b,a,l,n,i,p;d="";switch(h){case"moveecell":case"rangechange":case"startup":break;case"cmdstart":g.command=true;document.body.style.cursor="progress";k.griddiv.style.cursor="progress";d=e.s_statusline_executing;break;case"cmdextension":d="Command Extension: "+o;break;case"cmdend":g.command=false;break;case"schedrender":d=e.s_statusline_displaying;break;case"renderdone":d=" ";break;case"schedposcalc":d=e.s_statusline_displaying;break;case"cmdendnorender":case"doneposcalc":document.body.style.cursor="default";k.griddiv.style.cursor="default";break;case"calcorder":d=e.s_statusline_ordering+Math.floor(100*o.count/(o.total||1))+"%";break;case"calcstep":d=e.s_statusline_calculating+Math.floor(100*o.count/(o.total||1))+"%";break;case"calcloading":d=e.s_statusline_calculatingls+": "+o.sheetname;break;case"calcserverfunc":d=e.s_statusline_calculating+Math.floor(100*o.count/(o.total||1))+"%, "+e.s_statusline_doingserverfunc+o.funcname+e.s_statusline_incell+o.coord;break;case"calcstart":g.calculating=true;document.body.style.cursor="progress";k.griddiv.style.cursor="progress";d=e.s_statusline_calcstart;break;case"calccheckdone":break;case"calcfinished":g.calculating=false;break;default:d=h;break}if(!d&&g.calculating){d=e.s_statusline_calculating}if(!g.calculating&&!g.command&&!d&&k.range.hasrange&&(k.range.left!=k.range.right||k.range.top!=k.range.bottom)){i=0;for(a=k.range.top;a<=k.range.bottom;a++){for(l=k.range.left;l<=k.range.right;l++){n=k.context.sheetobj.cells[SocialCalc.crToCoord(l,a)];if(!n){continue}if(n.valuetype&&n.valuetype.charAt(0)=="n"){i+=n.datavalue-0}}}i=SocialCalc.FormatNumber.formatNumberWithFormat(i,"[,]General","");j=SocialCalc.crToCoord(k.range.left,k.range.top)+":"+SocialCalc.crToCoord(k.range.right,k.range.bottom);d=j+" ("+(k.range.right-k.range.left+1)+"x"+(k.range.bottom-k.range.top+1)+") "+e.s_statusline_sum+"="+i+" "+d}m=k.ecell.coord+" &nbsp; "+d;if(!g.calculating&&k.context.sheetobj.attribs.needsrecalc=="yes"){m+=" &nbsp; "+e.s_statusline_recalcneeded}b=k.context.sheetobj.attribs.circularreferencecell;if(b){b=b.replace(/\|/," referenced by ");m+=" &nbsp; "+e.s_statusline_circref+b+"</span>"}return m};SocialCalc.EditorMouseInfo={registeredElements:[],editor:null,element:null,ignore:false,mousedowncoord:"",mouselastcoord:"",mouseresizecol:"",mouseresizeclientx:null,mouseresizedisplay:null};SocialCalc.EditorMouseRegister=function(d){var a=SocialCalc.EditorMouseInfo;var c=d.fullgrid;var b;for(b=0;b<a.registeredElements.length;b++){if(a.registeredElements[b].editor==d){if(a.registeredElements[b].element==c){return}break}}if(b<a.registeredElements.length){a.registeredElements[b].element=c}else{a.registeredElements.push({element:c,editor:d})}if(c.addEventListener){c.addEventListener("mousedown",SocialCalc.ProcessEditorMouseDown,false);c.addEventListener("dblclick",SocialCalc.ProcessEditorDblClick,false)}else{if(c.attachEvent){c.attachEvent("onmousedown",SocialCalc.ProcessEditorMouseDown);c.attachEvent("ondblclick",SocialCalc.ProcessEditorDblClick)}else{throw"Browser not supported"}}a.ignore=false;return};SocialCalc.EditorMouseUnregister=function(e){var a=SocialCalc.EditorMouseInfo;var c=e.fullgrid;var b,d;for(b=0;b<a.registeredElements.length;b++){if(a.registeredElements[b].editor==e){break}}if(b<a.registeredElements.length){d=a.registeredElements[b].element;if(d.removeEventListener){d.removeEventListener("mousedown",SocialCalc.ProcessEditorMouseDown,false);d.removeEventListener("dblclick",SocialCalc.ProcessEditorDblClick,false)}else{if(d.detachEvent){d.detachEvent("onmousedown",SocialCalc.ProcessEditorMouseDown);d.detachEvent("ondblclick",SocialCalc.ProcessEditorDblClick)}}a.registeredElements.splice(b,1)}return};SocialCalc.ProcessEditorMouseDown=function(l){var j,p,i,m,d,h;var b=l||window.event;var k=SocialCalc.GetViewportInfo();var c=b.clientX+k.horizontalScroll;var a=b.clientY+k.verticalScroll;var g=SocialCalc.EditorMouseInfo;var o=b.target||b.srcElement;var n;if(g.ignore){return}for(n=null;!n&&o;o=o.parentNode){n=SocialCalc.LookupElement(o,g.registeredElements)}if(!n){g.editor=null;return}j=n.editor;g.element=o;h=j.range;p=SocialCalc.GridMousePosition(j,c,a);if(!p||p.rowheader){return}g.editor=j;if(p.colheader&&p.coltoresize){SocialCalc.ProcessEditorColsizeMouseDown(l,o,p);return}if(!p.coord){return}if(!h.hasrange){if(l.shiftKey){j.RangeAnchor()}}i=j.MoveECell(p.coord);if(h.hasrange){if(l.shiftKey){j.RangeExtend()}else{j.RangeRemove()}}g.mousedowncoord=i;g.mouselastcoord=i;j.EditorMouseRange(i);SocialCalc.KeyboardSetFocus(j);if(j.state!="start"&&j.inputBox){j.inputBox.element.focus()}if(document.addEventListener){document.addEventListener("mousemove",SocialCalc.ProcessEditorMouseMove,true);document.addEventListener("mouseup",SocialCalc.ProcessEditorMouseUp,true)}else{if(o.attachEvent){o.setCapture();o.attachEvent("onmousemove",SocialCalc.ProcessEditorMouseMove);o.attachEvent("onmouseup",SocialCalc.ProcessEditorMouseUp);o.attachEvent("onlosecapture",SocialCalc.ProcessEditorMouseUp)}}if(b.stopPropagation){b.stopPropagation()}else{b.cancelBubble=true}if(b.preventDefault){b.preventDefault()}else{b.returnValue=false}return};SocialCalc.EditorMouseRange=function(e,g){var a,c;var b=e.range;switch(e.state){case"input":a=e.inputBox.GetText();c=e.workingvalues;if(("(+-*/,:!&<>=^".indexOf(a.slice(-1))>=0&&a.slice(0,1)=="=")||(a=="=")){c.partialexpr=a}if(c.partialexpr){if(g){if(b.hasrange){var d=(c.currentsheet==c.startsheet)?"":c.currentsheet+"!";e.inputBox.SetText(c.partialexpr+d+SocialCalc.crToCoord(b.left,b.top)+":"+d+SocialCalc.crToCoord(b.right,b.bottom))}else{var d=(c.currentsheet==c.startsheet)?"":c.currentsheet+"!";e.inputBox.SetText(c.partialexpr+d+g)}}}else{e.inputBox.Blur();e.inputBox.ShowInputBox(false);e.state="start";e.cellhandles.ShowCellHandles(true);e.EditorSaveEdit();e.inputBox.DisplayCellContents(null)}break;case"inputboxdirect":e.inputBox.Blur();e.inputBox.ShowInputBox(false);e.state="start";e.cellhandles.ShowCellHandles(true);e.EditorSaveEdit();e.inputBox.DisplayCellContents(null);break}};SocialCalc.ProcessEditorMouseMove=function(o){var l,i,q,k,g,p,c,n,h;var b=o||window.event;var m=SocialCalc.GetViewportInfo();var d=b.clientX+m.horizontalScroll;var a=b.clientY+m.verticalScroll;var j=SocialCalc.EditorMouseInfo;l=j.editor;if(!l){return}if(j.ignore){return}i=j.element;q=SocialCalc.GridMousePosition(l,d,a);if(!q){return}if(q&&!q.coord){SocialCalc.SetDragAutoRepeat(l,q);return}SocialCalc.SetDragAutoRepeat(l,null);if(!q.coord){return}if(q.coord!=j.mouselastcoord){if(!o.shiftKey&&!l.range.hasrange){l.RangeAnchor(j.mousedowncoord)}l.MoveECell(q.coord);l.RangeExtend()}j.mouselastcoord=q.coord;l.EditorMouseRange(q.coord);if(b.stopPropagation){b.stopPropagation()}else{b.cancelBubble=true}if(b.preventDefault){b.preventDefault()}else{b.returnValue=false}return};SocialCalc.ProcessEditorMouseUp=function(o){var l,i,q,k,g,p,c,n,h;var b=o||window.event;var m=SocialCalc.GetViewportInfo();var d=b.clientX+m.horizontalScroll;var a=b.clientY+m.verticalScroll;var j=SocialCalc.EditorMouseInfo;l=j.editor;if(!l){return}if(j.ignore){return}i=j.element;q=SocialCalc.GridMousePosition(l,d,a);SocialCalc.SetDragAutoRepeat(l,null);if(!q){return}if(!q.coord){q.coord=l.ecell.coord}if(l.range.hasrange){l.MoveECell(q.coord);l.RangeExtend()}else{if(q.coord&&q.coord!=j.mousedowncoord){l.RangeAnchor(j.mousedowncoord);l.MoveECell(q.coord);l.RangeExtend()}}l.EditorMouseRange(q.coord);if(b.stopPropagation){b.stopPropagation()}else{b.cancelBubble=true}if(b.preventDefault){b.preventDefault()}else{b.returnValue=false}if(document.removeEventListener){document.removeEventListener("mousemove",SocialCalc.ProcessEditorMouseMove,true);document.removeEventListener("mouseup",SocialCalc.ProcessEditorMouseUp,true)}else{if(i.detachEvent){i.detachEvent("onlosecapture",SocialCalc.ProcessEditorMouseUp);i.detachEvent("onmouseup",SocialCalc.ProcessEditorMouseUp);i.detachEvent("onmousemove",SocialCalc.ProcessEditorMouseMove);i.releaseCapture()}}j.editor=null;return false};SocialCalc.ProcessEditorColsizeMouseDown=function(h,j,k){var a=h||window.event;var d=SocialCalc.EditorMouseInfo;var g=d.editor;var i=SocialCalc.GetViewportInfo();var b=a.clientX+i.horizontalScroll;d.mouseresizecolnum=k.coltoresize;d.mouseresizecol=SocialCalc.rcColname(k.coltoresize);d.mousedownclientx=b;var c=document.createElement("div");d.mouseresizedisplay=c;c.style.width="auto";c.style.position="absolute";c.style.zIndex=100;c.style.top=(g.headposition.top+0)+"px";c.style.left=g.colpositions[k.coltoresize]+"px";c.innerHTML='<table cellpadding="0" cellspacing="0"><tr><td style="height:100px;border:1px dashed black;background-color:white;width:'+(g.context.colwidth[d.mouseresizecolnum]-2)+'px;">&nbsp;</td><td><div style="font-size:small;color:white;background-color:gray;padding:4px;">'+g.context.colwidth[d.mouseresizecolnum]+"</div></td></tr></table>";SocialCalc.setStyles(c.firstChild.lastChild.firstChild.childNodes[0],"filter:alpha(opacity=85);opacity:.85;");g.toplevel.appendChild(c);if(document.addEventListener){document.addEventListener("mousemove",SocialCalc.ProcessEditorColsizeMouseMove,true);document.addEventListener("mouseup",SocialCalc.ProcessEditorColsizeMouseUp,true)}else{if(g.toplevel.attachEvent){g.toplevel.setCapture();g.toplevel.attachEvent("onmousemove",SocialCalc.ProcessEditorColsizeMouseMove);g.toplevel.attachEvent("onmouseup",SocialCalc.ProcessEditorColsizeMouseUp);g.toplevel.attachEvent("onlosecapture",SocialCalc.ProcessEditorColsizeMouseUp)}}if(a.stopPropagation){a.stopPropagation()}else{a.cancelBubble=true}if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}return};SocialCalc.ProcessEditorColsizeMouseMove=function(j){var i=j||window.event;var b=SocialCalc.EditorMouseInfo;var g=b.editor;if(!g){return}var a=SocialCalc.GetViewportInfo();var h=i.clientX+a.horizontalScroll;var d=(g.context.colwidth[b.mouseresizecolnum]-0)+(h-b.mousedownclientx);if(d<SocialCalc.Constants.defaultMinimumColWidth){d=SocialCalc.Constants.defaultMinimumColWidth}var c=b.mouseresizedisplay;c.innerHTML='<table cellpadding="0" cellspacing="0"><tr><td style="height:100px;border:1px dashed black;background-color:white;width:'+(d-2)+'px;">&nbsp;</td><td><div style="font-size:small;color:white;background-color:gray;padding:4px;">'+d+"</div></td></tr></table>";SocialCalc.setStyles(c.firstChild.lastChild.firstChild.childNodes[0],"filter:alpha(opacity=85);opacity:.85;");if(i.stopPropagation){i.stopPropagation()}else{i.cancelBubble=true}if(i.preventDefault){i.preventDefault()}else{i.returnValue=false}return};SocialCalc.ProcessEditorColsizeMouseUp=function(i){var h=i||window.event;var b=SocialCalc.EditorMouseInfo;var d=b.editor;if(!d){return}element=b.element;var a=SocialCalc.GetViewportInfo();var g=h.clientX+a.horizontalScroll;if(h.stopPropagation){h.stopPropagation()}else{h.cancelBubble=true}if(h.preventDefault){h.preventDefault()}else{h.returnValue=false}if(document.removeEventListener){document.removeEventListener("mousemove",SocialCalc.ProcessEditorColsizeMouseMove,true);document.removeEventListener("mouseup",SocialCalc.ProcessEditorColsizeMouseUp,true)}else{if(d.toplevel.detachEvent){d.toplevel.detachEvent("onlosecapture",SocialCalc.ProcessEditorColsizeMouseUp);d.toplevel.detachEvent("onmouseup",SocialCalc.ProcessEditorColsizeMouseUp);d.toplevel.detachEvent("onmousemove",SocialCalc.ProcessEditorColsizeMouseMove);d.toplevel.releaseCapture()}}var c=(d.context.colwidth[b.mouseresizecolnum]-0)+(g-b.mousedownclientx);if(c<SocialCalc.Constants.defaultMinimumColWidth){c=SocialCalc.Constants.defaultMinimumColWidth}d.EditorScheduleSheetCommands("set "+b.mouseresizecol+" width "+c,true,false);if(d.timeout){window.clearTimeout(d.timeout)}d.timeout=window.setTimeout(SocialCalc.FinishColsize,1);return false};SocialCalc.FinishColsize=function(){var a=SocialCalc.EditorMouseInfo;var b=a.editor;if(!b){return}b.toplevel.removeChild(a.mouseresizedisplay);a.mouseresizedisplay=null;a.editor=null;return};SocialCalc.AutoRepeatInfo={timer:null,mouseinfo:null,repeatinterval:1000,editor:null,repeatcallback:null};SocialCalc.SetDragAutoRepeat=function(b,a,g){var c=SocialCalc.AutoRepeatInfo;var e,d;c.repeatcallback=g;if(!a){if(c.timer){window.clearTimeout(c.timer);c.timer=null}c.mouseinfo=null;return}c.editor=b;if(c.mouseinfo){if(a.rowheader||a.rowfooter){if(a.row!=c.mouseinfo.row){e=SocialCalc.crToCoord(b.ecell.col,a.row);if(c.repeatcallback){if(a.row<c.mouseinfo.row){d="left"}else{if(a.row>c.mouseinfo.row){d="right"}else{d=""}}c.repeatcallback(e,d)}else{b.MoveECell(e);b.MoveECell(e);b.RangeExtend();b.EditorMouseRange(e)}}}else{if(a.colheader||a.colfooter){if(a.col!=c.mouseinfo.col){e=SocialCalc.crToCoord(a.col,b.ecell.row);if(c.repeatcallback){if(a.row<c.mouseinfo.row){d="left"}else{if(a.row>c.mouseinfo.row){d="right"}else{d=""}}c.repeatcallback(e,d)}else{b.MoveECell(e);b.RangeExtend();b.EditorMouseRange(e)}}}}}c.mouseinfo=a;if(a.distance<5){c.repeatinterval=333}else{if(a.distance<10){c.repeatinterval=250}else{if(a.distance<25){c.repeatinterval=100}else{if(a.distance<35){c.repeatinterval=75}else{if(c.timer){window.clearTimeout(c.timer);c.timer=null}return}}}}if(!c.timer){c.timer=window.setTimeout(SocialCalc.DragAutoRepeat,c.repeatinterval)}return};SocialCalc.DragAutoRepeat=function(){var c=SocialCalc.AutoRepeatInfo;var a=c.mouseinfo;var d,e,b;if(a.rowheader){d="left"}else{if(a.rowfooter){d="right"}else{if(a.colheader){d="up"}else{if(a.colfooter){d="down"}}}}if(c.repeatcallback){b=SocialCalc.coordToCr(c.editor.ecell.coord);if(d=="left"&&b.col>1){b.col--}else{if(d=="right"){b.col++}else{if(d=="up"&&b.row>1){b.row--}else{if(d=="down"){b.row++}}}}e=SocialCalc.crToCoord(b.col,b.row);c.repeatcallback(e,d)}else{e=c.editor.MoveECellWithKey("[a"+d+"]shifted");if(e){c.editor.EditorMouseRange(e)}}c.timer=window.setTimeout(SocialCalc.DragAutoRepeat,c.repeatinterval)};SocialCalc.ProcessEditorDblClick=function(l){var j,p,i,m,d,h;var b=l||window.event;var k=SocialCalc.GetViewportInfo();var c=b.clientX+k.horizontalScroll;var a=b.clientY+k.verticalScroll;var g=SocialCalc.EditorMouseInfo;var o=b.target||b.srcElement;var n;if(g.ignore){return}for(n=null;!n&&o;o=o.parentNode){n=SocialCalc.LookupElement(o,g.registeredElements)}if(!n){g.editor=null;return}j=n.editor;p=SocialCalc.GridMousePosition(j,c,a);if(!p||!p.coord){return}g.editor=j;g.element=o;h=j.range;sheetobj=j.context.sheetobj;switch(j.state){case"start":SocialCalc.EditorOpenCellEdit(j);break;case"input":break;default:break}if(b.stopPropagation){b.stopPropagation()}else{b.cancelBubble=true}if(b.preventDefault){b.preventDefault()}else{b.returnValue=false}return};SocialCalc.EditorOpenCellEdit=function(b){var a;if(!b.ecell){return true}if(!b.inputBox){return true}if(SocialCalc.Callbacks&&SocialCalc.Callbacks.IsCellEditable){if(!SocialCalc.Callbacks.IsCellEditable(b)){return true}}if(b.inputBox.element.disabled){return true}if(b.inputBox.element.style.display=="none"){for(f in b.StatusCallback){b.StatusCallback[f].func(b,"editecell",null,b.StatusCallback[f].params)}return true}b.inputBox.ShowInputBox(true);b.inputBox.Focus();b.state="inputboxdirect";b.inputBox.SetText("");b.inputBox.DisplayCellContents();b.inputBox.Select("end");a=b.workingvalues;a.partialexpr="";a.ecoord=b.ecell.coord;a.erow=b.ecell.row;a.ecol=b.ecell.col;a.startsheet=a.currentsheet;a.startsheetid=a.currentsheetid;return};SocialCalc.EditorProcessKey=function(l,a,m){var p,o,n,i,g,k,c,j;var b=l.context.sheetobj;var d=l.workingvalues;var h=l.range;if(typeof a!="string"){a=""}switch(l.state){case"start":if(m.shiftKey&&a.substr(0,2)=="[a"){a=a+"shifted"}if(a=="[enter]"){a="[adown]"}if(a=="[tab]"){a=m.shiftKey?"[aleft]":"[aright]"}if(a.substr(0,2)=="[a"||a.substr(0,3)=="[pg"||a=="[home]"){p=l.MoveECellWithKey(a);return !p}if(a=="[del]"||a=="[backspace]"){if(!l.noEdit){l.EditorApplySetCommandsToRange("empty","")}if(SocialCalc.Callbacks&&SocialCalc.Callbacks.IsCellEditable){if(!SocialCalc.Callbacks.IsCellEditable(l)){return true}}break}if(a=="[esc]"){if(h.hasrange){l.RangeRemove();l.MoveECell(h.anchorcoord);for(j in l.StatusCallback){l.StatusCallback[j].func(l,"specialkey",a,l.StatusCallback[j].params)}}return false}if(a=="[f2]"){if(l.noEdit){return true}SocialCalc.EditorOpenCellEdit(l);return false}if((a.length>1&&a.substr(0,1)=="[")||a.length==0){if(l.ctrlkeyFunction&&a.length>0){return l.ctrlkeyFunction(l,a)}else{return true}}if(!l.ecell){return true}if(!l.inputBox){return true}if(l.inputBox.element.style.display=="none"){for(j in l.StatusCallback){l.StatusCallback[j].func(l,"editecell",a,l.StatusCallback[j].params)}return true}if(SocialCalc.Callbacks&&SocialCalc.Callbacks.IsCellEditable){if(!SocialCalc.Callbacks.IsCellEditable(l)){return true}}l.inputBox.element.disabled=false;l.state="input";l.inputBox.ShowInputBox(true);l.inputBox.Focus();l.inputBox.SetText(a);l.inputBox.Select("end");d.partialexpr="";d.ecoord=l.ecell.coord;d.erow=l.ecell.row;d.ecol=l.ecell.col;d.startsheet=d.currentsheet;d.startsheetid=d.currentsheetid;l.RangeRemove();break;case"input":c=l.inputBox.GetText();if(l.inputBox.skipOne){return false}if(a=="[esc]"||a=="[enter]"||a=="[tab]"||(a&&a.substr(0,2)=="[a")){if(("(+-*/,:!&<>=^".indexOf(c.slice(-1))>=0&&c.slice(0,1)=="=")||(c=="=")){d.partialexpr=c}if(d.partialexpr){if(m.shiftKey&&a.substr(0,2)=="[a"){a=a+"shifted"}k=l.MoveECellWithKey(a);if(k){if(h.hasrange){l.inputBox.SetText(d.partialexpr+SocialCalc.crToCoord(h.left,h.top)+":"+SocialCalc.crToCoord(h.right,h.bottom))}else{l.inputBox.SetText(d.partialexpr+k)}return false}}l.inputBox.Blur();l.inputBox.ShowInputBox(false);l.state="start";l.cellhandles.ShowCellHandles(true);if(a!="[esc]"){l.EditorSaveEdit();if(l.ecell.coord!=d.ecoord){l.MoveECell(d.ecoord)}if(a=="[enter]"){a="[adown]"}if(a=="[tab]"){a=m.shiftKey?"[aleft]":"[aright]"}if(a.substr(0,2)=="[a"){l.MoveECellWithKey(a)}}else{l.inputBox.DisplayCellContents();l.RangeRemove();l.MoveECell(d.ecoord)}break}if(d.partialexpr&&a=="[backspace]"){l.inputBox.SetText(d.partialexpr);d.partialexpr="";l.RangeRemove();l.MoveECell(d.ecoord);l.inputBox.ShowInputBox(true);return false}if(a=="[f2]"){return false}if(h.hasrange){l.RangeRemove()}l.MoveECell(d.ecoord);if(d.partialexpr){l.inputBox.ShowInputBox(true);d.partialexpr=""}return true;case"inputboxdirect":c=l.inputBox.GetText();if(a=="[esc]"||a=="[enter]"||a=="[tab]"){l.inputBox.Blur();l.inputBox.ShowInputBox(false);l.state="start";l.cellhandles.ShowCellHandles(true);if(a=="[esc]"){l.inputBox.DisplayCellContents()}else{l.EditorSaveEdit();if(l.ecell.coord!=d.ecoord){l.MoveECell(d.ecoord)}if(a=="[enter]"){a="[adown]"}if(a=="[tab]"){a=m.shiftKey?"[aleft]":"[aright]"}if(a.substr(0,2)=="[a"){l.MoveECellWithKey(a)}}break}if(a=="[f2]"){return false}return true;case"skip-and-start":l.state="start";l.cellhandles.ShowCellHandles(true);return false;default:return true}return false};SocialCalc.EditorAddToInput=function(b,d,c){var a=b.workingvalues;if(b.noEdit){return}if(SocialCalc.Callbacks&&SocialCalc.Callbacks.IsCellEditable){if(!SocialCalc.Callbacks.IsCellEditable(b)){return true}}switch(b.state){case"start":b.state="input";b.inputBox.ShowInputBox(true);b.inputBox.element.disabled=false;b.inputBox.Focus();b.inputBox.SetText((c||"")+d);b.inputBox.Select("end");a.partialexpr="";a.ecoord=b.ecell.coord;a.erow=b.ecell.row;a.ecol=b.ecell.col;a.startsheet=a.currentsheet;a.startsheetid=a.currentsheetid;b.RangeRemove();break;case"input":case"inputboxdirect":b.inputBox.element.focus();if(a.partialexpr){b.inputBox.SetText(a.partialexpr);a.partialexpr="";b.RangeRemove();b.MoveECell(a.ecoord)}b.inputBox.SetText(b.inputBox.GetText()+d);break;default:break}};SocialCalc.EditorDisplayCellContents=function(a){if(a.inputBox){a.inputBox.DisplayCellContents()}};SocialCalc.EditorSaveEdit=function(j,n){var o,m,i,c,k,l,d,g;var a=j.context.sheetobj;var b=j.workingvalues;if(SocialCalc.Callbacks&&SocialCalc.Callbacks.IsCellEditable){if(!SocialCalc.Callbacks.IsCellEditable(j)){return true}}k="text t";l=typeof n=="string"?n:j.inputBox.GetText();d=SocialCalc.GetCellContents(a,b.ecoord)+"";if(l==d){return}c=l.charAt(0);if(c=="="&&l.indexOf("\n")==-1){k="formula";l=l.substring(1)}else{if(c=="'"){k="text t";l=l.substring(1)}else{if(l.length==0){k="empty"}else{i=SocialCalc.DetermineValueType(l);if(i.type=="n"&&l==(i.value+"")){k="value n"}else{if(i.type.charAt(0)=="t"){k="text "+i.type}else{if(i.type==""){k="text t"}else{k="constant "+i.type+" "+i.value}}}}}}if(k.charAt(0)=="t"){l=SocialCalc.encodeForSave(l)}if(SocialCalc.WorkBook&&(b.currentsheet!=b.startsheet)){var e=SocialCalc.GetCurrentWorkBookControl();var h="activatesheet "+b.startsheetid;e.ExecuteWorkBookControlCommand({cmdtype:"wcmd",id:"0",cmdstr:h},false)}g="set "+b.ecoord+" "+k+" "+l;j.EditorScheduleSheetCommands(g,true,false);return};SocialCalc.EditorApplySetCommandsToRange=function(h,e){var i,j,c,k,d;var b=h.context.sheetobj;var a=h.ecell;var g=h.range;if(g.hasrange){coord=SocialCalc.crToCoord(g.left,g.top)+":"+SocialCalc.crToCoord(g.right,g.bottom);k="set "+coord+" "+e;d=h.EditorScheduleSheetCommands(k,true,false)}else{k="set "+a.coord+" "+e;d=h.EditorScheduleSheetCommands(k,true,false)}h.DisplayCellContents()};SocialCalc.EditorProcessMouseWheel=function(c,d,a,b){if(b.functionobj.editor.busy){return}if(d>0){b.functionobj.editor.ScrollRelative(true,-1)}if(d<0){b.functionobj.editor.ScrollRelative(true,+1)}};SocialCalc.GridMousePosition=function(e,g,d){var h,b,c;var a={};for(h=1;h<e.rowpositions.length;h++){if(!e.rowheight[h]){continue}if(e.rowpositions[h]+e.rowheight[h]>d){break}}for(b=1;b<e.colpositions.length;b++){if(!e.colwidth[b]){continue}if(e.colpositions[b]+e.colwidth[b]>g){break}}a.row=h;a.col=b;if(e.headposition){if(g<e.headposition.left&&g>=e.gridposition.left){a.rowheader=true;a.distance=e.headposition.left-g;return a}else{if(d<e.headposition.top&&d>e.gridposition.top){a.colheader=true;a.distance=e.headposition.top-d;a.coltoresize=b-(e.colpositions[b]+e.colwidth[b]/2>g?1:0)||1;for(c=0;c<e.context.colpanes.length;c++){if(a.coltoresize>=e.context.colpanes[c].first&&a.coltoresize<=e.context.colpanes[c].last){return a}}delete a.coltoresize;return a}else{if(g>=e.verticaltablecontrol.controlborder){a.rowfooter=true;a.distance=g-e.verticaltablecontrol.controlborder;return a}else{if(d>=e.horizontaltablecontrol.controlborder){a.colfooter=true;a.distance=d-e.horizontaltablecontrol.controlborder;return a}else{if(g<e.gridposition.left){a.rowheader=true;a.distance=e.headposition.left-g;return a}else{if(d<=e.gridposition.top){a.colheader=true;a.distance=e.headposition.top-d;return a}else{a.coord=SocialCalc.crToCoord(a.col,a.row);if(e.context.cellskip[a.coord]){a.coord=e.context.cellskip[a.coord]}return a}}}}}}}return null};SocialCalc.GetEditorCellElement=function(e,k,b){var i,g,h,d;var j=0;var a=0;for(i=0;i<e.context.rowpanes.length;i++){if(k>=e.context.rowpanes[i].first&&k<=e.context.rowpanes[i].last){for(g=0;g<e.context.colpanes.length;g++){if(b>=e.context.colpanes[g].first&&b<=e.context.colpanes[g].last){j+=k-e.context.rowpanes[i].first+2;for(h=e.context.colpanes[g].first;h<=b;h++){d=e.context.cellskip[SocialCalc.crToCoord(h,k)];if(!d||!e.context.CoordInPane(d,i,g)){a++}}return{element:e.griddiv.firstChild.lastChild.childNodes[j].childNodes[a],rowpane:i,colpane:g}}for(h=e.context.colpanes[g].first;h<=e.context.colpanes[g].last;h++){d=e.context.cellskip[SocialCalc.crToCoord(h,k)];if(!d||!e.context.CoordInPane(d,i,g)){a++}}a+=1}}j+=e.context.rowpanes[i].last-e.context.rowpanes[i].first+1+1}return null};SocialCalc.MoveECellWithKey=function(d,c){var h,g,b,a;var e=false;if(!d.ecell){return null}if(c.slice(-7)=="shifted"){c=c.slice(0,-7);e=true}g=d.ecell.row;b=d.ecell.col;a=d.context.sheetobj.cells[d.ecell.coord];switch(c){case"[adown]":g+=(a&&a.rowspan)||1;break;case"[aup]":g--;break;case"[pgdn]":g+=d.pageUpDnAmount-1+((a&&a.rowspan)||1);break;case"[pgup]":g-=d.pageUpDnAmount;break;case"[aright]":b+=(a&&a.colspan)||1;break;case"[aleft]":b--;break;case"[home]":g=1;b=1;break;default:return null}if(!d.range.hasrange){if(e){d.RangeAnchor()}}h=d.MoveECell(SocialCalc.crToCoord(b,g));if(d.range.hasrange){if(e){d.RangeExtend()}else{d.RangeRemove()}}return h};SocialCalc.MoveECell=function(c,b){var a,d;var e=c.context.highlights;if(c.ecell){if(c.ecell.coord==b){return b}if(SocialCalc.Callbacks.broadcast){SocialCalc.Callbacks.broadcast("ecell",{original:c.ecell.coord,ecell:b})}a=SocialCalc.GetEditorCellElement(c,c.ecell.row,c.ecell.col);delete e[c.ecell.coord];if(c.range2.hasrange&&c.ecell.row>=c.range2.top&&c.ecell.row<=c.range2.bottom&&c.ecell.col>=c.range2.left&&c.ecell.col<=c.range2.right){e[c.ecell.coord]="range2"}c.UpdateCellCSS(a,c.ecell.row,c.ecell.col);c.SetECellHeaders("");c.cellhandles.ShowCellHandles(false)}else{if(SocialCalc.Callbacks.broadcast){SocialCalc.Callbacks.broadcast("ecell",{ecell:b})}}b=c.context.cellskip[b]||b;c.ecell=SocialCalc.coordToCr(b);c.ecell.coord=b;a=SocialCalc.GetEditorCellElement(c,c.ecell.row,c.ecell.col);e[b]="cursor";for(d in c.MoveECellCallback){c.MoveECellCallback[d](c)}c.UpdateCellCSS(a,c.ecell.row,c.ecell.col);c.SetECellHeaders("selected");for(d in c.StatusCallback){c.StatusCallback[d].func(c,"moveecell",b,c.StatusCallback[d].params)}if(c.busy){c.ensureecell=true}else{c.ensureecell=false;c.EnsureECellVisible()}return b};SocialCalc.EnsureECellVisible=function(b){var c=0;var a=0;if(b.ecell.row>b.lastnonscrollingrow){if(b.ecell.row<b.firstscrollingrow){c=b.ecell.row-b.firstscrollingrow}else{if(b.ecell.row>b.lastvisiblerow){c=b.ecell.row-b.lastvisiblerow}}}if(b.ecell.col>b.lastnonscrollingcol){if(b.ecell.col<b.firstscrollingcol){a=b.ecell.col-b.firstscrollingcol}else{if(b.ecell.col>b.lastvisiblecol){a=b.ecell.col-b.lastvisiblecol}}}if(c!=0||a!=0){b.ScrollRelativeBoth(c,a)}else{b.cellhandles.ShowCellHandles(true)}};SocialCalc.ReplaceCell=function(g,b,h,e){var d,c;if(!b){return}d=g.context.RenderCell(h,e,b.rowpane,b.colpane,true,null);if(d){b.element.innerHTML=d.innerHTML;b.element.style.cssText="";b.element.className=d.className;for(c in d.style){if(d.style[c]!="cssText"){b.element.style[c]=d.style[c]}}}};SocialCalc.UpdateCellCSS=function(g,b,h,e){var d,c;if(!b){return}d=g.context.RenderCell(h,e,b.rowpane,b.colpane,true,null);if(d){b.element.style.cssText="";b.element.className=d.className;for(c in d.style){if(d.style[c]!="cssText"){b.element.style[c]=d.style[c]}}}};SocialCalc.SetECellHeaders=function(h,e){var c=h.ecell;var d=h.context;var j,i,g,k;var l=0;var b=0;var a;if(!c){return}for(j=0;j<d.rowpanes.length;j++){g=d.rowpanes[j].first;k=d.rowpanes[j].last;if(c.row>=g&&c.row<=k){a=h.fullgrid.childNodes[1].childNodes[2+l+c.row-g].childNodes[0];if(a){if(d.classnames){a.className=d.classnames[e+"rowname"]}if(d.explicitStyles){a.style.cssText=d.explicitStyles[e+"rowname"]}a.style.verticalAlign="top"}}l+=k-g+1+1}for(i=0;i<d.colpanes.length;i++){g=d.colpanes[i].first;k=d.colpanes[i].last;if(c.col>=g&&c.col<=k){a=h.fullgrid.childNodes[1].childNodes[1].childNodes[1+b+c.col-g];if(a){if(d.classnames){a.className=d.classnames[e+"colname"]}if(d.explicitStyles){a.style.cssText=d.explicitStyles[e+"colname"]}}}b+=k-g+1+1}};SocialCalc.RangeAnchor=function(a,b){if(a.range.hasrange){a.RangeRemove()}a.RangeExtend(b)};SocialCalc.RangeExtend=function(j,h){var l,m,k,i,o,c,g;var e=j.context.highlights;var d=j.range;var n=j.range2;var b;if(h){b=SocialCalc.coordToCr(h);b.coord=h}else{b=j.ecell}if(!b){return}if(SocialCalc.Constants.SCNoRanging){return}if(!d.hasrange){d.anchorcoord=b.coord;d.anchorrow=b.row;d.top=b.row;d.bottom=b.row;d.anchorcol=b.col;d.left=b.col;d.right=b.col;d.hasrange=true}if(d.anchorrow<b.row){d.top=d.anchorrow;d.bottom=b.row}else{d.top=b.row;d.bottom=d.anchorrow}if(d.anchorcol<b.col){d.left=d.anchorcol;d.right=b.col}else{d.left=b.col;d.right=d.anchorcol}for(i in e){switch(e[i]){case"range":e[i]="unrange";break;case"range2":e[i]="unrange2";break}}for(o=d.top;o<=d.bottom;o++){for(c=d.left;c<=d.right;c++){i=SocialCalc.crToCoord(c,o);switch(e[i]){case"unrange":e[i]="range";break;case"cursor":break;case"unrange2":default:e[i]="newrange";break}}}for(o=n.top;n.hasrange&&o<=n.bottom;o++){for(c=n.left;c<=n.right;c++){i=SocialCalc.crToCoord(c,o);switch(e[i]){case"unrange2":e[i]="range2";break;case"range":case"newrange":case"cursor":break;default:e[i]="newrange2";break}}}for(i in e){switch(e[i]){case"unrange":delete e[i];break;case"newrange":e[i]="range";break;case"newrange2":e[i]="range2";break;case"range":case"range2":case"cursor":continue}k=SocialCalc.coordToCr(i);m=SocialCalc.GetEditorCellElement(j,k.row,k.col);j.UpdateCellCSS(m,k.row,k.col)}for(g in j.RangeChangeCallback){j.RangeChangeCallback[g](j)}i=SocialCalc.crToCoord(j.range.left,j.range.top);if(j.range.left!=j.range.right||j.range.top!=j.range.bottom){i+=":"+SocialCalc.crToCoord(j.range.right,j.range.bottom)}for(g in j.StatusCallback){j.StatusCallback[g].func(j,"rangechange",i,j.StatusCallback[g].params)}return};SocialCalc.RangeRemove=function(g){var i,h,c,k,a,e;var d=g.context.highlights;var b=g.range;var j=g.range2;if(!b.hasrange&&!j.hasrange){return}for(k=j.top;j.hasrange&&k<=j.bottom;k++){for(a=j.left;a<=j.right;a++){c=SocialCalc.crToCoord(a,k);switch(d[c]){case"range":d[c]="newrange2";break;case"range2":case"cursor":break;default:d[c]="newrange2";break}}}for(c in d){switch(d[c]){case"range":delete d[c];break;case"newrange2":d[c]="range2";break;case"cursor":continue}h=SocialCalc.coordToCr(c);i=SocialCalc.GetEditorCellElement(g,h.row,h.col);g.UpdateCellCSS(i,h.row,h.col)}b.hasrange=false;for(e in g.RangeChangeCallback){g.RangeChangeCallback[e](g)}for(e in g.StatusCallback){g.StatusCallback[e].func(g,"rangechange","",g.StatusCallback[e].params)}return};SocialCalc.Range2Remove=function(e){var h,g,b,j,a,d;var c=e.context.highlights;var i=e.range2;if(!i.hasrange){return}for(b in c){switch(c[b]){case"range2":delete c[b];break;case"range":case"cursor":continue}g=SocialCalc.coordToCr(b);h=SocialCalc.GetEditorCellElement(e,g.row,g.col);e.UpdateCellCSS(h,g.row,g.col)}i.hasrange=false;return};SocialCalc.FitToEditTable=function(h){var a,e,i,j,g,k,l;var c=h.context;var b=c.sheetobj;var d=b.colattribs;j=c.showRCHeaders?c.rownamewidth-0:0;for(colpane=0;colpane<c.colpanes.length-1;colpane++){for(a=c.colpanes[colpane].first;a<=c.colpanes[colpane].last;a++){e=SocialCalc.rcColname(a);i=b.colattribs.width[e]||b.attribs.defaultcolwidth||SocialCalc.Constants.defaultColWidth;if(i=="blank"||i=="auto"){i=""}j+=(i&&((i-0)>0))?(i-0):10}}for(a=c.colpanes[colpane].first;a<=10000;a++){e=SocialCalc.rcColname(a);i=b.colattribs.width[e]||b.attribs.defaultcolwidth||SocialCalc.Constants.defaultColWidth;if(i=="blank"||i=="auto"){i=""}j+=(i&&((i-0)>0))?(i-0):10;if(j>h.tablewidth){break}}c.colpanes[colpane].last=a;g=c.showRCHeaders?1:0;for(k=0;k<c.rowpanes.length-1;k++){g+=c.rowpanes[k].last-c.rowpanes[k].first+1}l=h.tableheight-g*c.pixelsPerRow;c.rowpanes[k].last=c.rowpanes[k].first+Math.floor(l/c.pixelsPerRow)+1};SocialCalc.CalculateEditorPositions=function(d){var a,c,b;d.gridposition=SocialCalc.GetElementPosition(d.griddiv);d.headposition=SocialCalc.GetElementPosition(d.griddiv.firstChild.lastChild.childNodes[2].childNodes[1]);d.rowpositions=[];for(a=0;a<d.context.rowpanes.length;a++){d.CalculateRowPositions(a,d.rowpositions,d.rowheight)}for(b=0;b<d.rowpositions.length;b++){if(d.rowpositions[b]>d.gridposition.top+d.tableheight){break}}d.lastvisiblerow=b-1;d.colpositions=[];for(c=0;c<d.context.colpanes.length;c++){d.CalculateColPositions(c,d.colpositions,d.colwidth)}for(b=0;b<d.colpositions.length;b++){if(d.colpositions[b]>d.gridposition.left+d.tablewidth){break}}d.lastvisiblecol=b-1;d.firstscrollingrow=d.context.rowpanes[d.context.rowpanes.length-1].first;d.firstscrollingrowtop=d.rowpositions[d.firstscrollingrow]||d.headposition.top;d.lastnonscrollingrow=d.context.rowpanes.length-1>0?d.context.rowpanes[d.context.rowpanes.length-2].last:0;d.firstscrollingcol=d.context.colpanes[d.context.colpanes.length-1].first;d.firstscrollingcolleft=d.colpositions[d.firstscrollingcol]||d.headposition.left;d.lastnonscrollingcol=d.context.colpanes.length-1>0?d.context.colpanes[d.context.colpanes.length-2].last:0;d.verticaltablecontrol.ComputeTableControlPositions();d.horizontaltablecontrol.ComputeTableControlPositions()};SocialCalc.ScheduleRender=function(a){if(a.timeout){window.clearTimeout(a.timeout)}SocialCalc.EditorSheetStatusCallback(null,"schedrender",null,a);SocialCalc.EditorStepInfo.editor=a;a.timeout=window.setTimeout(SocialCalc.DoRenderStep,1)};SocialCalc.DoRenderStep=function(){var a=SocialCalc.EditorStepInfo.editor;a.timeout=null;a.EditorRenderSheet();SocialCalc.EditorSheetStatusCallback(null,"renderdone",null,a);SocialCalc.EditorSheetStatusCallback(null,"schedposcalc",null,a);a.timeout=window.setTimeout(SocialCalc.DoPositionCalculations,1)};SocialCalc.SchedulePositionCalculations=function(a){SocialCalc.EditorStepInfo.editor=a;SocialCalc.EditorSheetStatusCallback(null,"schedposcalc",null,a);a.timeout=window.setTimeout(SocialCalc.DoPositionCalculations,1)};SocialCalc.DoPositionCalculations=function(){var b=SocialCalc.EditorStepInfo.editor;b.timeout=null;var a=false;try{b.CalculateEditorPositions();a=true}catch(c){}if(!a){if(typeof $!="undefined"){$(window).trigger("resize");setTimeout(SocialCalc.DoPositionCalculations,400)}return}b.verticaltablecontrol.PositionTableControlElements();b.horizontaltablecontrol.PositionTableControlElements();SocialCalc.EditorSheetStatusCallback(null,"doneposcalc",null,b);if(b.ensureecell&&b.ecell&&!b.deferredCommands.length){b.ensureecell=false;b.EnsureECellVisible()}b.cellhandles.ShowCellHandles(true);if(SocialCalc.Callbacks.broadcast){SocialCalc.Callbacks.broadcast("ask.ecell")}};SocialCalc.CalculateRowPositions=function(g,a,e,n){var j,k,l,d,i,m;var c=g.context;var b=c.sheetobj;var h;if(!c.showRCHeaders){throw ("Needs showRCHeaders=true")}h=g.fullgrid.lastChild;j=2;for(k=0;k<a;k++){j+=c.rowpanes[k].last-c.rowpanes[k].first+2}d=0;for(l=c.rowpanes[k].first;l<=c.rowpanes[k].last;l++){i=h.childNodes[j+d];d++;m=SocialCalc.GetElementPosition(i.firstChild);if(!e[l]){e[l]=m.top;n[l]=i.firstChild.offsetHeight}}return};SocialCalc.CalculateColPositions=function(h,a,g,n){var l,i,b,e,k,m;var d=h.context;var c=d.sheetobj;var j;if(!d.showRCHeaders){throw ("Needs showRCHeaders=true")}j=h.fullgrid.lastChild;l=1;for(i=0;i<a;i++){l+=d.colpanes[i].last-d.colpanes[i].first+2}k=j.childNodes[1];e=0;for(b=d.colpanes[i].first;b<=d.colpanes[i].last;b++){m=SocialCalc.GetElementPosition(k.childNodes[l+e]);if(!g[b]){g[b]=m.left;if(k.childNodes[l+e]){n[b]=k.childNodes[l+e].offsetWidth}}e++}return};SocialCalc.ScrollRelative=function(c,a,b){if(a){c.ScrollRelativeBoth(b,0)}else{c.ScrollRelativeBoth(0,b)}return};SocialCalc.ScrollRelativeBoth=function(d,g,a){var c=d.context;var i=c.rowpanes.length;var e=i>1?c.rowpanes[i-2].last+1:1;if(c.rowpanes[i-1].first+g<e){g=(-c.rowpanes[i-1].first)+e}var b=c.colpanes.length;var h=b>1?c.colpanes[b-2].last+1:1;if(c.colpanes[b-1].first+a<h){a=(-c.colpanes[b-1].first)+h}if(SocialCalc.IsScrollPossible&&!SocialCalc.IsScrollPossible(d.context.sheetobj.attribs.lastrow,d.context.sheetobj.attribs.lastcol,c.rowpanes[i-1].first,c.colpanes[b-1].first,g,a)){return}if((g==1||g==-1)&&a==0){if(g==1){d.ScrollTableUpOneRow()}else{d.ScrollTableDownOneRow()}if(d.ecell){d.SetECellHeaders("selected")}d.SchedulePositionCalculations();return}if(g!=0||a!=0){c.rowpanes[i-1].first+=g;c.rowpanes[i-1].last+=g;c.colpanes[b-1].first+=a;c.colpanes[b-1].last+=a;d.FitToEditTable();d.ScheduleRender()}};SocialCalc.PageRelative=function(e,b,l){var a=e.context;var k=b?"rowpanes":"colpanes";var h=a[k][a[k].length-1];var i=b?"lastvisiblerow":"lastvisiblecol";var j=b?e.rowheight:e.colwidth;var d=b?SocialCalc.Constants.defaultAssumedRowHeight:SocialCalc.Constants.defaultColWidth;var n,m,c,g;if(l>0){m=e[i];if(m==h.first){m+=1}}else{if(b){c=e.tableheight-(e.firstscrollingrowtop-e.gridposition.top)}else{c=e.tablewidth-(e.firstscrollingcolleft-e.gridposition.left)}c-=j[e[i]]>0?j[e[i]]:d;for(m=h.first-1;m>0;m--){n=j[m]>0?j[m]:d;if(c<n){break}c-=n}g=h.first;if(m>=g){m=g-1}if(m<1){m=1}}h.first=m;h.last=m+1;e.LimitLastPanes();e.FitToEditTable();e.ScheduleRender()};SocialCalc.LimitLastPanes=function(c){var a=c.context;var b;b=a.rowpanes.length;if(b>1&&a.rowpanes[b-1].first<=a.rowpanes[b-2].last){a.rowpanes[b-1].first=a.rowpanes[b-2].last+1}b=a.colpanes.length;if(b>1&&a.colpanes[b-1].first<=a.colpanes[b-2].last){a.colpanes[b-1].first=a.colpanes[b-2].last+1}};SocialCalc.ScrollTableUpOneRow=function(e){var k,l,i,a,s,b,p,c,h,n,r,o;var g={};var d=e.context;var j=d.sheetobj;var m=e.fullgrid;var q;q=m.lastChild;k=d.showRCHeaders?2:1;for(l=0;l<d.rowpanes.length-1;l++){k+=d.rowpanes[l].last-d.rowpanes[l].first+2}q.removeChild(q.childNodes[k]);d.rowpanes[l].first++;d.rowpanes[l].last++;e.FitToEditTable();d.CalculateColWidthData();h=d.RenderRow(d.rowpanes[l].last,l);q.appendChild(h);maxrowspan=1;p=d.rowpanes[l].first-1;for(s=0;s<d.colpanes.length;s++){for(a=d.colpanes[s].first;a<=d.colpanes[s].last;a++){coord=SocialCalc.crToCoord(a,p);if(d.cellskip[coord]){continue}b=j.cells[coord];if(b&&b.rowspan>maxrowspan){maxrowspan=b.rowspan}}}if(maxrowspan>1){for(i=1;i<maxrowspan;i++){if(i+p>=d.rowpanes[l].last){break}n=d.RenderRow(i+p,l);r=q.childNodes[k+i-1];q.replaceChild(n,r)}}o=d.rowpanes[l].last;for(s=0;s<d.colpanes.length;s++){for(a=d.colpanes[s].first;a<=d.colpanes[s].last;a++){coord=d.cellskip[SocialCalc.crToCoord(a,o)];if(!coord){continue}i=d.coordToCR[coord].row-0;if(i==d.rowpanes[l].last||i<d.rowpanes[l].first){continue}b=j.cells[coord];if(b&&b.rowspan>1){g[i]=true}}}for(i in g){n=d.RenderRow(i,l);r=q.childNodes[(k+(i-d.rowpanes[l].first))];q.replaceChild(n,r)}return m};SocialCalc.ScrollTableDownOneRow=function(g){var l,m,j,a,s,b,e,c,i,o,r,p;var h={};var d=g.context;var k=d.sheetobj;var n=g.fullgrid;var q;q=n.lastChild;l=d.showRCHeaders?2:1;for(m=0;m<d.rowpanes.length-1;m++){l+=d.rowpanes[m].last-d.rowpanes[m].first+2}q.removeChild(q.childNodes[l+(d.rowpanes[m].last-d.rowpanes[m].first)]);d.rowpanes[m].first--;d.rowpanes[m].last--;g.FitToEditTable();d.CalculateColWidthData();o=d.RenderRow(d.rowpanes[m].first,m);q.insertBefore(o,q.childNodes[l]);maxrowspan=1;e=d.rowpanes[m].first;for(s=0;s<d.colpanes.length;s++){for(a=d.colpanes[s].first;a<=d.colpanes[s].last;a++){coord=SocialCalc.crToCoord(a,e);if(d.cellskip[coord]){continue}b=k.cells[coord];if(b&&b.rowspan>maxrowspan){maxrowspan=b.rowspan}}}if(maxrowspan>1){for(j=1;j<maxrowspan;j++){if(j+e>d.rowpanes[m].last){break}o=d.RenderRow(j+e,m);r=q.childNodes[l+j];q.replaceChild(o,r)}}p=d.rowpanes[m].last;for(s=0;s<d.colpanes.length;s++){for(a=d.colpanes[s].first;a<=d.colpanes[s].last;a++){coord=SocialCalc.crToCoord(a,p);b=k.cells[coord];if(b&&b.rowspan>1){h[p]=true;continue}coord=d.cellskip[SocialCalc.crToCoord(a,p)];if(!coord){continue}j=d.coordToCR[coord].row-0;if(j==p||j<d.rowpanes[m].first){continue}b=k.cells[coord];if(b&&b.rowspan>1){h[j]=true}}}for(j in h){o=d.RenderRow(j,m);r=q.childNodes[(l+(j-d.rowpanes[m].first))];q.replaceChild(o,r)}return n};SocialCalc.InputBox=function(a,b){if(!a){return}this.element=a;this.editor=b;this.inputEcho=null;b.inputBox=this;a.onmousedown=SocialCalc.InputBoxOnMouseDown;b.MoveECellCallback.formulabar=function(c){if(c.state!="start"){return}b.inputBox.DisplayCellContents(c.ecell.coord)}};SocialCalc.InputBox.prototype.DisplayCellContents=function(a){SocialCalc.InputBoxDisplayCellContents(this,a)};SocialCalc.InputBox.prototype.ShowInputBox=function(a){this.editor.inputEcho.ShowInputEcho(a)};SocialCalc.InputBox.prototype.GetText=function(){return this.element.value};SocialCalc.InputBox.prototype.SetText=function(a){if(!this.element){return}this.element.value=a;if(!SocialCalc.Constants.SCNoInputEcho){this.editor.inputEcho.SetText(a+"_")}};SocialCalc.InputBox.prototype.Focus=function(){SocialCalc.InputBoxFocus(this)};SocialCalc.InputBox.prototype.Blur=function(){return this.element.blur()};SocialCalc.InputBox.prototype.Select=function(b){if(!this.element){return}switch(b){case"end":if(document.selection&&document.selection.createRange){var a=document.selection.createRange().duplicate();a.moveToElementText(this.element);a.collapse(false);a.select()}else{if(this.element.selectionStart!=undefined){this.element.selectionStart=this.element.value.length;this.element.selectionEnd=this.element.value.length}}break}};SocialCalc.InputBoxDisplayCellContents=function(e,h){var d=SocialCalc.Constants;if(!e){return}if(!h){h=e.editor.ecell.coord}var k=SocialCalc.GetCellContents(e.editor.context.sheetobj,h);if(k.indexOf("\n")!=-1){k=d.s_inputboxdisplaynoteditable;e.element.disabled=true;SocialCalc.ToggleInputLineButtons(false)}else{if(!SocialCalc.Callbacks.IsCellEditable(e.editor)){k=d.s_inputboxdisplaynoteditable;SocialCalc.ToggleInputLineButtons(false);e.element.disabled=true;e.element.style.display="none"}else{var g=SocialCalc.GetCurrentWorkBookControl();var b=g.workbook.spreadsheet;cell=SocialCalc.GetEditorCellElement(e.editor,e.editor.ecell.row,e.editor.ecell.col);var c="100px";var i="100px";var a=100;if(cell){position=SocialCalc.GetElementPosition(cell.element);console.log("left="+position.left+",top="+position.top);c=(position.left-4)+"px";i=(position.top-3)+"px";a=cell.element.offsetWidth}else{SocialCalc.ToggleInputLineButtons(false);e.element.disabled=true;e.element.style.display="none";return}var l=document.getElementById(b.formulabarDiv.id);if(l){b.spreadsheetDiv.removeChild(b.formulabarDiv)}b.formulabarDiv.style.left=c;b.formulabarDiv.style.top=i;b.formulabarDiv.style.zIndex=100;b.formulabarDiv.style.position="absolute";var j=b.formulabarDiv.firstChild;j.style.fontSize="100%";j.style.borderBottomColor="#306eff";j.style.borderBottomLeftRadius="3px";j.style.borderBottomRightRadius="3px";j.style.borderBottomStyle="solid";j.style.borderBottomWidth="2px";j.style.borderLeftColor="#306eff";j.style.borderLeftStyle="solid";j.style.borderLeftWidth="2px";j.style.borderRightColor="#306eff";j.style.borderRightStyle="solid";j.style.borderRightWidth="2px";j.style.borderTopColor="#306eff";j.style.borderTopLeftRadius="3px";j.style.borderTopRightRadius="3px";j.style.borderTopStyle="solid";j.style.borderTopWidth="2px";j.size=""+(a/9);b.spreadsheetDiv.appendChild(b.formulabarDiv);e.element.disabled=false;e.element.style.display="inline";SocialCalc.ToggleInputLineButtons(true)}}if(d.SCNoQuoteInInputBox&&(k.substring(0,1)=="'")){k=k.substring(1)}e.SetText(k)};SocialCalc.InputBoxFocus=function(c){if(!c){return}c.element.focus();var b=c.editor;b.state="input";var a=b.workingvalues;a.partialexpr="";a.ecoord=b.ecell.coord;a.erow=b.ecell.row;a.ecol=b.ecell.col};SocialCalc.InputBoxOnMouseDown=function(c){var b=SocialCalc.Keyboard.focusTable;if(!b){return true}var a=b.workingvalues;switch(b.state){case"start":b.state="inputboxdirect";a.partialexpr="";a.ecoord=b.ecell.coord;a.erow=b.ecell.row;a.ecol=b.ecell.col;b.inputEcho.ShowInputEcho(true);break;case"input":a.partialexpr="";b.MoveECell(a.ecoord);b.state="inputboxdirect";SocialCalc.KeyboardFocus();break;case"inputboxdirect":break}};SocialCalc.InputEcho=function(b){var a=SocialCalc.Constants;this.editor=b;this.text="";this.interval=null;this.container=null;this.main=null;this.prompt=null;this.functionbox=null;this.container=document.createElement("div");SocialCalc.setStyles(this.container,"display:none;position:absolute;zIndex:10;");this.topprompt=document.createElement("div");if(a.defaultInputEchoPromptClass){this.topprompt.className=a.defaultInputEchoPromptClass}if(a.defaultInputEchoPromptStyle){SocialCalc.setStyles(this.topprompt,a.defaultInputEchoPromptStyle)}this.topprompt.innerHTML="";this.container.appendChild(this.topprompt);this.main=document.createElement("div");if(a.defaultInputEchoClass){this.main.className=a.defaultInputEchoClass}if(a.defaultInputEchoStyle){SocialCalc.setStyles(this.main,a.defaultInputEchoStyle)}this.main.innerHTML="&nbsp;";this.container.appendChild(this.main);this.prompt=document.createElement("div");if(a.defaultInputEchoPromptClass){this.prompt.className=a.defaultInputEchoPromptClass}if(a.defaultInputEchoPromptStyle){SocialCalc.setStyles(this.prompt,a.defaultInputEchoPromptStyle)}this.prompt.innerHTML="";this.container.appendChild(this.prompt);SocialCalc.DragRegister(this.main,true,true,{MouseDown:SocialCalc.DragFunctionStart,MouseMove:SocialCalc.DragFunctionPosition,MouseUp:SocialCalc.DragFunctionPosition,Disabled:null,positionobj:this.container});b.toplevel.appendChild(this.container)};SocialCalc.InputEcho.prototype.ShowInputEcho=function(a){return SocialCalc.ShowInputEcho(this,a)};SocialCalc.InputEcho.prototype.SetText=function(a){return SocialCalc.SetInputEchoText(this,a)};SocialCalc.ShowInputEcho=function(e,c){var b,a;var d=e.editor;if(!d){return}if(SocialCalc.Constants.SCNoInputEcho){return}if(c){d.cellhandles.ShowCellHandles(false);b=SocialCalc.GetEditorCellElement(d,d.ecell.row,d.ecell.col);if(b){a=SocialCalc.GetElementPosition(b.element);e.container.style.left=(a.left-1)+"px";e.container.style.top=(a.top-1)+"px"}e.container.style.display="block";if(e.interval){window.clearInterval(e.interval)}e.interval=window.setInterval(SocialCalc.InputEchoHeartbeat,50)}else{if(e.interval){window.clearInterval(e.interval)}e.container.style.display="none";e.topprompt.innerHTML=""}};SocialCalc.SetInputEchoText=function(e,j){if(SocialCalc.Constants.SCNoInputEcho){return}var c=SocialCalc.Constants;var b,a;var i=SocialCalc.special_chars(j);i=i.replace(/\n/g,"<br>");if(e.text!=i){e.main.innerHTML=i;e.text=i}var g=j.match(/.*[\+\-\*\/\&\^\<\>\=\,\(]([A-Za-z][A-ZA-z]\w*?)\([^\)]*$/);if(j.charAt(0)=="="&&g){b=g[1].toUpperCase();if(SocialCalc.Formula.FunctionList[b]){SocialCalc.Formula.FillFunctionInfo();a=SocialCalc.special_chars(b+"("+SocialCalc.Formula.FunctionArgString(b)+")")}else{a=c.ietUnknownFunction+b}if(e.prompt.innerHTML!=a){e.prompt.innerHTML=a;e.prompt.style.display="block"}}else{if(e.prompt.style.display!="none"){e.prompt.innerHTML="";e.prompt.style.display="none"}}var h=e.editor;if(h.workingvalues.currentsheet!=h.workingvalues.startsheet){var d="Editing:"+h.workingvalues.startsheet+"!"+h.workingvalues.ecoord;if(d!=e.topprompt.innerHTML){e.topprompt.innerHTML="Editing:"+h.workingvalues.startsheet+"!"+h.workingvalues.ecoord;e.topprompt.style.display="block"}}else{if(e.topprompt.style.display!="none"){e.topprompt.innerHTML="";e.topprompt.style.display="none"}}};SocialCalc.InputEchoHeartbeat=function(){var a=SocialCalc.Keyboard.focusTable;if(!a){return true}if(SocialCalc.Constants.SCNoInputEcho){return}if(a.state=="inputboxdirect"){a.inputEcho.SetText(a.inputBox.GetText()+"_")}};SocialCalc.InputEchoMouseDown=function(c){var b=c||window.event;var a=SocialCalc.Keyboard.focusTable;if(!a){return true}if(SocialCalc.Constants.SCNoInputEcho){return}a.inputBox.element.focus()};SocialCalc.CellHandles=function(c){var b=SocialCalc.Constants;var d;if(c.noEdit){return}if(b.SCCellHandlesDisable){return}this.editor=c;this.noCursorSuffix=false;this.movedmouse=false;this.draghandle=document.createElement("div");SocialCalc.setStyles(this.draghandle,"display:none;position:absolute;zIndex:8;border:1px solid white;width:4px;height:4px;fontSize:1px;backgroundColor:#0E93D8;cursor:default;");this.draghandle.innerHTML="&nbsp;";c.toplevel.appendChild(this.draghandle);SocialCalc.AssignID(c,this.draghandle,"draghandle");var a="png";if(navigator.userAgent.match(/MSIE 6\.0/)){a="gif"}this.dragpalette=document.createElement("div");SocialCalc.setStyles(this.dragpalette,"display:none;position:absolute;zIndex:8;width:90px;height:90px;fontSize:1px;textAlign:center;cursor:default;backgroundImage:url("+SocialCalc.Constants.defaultImagePrefix+"drag-handles."+a+");");this.dragpalette.innerHTML="&nbsp;";c.toplevel.appendChild(this.dragpalette);SocialCalc.AssignID(c,this.dragpalette,"dragpalette");this.dragtooltip=document.createElement("div");SocialCalc.setStyles(this.dragtooltip,"display:none;position:absolute;zIndex:9;border:1px solid black;width:100px;height:auto;fontSize:10px;backgroundColor:#FFFFFF;");this.dragtooltip.innerHTML="&nbsp;";c.toplevel.appendChild(this.dragtooltip);SocialCalc.AssignID(c,this.dragtooltip,"dragtooltip");this.fillinghandle=document.createElement("div");SocialCalc.setStyles(this.fillinghandle,"display:none;position:absolute;zIndex:9;border:1px solid black;width:auto;height:14px;fontSize:10px;backgroundColor:#FFFFFF;");this.fillinghandle.innerHTML="&nbsp;";c.toplevel.appendChild(this.fillinghandle);SocialCalc.AssignID(c,this.fillinghandle,"fillinghandle");if(this.draghandle.addEventListener){this.draghandle.addEventListener("mousemove",SocialCalc.CellHandlesMouseMoveOnHandle,false);this.dragpalette.addEventListener("mousedown",SocialCalc.CellHandlesMouseDown,false);this.dragpalette.addEventListener("mousemove",SocialCalc.CellHandlesMouseMoveOnHandle,false)}else{if(this.draghandle.attachEvent){this.draghandle.attachEvent("onmousemove",SocialCalc.CellHandlesMouseMoveOnHandle);this.dragpalette.attachEvent("onmousedown",SocialCalc.CellHandlesMouseDown);this.dragpalette.attachEvent("onmousemove",SocialCalc.CellHandlesMouseMoveOnHandle)}else{throw"Browser not supported"}}};SocialCalc.CellHandles.prototype.ShowCellHandles=function(a,b){return SocialCalc.ShowCellHandles(this,a,b)};SocialCalc.ShowCellHandles=function(g,j,h){var l,i,c,b;var d=g.editor;var k=false;var m,a,e;if(!d){return}do{if(!j){break}m=d.ecell.row;a=d.ecell.col;if(d.state!="start"){break}if(m>=d.lastvisiblerow){break}if(a>=d.lastvisiblecol){break}if(m<d.firstscrollingrow){break}if(a<d.firstscrollingcol){break}if(d.rowpositions[m+1]+20>d.horizontaltablecontrol.controlborder){break}if(d.rowpositions[m+1]-10<d.headposition.top){break}if(d.colpositions[a+1]+20>d.verticaltablecontrol.controlborder){break}if(d.colpositions[a+1]-30<d.headposition.left){break}g.draghandle.style.left=(d.colpositions[a+1]-1)+"px";g.draghandle.style.top=(d.rowpositions[m+1]-1)+"px";g.draghandle.style.display="block";if(h){g.draghandle.style.display="none";g.dragpalette.style.left=(d.colpositions[a+1]-45)+"px";g.dragpalette.style.top=(d.rowpositions[m+1]-45)+"px";g.dragpalette.style.display="block";e=SocialCalc.GetViewportInfo();g.dragtooltip.style.right=(e.width-(d.colpositions[a+1]-1))+"px";g.dragtooltip.style.bottom=(e.height-(d.rowpositions[m+1]-1))+"px";g.dragtooltip.style.display="none"}k=true}while(false);if(!k){g.draghandle.style.display="none"}if(!h){g.dragpalette.style.display="none";g.dragtooltip.style.display="none"}};SocialCalc.CellHandlesMouseMoveOnHandle=function(h){var g=SocialCalc.Constants;var a=h||window.event;var i=a.target||a.srcElement;var j=SocialCalc.GetViewportInfo();var c=a.clientX+j.horizontalScroll;var b=a.clientY+j.verticalScroll;editor=SocialCalc.Keyboard.focusTable;if(!editor){return true}var k=editor.cellhandles;if(!k.editor){return true}if(!editor.cellhandles.mouseDown){editor.cellhandles.ShowCellHandles(true,true);if(i==k.dragpalette){var d=SocialCalc.SegmentDivHit([g.CH_radius1,g.CH_radius2],editor.cellhandles.dragpalette,c,b);if(d==0){SocialCalc.CellHandlesHoverTimeout();return}if(k.tooltipstimer){window.clearTimeout(k.tooltipstimer);k.tooltipstimer=null}k.tooltipswhichhandle=d;k.tooltipstimer=window.setTimeout(SocialCalc.CellHandlesTooltipsTimeout,700)}if(k.timer){window.clearTimeout(k.timer);k.timer=null}k.timer=window.setTimeout(SocialCalc.CellHandlesHoverTimeout,3000)}return};SocialCalc.SegmentDivHit=function(d,j,h,e){var a=j.offsetWidth;var k=j.offsetHeight;var b=j.offsetLeft;var g=j.offsetTop;var i=0;var l=d;var c=Math.sqrt(Math.pow(h-b-(a/2-0.5),2)+Math.pow(e-g-(k/2-0.5),2));if(l.length==2){if(h>=b&&h<b+a/2&&e>=g&&e<g+k/2){if(c<=d[0]){i=-1}else{if(c<=d[1]){i=1}}}if(h>=b+a/2&&h<b+a&&e>=g&&e<g+k/2){if(c<=d[0]){i=-2}else{if(c<=d[1]){i=2}}}if(h>=b+a/2&&h<b+a&&e>=g+k/2&&e<g+k){if(c<=d[0]){i=-3}else{if(c<=d[1]){i=3}}}if(h>=b&&h<b+a/2&&e>=g+k/2&&e<g+k){if(c<=d[0]){i=-4}else{if(c<=d[1]){i=4}}}return i}while(true){if(h>=b&&h<b+a/2&&e>=g&&e<g+k/2){quadrant+="1";i=l[0];if(typeof i=="number"){break}l=i;a=a/2;k=k/2;continue}if(h>=b+a/2&&h<b+a&&e>=g&&e<g+k/2){quadrant+="2";i=l[1];if(typeof i=="number"){break}l=i;a=a/2;b=b+a;k=k/2;continue}if(h>=b+a/2&&h<b+a&&e>=g+k/2&&e<g+k){quadrant+="3";i=l[2];if(typeof i=="number"){break}l=i;a=a/2;b=b+a;k=k/2;g=g+k;continue}if(h>=b&&h<b+a/2&&e>=g+k/2&&e<g+k){quadrant+="4";i=l[3];if(typeof i=="number"){break}l=i;a=a/2;k=k/2;g=g+k;continue}return 0}return i};SocialCalc.CellHandlesHoverTimeout=function(){editor=SocialCalc.Keyboard.focusTable;if(!editor){return true}var a=editor.cellhandles;if(a.timer){window.clearTimeout(a.timer);a.timer=null}if(a.tooltipstimer){window.clearTimeout(a.tooltipstimer);a.tooltipstimer=null}editor.cellhandles.ShowCellHandles(true,false)};SocialCalc.CellHandlesTooltipsTimeout=function(){editor=SocialCalc.Keyboard.focusTable;if(!editor){return true}var b=editor.cellhandles;if(b.tooltipstimer){window.clearTimeout(b.tooltipstimer);b.tooltipstimer=null}var a=b.tooltipswhichhandle;if(a==0){SocialCalc.CellHandlesHoverTimeout();return}if(a==-3){b.dragtooltip.innerHTML=scc.s_CHfillAllTooltip}else{if(a==3){b.dragtooltip.innerHTML=scc.s_CHfillContentsTooltip}else{if(a==-2){b.dragtooltip.innerHTML=scc.s_CHmovePasteAllTooltip}else{if(a==-4){b.dragtooltip.innerHTML=scc.s_CHmoveInsertAllTooltip}else{if(a==2){b.dragtooltip.innerHTML=scc.s_CHmovePasteContentsTooltip}else{if(a==4){b.dragtooltip.innerHTML=scc.s_CHmoveInsertContentsTooltip}else{b.dragtooltip.innerHTML="&nbsp;";b.dragtooltip.style.display="none";return}}}}}}b.dragtooltip.style.display="block"};SocialCalc.CellHandlesMouseDown=function(n){var h=SocialCalc.Constants;var l,q,k,p,d,j;var b=n||window.event;var m=SocialCalc.GetViewportInfo();var c=b.clientX+m.horizontalScroll;var a=b.clientY+m.verticalScroll;var i=SocialCalc.EditorMouseInfo;l=SocialCalc.Keyboard.focusTable;if(!l){return true}if(l.busy){return}var o=l.cellhandles;o.movedmouse=false;if(o.timer){window.clearTimeout(o.timer);o.timer=null}if(o.tooltipstimer){window.clearTimeout(o.tooltipstimer);o.tooltipstimer=null}o.dragtooltip.innerHTML="&nbsp;";o.dragtooltip.style.display="none";j=l.range;var g=SocialCalc.SegmentDivHit([h.CH_radius1,h.CH_radius2],l.cellhandles.dragpalette,c,a);if(g==1||g==-1||g==0){o.ShowCellHandles(true,false);return}i.ignore=true;if(g==-3){o.dragtype="Fill";o.noCursorSuffix=false}else{if(g==3){o.dragtype="FillC";o.noCursorSuffix=false}else{if(g==-2){o.dragtype="Move";o.noCursorSuffix=true}else{if(g==-4){o.dragtype="MoveI";o.noCursorSuffix=false}else{if(g==2){o.dragtype="MoveC";o.noCursorSuffix=true}else{if(g==4){o.dragtype="MoveIC";o.noCursorSuffix=false}}}}}}o.filltype=null;switch(o.dragtype){case"Fill":case"FillC":if(!j.hasrange){l.RangeAnchor()}break;case"Move":case"MoveI":case"MoveC":case"MoveIC":if(!j.hasrange){l.RangeAnchor()}l.range2.top=l.range.top;l.range2.right=l.range.right;l.range2.bottom=l.range.bottom;l.range2.left=l.range.left;l.range2.hasrange=true;l.RangeRemove();break;default:return}o.fillinghandle.style.left=(c)+"px";o.fillinghandle.style.top=(a-17)+"px";o.fillinghandle.innerHTML=h.s_CHindicatorOperationLookup[o.dragtype]+(h.s_CHindicatorDirectionLookup[l.cellhandles.filltype]||"");o.fillinghandle.style.display="block";o.ShowCellHandles(true,false);o.mouseDown=true;i.editor=l;k=l.ecell.coord;o.startingcoord=k;o.startingX=c;o.startingY=a;i.mouselastcoord=k;SocialCalc.KeyboardSetFocus(l);if(document.addEventListener){document.addEventListener("mousemove",SocialCalc.CellHandlesMouseMove,true);document.addEventListener("mouseup",SocialCalc.CellHandlesMouseUp,true)}else{if(o.draghandle.attachEvent){o.draghandle.setCapture();o.draghandle.attachEvent("onmousemove",SocialCalc.CellHandlesMouseMove);o.draghandle.attachEvent("onmouseup",SocialCalc.CellHandlesMouseUp);o.draghandle.attachEvent("onlosecapture",SocialCalc.CellHandlesMouseUp)}}if(b.stopPropagation){b.stopPropagation()}else{b.cancelBubble=true}if(b.preventDefault){b.preventDefault()}else{b.returnValue=false}return};SocialCalc.CellHandlesMouseMove=function(x){var h=SocialCalc.Constants;var g,b,l,t,d,m,s,q,u;var k,i,j,z,n;var v=x||window.event;var w=SocialCalc.GetViewportInfo();var p=v.clientX+w.horizontalScroll;var o=v.clientY+w.verticalScroll;var a=SocialCalc.EditorMouseInfo;g=a.editor;if(!g){return}var y=g.cellhandles;b=a.element;l=SocialCalc.GridMousePosition(g,p,o);if(!l){return}if(l&&!l.coord){SocialCalc.SetDragAutoRepeat(g,l,SocialCalc.CellHandlesDragAutoRepeat);return}SocialCalc.SetDragAutoRepeat(g,null);if(!l.coord){return}k=SocialCalc.coordToCr(g.cellhandles.startingcoord);i=SocialCalc.coordToCr(l.coord);y.movedmouse=true;switch(y.dragtype){case"Fill":case"FillC":if(l.coord==y.startingcoord){y.filltype=null;y.startingX=p;y.startingY=o}else{if(y.filltype){if(y.filltype=="Down"){i.col=k.col;if(i.row<k.row){i.row=k.row}}else{i.row=k.row;if(i.col<k.col){i.col=k.col}}}else{if(Math.abs(o-y.startingY)>10){y.filltype="Down"}else{if(Math.abs(p-y.startingX)>10){y.filltype="Right"}}i.col=k.col;i.row=k.row}}l.coord=SocialCalc.crToCoord(i.col,i.row);if(l.coord!=a.mouselastcoord){g.MoveECell(l.coord);g.RangeExtend()}break;case"Move":case"MoveC":if(l.coord!=a.mouselastcoord){g.MoveECell(l.coord);z=g.range2.right-g.range2.left+l.col;n=g.range2.bottom-g.range2.top+l.row;g.RangeAnchor(SocialCalc.crToCoord(z,n));g.RangeExtend()}break;case"MoveI":case"MoveIC":if(l.coord==y.startingcoord){y.filltype=null;y.startingX=p;y.startingY=o}else{if(y.filltype){if(y.filltype=="Vertical"){i.col=g.range2.left;if(i.row>=g.range2.top&&i.row<=g.range2.bottom+1){i.row=g.range2.bottom+2}}else{i.row=g.range2.top;if(i.col>=g.range2.left&&i.col<=g.range2.right+1){i.col=g.range2.right+2}}}else{if(Math.abs(o-y.startingY)>10){y.filltype="Vertical"}else{if(Math.abs(p-y.startingX)>10){y.filltype="Horizontal"}}i.col=k.col;i.row=k.row}}l.coord=SocialCalc.crToCoord(i.col,i.row);if(l.coord!=a.mouselastcoord){g.MoveECell(l.coord);if(!y.filltype){g.RangeRemove()}else{z=g.range2.right-g.range2.left+i.col;n=g.range2.bottom-g.range2.top+i.row;g.RangeAnchor(SocialCalc.crToCoord(z,n));g.RangeExtend()}}break}y.fillinghandle.style.left=(p)+"px";y.fillinghandle.style.top=(o-17)+"px";y.fillinghandle.innerHTML=h.s_CHindicatorOperationLookup[y.dragtype]+(h.s_CHindicatorDirectionLookup[g.cellhandles.filltype]||"");y.fillinghandle.style.display="block";a.mouselastcoord=l.coord;if(v.stopPropagation){v.stopPropagation()}else{v.cancelBubble=true}if(v.preventDefault){v.preventDefault()}else{v.returnValue=false}return};SocialCalc.CellHandlesDragAutoRepeat=function(g,k){var e=SocialCalc.EditorMouseInfo;var h=e.editor;if(!h){return}var i=h.cellhandles;var l=SocialCalc.coordToCr(h.cellhandles.startingcoord);var n=SocialCalc.coordToCr(g);var b,j,a;var m=0;var d=0;if(k=="left"){d=-1}else{if(k=="right"){d=1}else{if(k=="up"){m=-1}else{if(k=="down"){m=1}}}}h.ScrollRelativeBoth(m,d);switch(i.dragtype){case"Fill":case"FillC":if(i.filltype){if(i.filltype=="Down"){n.col=l.col;if(n.row<l.row){n.row=l.row}}else{n.row=l.row;if(n.col<l.col){n.col=l.col}}}else{n.col=l.col;n.row=l.row}b=SocialCalc.crToCoord(n.col,n.row);if(b!=e.mouselastcoord){h.MoveECell(g);h.RangeExtend()}break;case"Move":case"MoveC":if(g!=e.mouselastcoord){h.MoveECell(g);j=h.range2.right-h.range2.left+h.ecell.col;a=h.range2.bottom-h.range2.top+h.ecell.row;h.RangeAnchor(SocialCalc.crToCoord(j,a));h.RangeExtend()}break;case"MoveI":case"MoveIC":if(i.filltype){if(i.filltype=="Vertical"){n.col=h.range2.left;if(n.row>=h.range2.top&&n.row<=h.range2.bottom+1){n.row=h.range2.bottom+2}}else{n.row=h.range2.top;if(n.col>=h.range2.left&&n.col<=h.range2.right+1){n.col=h.range2.right+2}}}else{n.col=l.col;n.row=l.row}b=SocialCalc.crToCoord(n.col,n.row);if(b!=e.mouselastcoord){h.MoveECell(b);j=h.range2.right-h.range2.left+n.col;a=h.range2.bottom-h.range2.top+n.row;h.RangeAnchor(SocialCalc.crToCoord(j,a));h.RangeExtend()}break}e.mouselastcoord=b};SocialCalc.CellHandlesMouseUp=function(z){var g,c,n,v,d,p,t,s,w,m,k,o;var i,h;var j,a,u,l;var x=z||window.event;var y=SocialCalc.GetViewportInfo();var r=x.clientX+y.horizontalScroll;var q=x.clientY+y.verticalScroll;var b=SocialCalc.EditorMouseInfo;g=b.editor;if(!g){return}var A=g.cellhandles;c=b.element;b.ignore=false;n=SocialCalc.GridMousePosition(g,r,q);SocialCalc.SetDragAutoRepeat(g,null);A.mouseDown=false;A.noCursorSuffix=false;A.fillinghandle.style.display="none";if(!n){n={}}if(!n.coord){n.coord=g.ecell.coord}switch(A.dragtype){case"Fill":case"Move":case"MoveI":o=" all";break;case"FillC":case"MoveC":case"MoveIC":o=" formulas";break}if(!A.movedmouse){A.dragtype="Nothing"}switch(A.dragtype){case"Nothing":g.Range2Remove();g.RangeRemove();break;case"Fill":case"FillC":i=SocialCalc.coordToCr(A.startingcoord);h=SocialCalc.coordToCr(n.coord);if(A.filltype){if(A.filltype=="Down"){h.col=i.col}else{h.row=i.row}}n.coord=SocialCalc.crToCoord(h.col,h.row);g.MoveECell(n.coord);g.RangeExtend();if(g.cellhandles.filltype=="Right"){k="right"}else{k="down"}m="fill"+k+" "+SocialCalc.crToCoord(g.range.left,g.range.top)+":"+SocialCalc.crToCoord(g.range.right,g.range.bottom)+o;g.EditorScheduleSheetCommands(m,true,false);break;case"Move":case"MoveC":g.context.cursorsuffix="";m="movepaste "+SocialCalc.crToCoord(g.range2.left,g.range2.top)+":"+SocialCalc.crToCoord(g.range2.right,g.range2.bottom)+" "+g.ecell.coord+o;g.EditorScheduleSheetCommands(m,true,false);g.Range2Remove();break;case"MoveI":case"MoveIC":g.context.cursorsuffix="";j=g.range2.right-g.range2.left;a=g.range2.bottom-g.range2.top;u=g.ecell.col-g.range2.left;l=g.ecell.row-g.range2.top;m="moveinsert "+SocialCalc.crToCoord(g.range2.left,g.range2.top)+":"+SocialCalc.crToCoord(g.range2.right,g.range2.bottom)+" "+g.ecell.coord+o;g.EditorScheduleSheetCommands(m,true,false);g.Range2Remove();g.RangeRemove();if(g.cellhandles.filltype==" Horizontal"&&u>0){g.MoveECell(SocialCalc.crToCoord(g.ecell.col-j-1,g.ecell.row))}else{if(g.cellhandles.filltype==" Vertical"&&l>0){g.MoveECell(SocialCalc.crToCoord(g.ecell.col,g.ecell.row-a-1))}}g.RangeAnchor(SocialCalc.crToCoord(g.ecell.col+j,g.ecell.row+a));g.RangeExtend();break}if(x.stopPropagation){x.stopPropagation()}else{x.cancelBubble=true}if(x.preventDefault){x.preventDefault()}else{x.returnValue=false}if(document.removeEventListener){document.removeEventListener("mousemove",SocialCalc.CellHandlesMouseMove,true);document.removeEventListener("mouseup",SocialCalc.CellHandlesMouseUp,true)}else{if(A.draghandle.detachEvent){A.draghandle.detachEvent("onlosecapture",SocialCalc.CellHandlesMouseUp);A.draghandle.detachEvent("onmouseup",SocialCalc.CellHandlesMouseUp);A.draghandle.detachEvent("onmousemove",SocialCalc.CellHandlesMouseMove);A.draghandle.releaseCapture()}}b.editor=null;return false};SocialCalc.TableControl=function(d,b,c){var a=SocialCalc.Constants;this.editor=d;this.vertical=b;this.size=c;this.main=null;this.endcap=null;this.paneslider=null;this.lessbutton=null;this.morebutton=null;this.scrollarea=null;this.thumb=null;this.controlborder=null;this.endcapstart=null;this.panesliderstart=null;this.lessbuttonstart=null;this.morebuttonstart=null;this.scrollareastart=null;this.scrollareaend=null;this.scrollareasize=null;this.thumbpos=null;this.controlthickness=a.defaultTableControlThickness;this.sliderthickness=a.defaultTCSliderThickness;this.buttonthickness=a.defaultTCButtonThickness;this.thumbthickness=a.defaultTCThumbThickness;this.minscrollingpanesize=this.buttonthickness+this.buttonthickness+this.thumbthickness+20};SocialCalc.TableControl.prototype.CreateTableControl=function(){return SocialCalc.CreateTableControl(this)};SocialCalc.TableControl.prototype.PositionTableControlElements=function(){SocialCalc.PositionTableControlElements(this)};SocialCalc.TableControl.prototype.ComputeTableControlPositions=function(){SocialCalc.ComputeTableControlPositions(this)};SocialCalc.CreateTableControl=function(e){var k,g,c;var h=SocialCalc.AssignID;var j=SocialCalc.setStyles;var b=SocialCalc.Constants;var i=function(l,m,n){if(b["s_"+m+"Tooltip"+n]){SocialCalc.TooltipRegister(l,b["s_"+m+"Tooltip"+n],null)}};var a=e.editor.imageprefix;var d=e.vertical?"v":"h";e.main=document.createElement("div");k=e.main.style;k.height=(e.vertical?e.size:e.controlthickness)+"px";k.width=(e.vertical?e.controlthickness:e.size)+"px";k.zIndex=0;j(e.main,b.TCmainStyle);k.backgroundImage="url("+a+"main-"+d+".gif)";if(b.TCmainClass){e.main.className=b.TCmainClass}e.main.style.display="none";e.endcap=document.createElement("div");k=e.endcap.style;k.height=e.controlthickness+"px";k.width=e.controlthickness+"px";k.zIndex=1;k.overflow="hidden";k.position="absolute";j(e.endcap,b.TCendcapStyle);k.backgroundImage="url("+a+"endcap-"+d+".gif)";if(b.TCendcapClass){e.endcap.className=b.TCendcapClass}h(e.editor,e.endcap,"endcap"+d);e.main.appendChild(e.endcap);e.paneslider=document.createElement("div");k=e.paneslider.style;k.height=(e.vertical?e.sliderthickness:e.controlthickness)+"px";k.overflow="hidden";k.width=(e.vertical?e.controlthickness:e.sliderthickness)+"px";k.position="absolute";k[e.vertical?"top":"left"]="4px";k.zIndex=3;j(e.paneslider,b.TCpanesliderStyle);k.backgroundImage="url("+a+"paneslider-"+d+".gif)";if(b.TCpanesliderClass){e.paneslider.className=b.TCpanesliderClass}h(e.editor,e.paneslider,"paneslider"+d);i(e.paneslider,"paneslider",d);g={MouseDown:SocialCalc.TCPSDragFunctionStart,MouseMove:SocialCalc.TCPSDragFunctionMove,MouseUp:SocialCalc.TCPSDragFunctionStop,Disabled:function(){return e.editor.busy}};g.control=e;SocialCalc.DragRegister(e.paneslider,e.vertical,!e.vertical,g);e.main.appendChild(e.paneslider);e.lessbutton=document.createElement("div");k=e.lessbutton.style;k.height=(e.vertical?e.buttonthickness:e.controlthickness)+"px";k.width=(e.vertical?e.controlthickness:e.buttonthickness)+"px";k.zIndex=2;k.overflow="hidden";k.position="absolute";j(e.lessbutton,b.TClessbuttonStyle);k.backgroundImage="url("+a+"less-"+d+"n.gif)";if(b.TClessbuttonClass){e.lessbutton.className=b.TClessbuttonClass}h(e.editor,e.lessbutton,"lessbutton"+d);c={repeatwait:b.TClessbuttonRepeatWait,repeatinterval:b.TClessbuttonRepeatInterval,normalstyle:"backgroundImage:url("+a+"less-"+d+"n.gif);",downstyle:"backgroundImage:url("+a+"less-"+d+"d.gif);",hoverstyle:"backgroundImage:url("+a+"less-"+d+"h.gif);"};g={MouseDown:function(){if(!e.editor.busy){e.editor.ScrollRelative(e.vertical,-1)}},Repeat:function(){if(!e.editor.busy){e.editor.ScrollRelative(e.vertical,-1)}},Disabled:function(){return e.editor.busy}};SocialCalc.ButtonRegister(e.lessbutton,c,g);e.main.appendChild(e.lessbutton);e.morebutton=document.createElement("div");k=e.morebutton.style;k.height=(e.vertical?e.buttonthickness:e.controlthickness)+"px";k.width=(e.vertical?e.controlthickness:e.buttonthickness)+"px";k.zIndex=2;k.overflow="hidden";k.position="absolute";j(e.morebutton,b.TCmorebuttonStyle);k.backgroundImage="url("+a+"more-"+d+"n.gif)";if(b.TCmorebuttonClass){e.morebutton.className=b.TCmorebuttonClass}h(e.editor,e.morebutton,"morebutton"+d);c={repeatwait:b.TCmorebuttonRepeatWait,repeatinterval:b.TCmorebuttonRepeatInterval,normalstyle:"backgroundImage:url("+a+"more-"+d+"n.gif);",downstyle:"backgroundImage:url("+a+"more-"+d+"d.gif);",hoverstyle:"backgroundImage:url("+a+"more-"+d+"h.gif);"};g={MouseDown:function(){if(!e.editor.busy){e.editor.ScrollRelative(e.vertical,+1)}},Repeat:function(){if(!e.editor.busy){e.editor.ScrollRelative(e.vertical,+1)}},Disabled:function(){return e.editor.busy}};SocialCalc.ButtonRegister(e.morebutton,c,g);e.main.appendChild(e.morebutton);e.scrollarea=document.createElement("div");k=e.scrollarea.style;k.height=e.controlthickness+"px";k.width=e.controlthickness+"px";k.zIndex=1;k.overflow="hidden";k.position="absolute";j(e.scrollarea,b.TCscrollareaStyle);k.backgroundImage="url("+a+"scrollarea-"+d+".gif)";if(b.TCscrollareaClass){e.scrollarea.className=b.TCscrollareaClass}h(e.editor,e.scrollarea,"scrollarea"+d);c={repeatwait:b.TCscrollareaRepeatWait,repeatinterval:b.TCscrollareaRepeatWait};g={MouseDown:SocialCalc.ScrollAreaClick,Repeat:SocialCalc.ScrollAreaClick,Disabled:function(){return e.editor.busy}};g.control=e;SocialCalc.ButtonRegister(e.scrollarea,c,g);e.main.appendChild(e.scrollarea);e.thumb=document.createElement("div");k=e.thumb.style;k.height=(e.vertical?e.thumbthickness:e.controlthickness)+"px";k.width=(e.vertical?e.controlthickness:e.thumbthickness)+"px";k.zIndex=2;k.overflow="hidden";k.position="absolute";j(e.thumb,b.TCthumbStyle);e.thumb.style.backgroundImage="url("+a+"thumb-"+d+"n.gif)";if(b.TCthumbClass){e.thumb.className=b.TCthumbClass}h(e.editor,e.thumb,"thumb"+d);g={MouseDown:SocialCalc.TCTDragFunctionStart,MouseMove:SocialCalc.TCTDragFunctionMove,MouseUp:SocialCalc.TCTDragFunctionStop,Disabled:function(){return e.editor.busy}};g.control=e;SocialCalc.DragRegister(e.thumb,e.vertical,!e.vertical,g);c={normalstyle:"backgroundImage:url("+a+"thumb-"+d+"n.gif)",name:"Thumb",downstyle:"backgroundImage:url("+a+"thumb-"+d+"d.gif)",hoverstyle:"backgroundImage:url("+a+"thumb-"+d+"h.gif)"};SocialCalc.ButtonRegister(e.thumb,c,null);e.main.appendChild(e.thumb);return e.main};SocialCalc.ScrollAreaClick=function(g,d,a){var c=a.functionobj.control;var h=SocialCalc.GetElementPosition(a.element);var b=c.vertical?d.clientY:d.clientX;if(c.editor.busy){return}c.editor.PageRelative(c.vertical,b>c.thumbpos?1:-1);return};SocialCalc.PositionTableControlElements=function(c){var a,d,e;var b=c.editor;if(c.vertical){a=c.controlborder+"px";c.endcap.style.top=c.endcapstart+"px";c.endcap.style.left=a;c.paneslider.style.top=c.panesliderstart+"px";c.paneslider.style.left=a;c.lessbutton.style.top=c.lessbuttonstart+"px";c.lessbutton.style.left=a;c.morebutton.style.top=c.morebuttonstart+"px";c.morebutton.style.left=a;c.scrollarea.style.top=c.scrollareastart+"px";c.scrollarea.style.left=a;c.scrollarea.style.height=c.scrollareasize+"px";d=Math.max(b.context.sheetobj.attribs.lastrow,b.firstscrollingrow+1);e=((b.firstscrollingrow-(b.lastnonscrollingrow+1))*(c.scrollareasize-3*c.thumbthickness))/(d-(b.lastnonscrollingrow+1))+c.scrollareastart-1;e=Math.floor(e);c.thumb.style.top=e+"px";c.thumb.style.left=a}else{a=c.controlborder+"px";c.endcap.style.left=c.endcapstart+"px";c.endcap.style.top=a;c.paneslider.style.left=c.panesliderstart+"px";c.paneslider.style.top=a;c.lessbutton.style.left=c.lessbuttonstart+"px";c.lessbutton.style.top=a;c.morebutton.style.left=c.morebuttonstart+"px";c.morebutton.style.top=a;c.scrollarea.style.left=c.scrollareastart+"px";c.scrollarea.style.top=a;c.scrollarea.style.width=c.scrollareasize+"px";d=Math.max(b.context.sheetobj.attribs.lastcol,b.firstscrollingcol+1);e=((b.firstscrollingcol-(b.lastnonscrollingcol+1))*(c.scrollareasize-c.thumbthickness))/(d-b.lastnonscrollingcol)+c.scrollareastart-1;e=Math.floor(e);c.thumb.style.left=e+"px";c.thumb.style.top=a}c.thumbpos=e;c.main.style.display="block"};SocialCalc.ComputeTableControlPositions=function(b){var a=b.editor;if(!a.gridposition||!a.headposition){throw ("Can't compute table control positions before editor positions")}if(b.vertical){b.controlborder=a.gridposition.left+a.tablewidth;b.endcapstart=a.gridposition.top;b.panesliderstart=a.firstscrollingrowtop-b.sliderthickness;b.lessbuttonstart=a.firstscrollingrowtop-1;b.morebuttonstart=a.gridposition.top+a.tableheight-b.buttonthickness;b.scrollareastart=a.firstscrollingrowtop-1+b.buttonthickness;b.scrollareaend=b.morebuttonstart-1;b.scrollareasize=b.scrollareaend-b.scrollareastart+1}else{b.controlborder=a.gridposition.top+a.tableheight;b.endcapstart=a.gridposition.left;b.panesliderstart=a.firstscrollingcolleft-b.sliderthickness;b.lessbuttonstart=a.firstscrollingcolleft-1;b.morebuttonstart=a.gridposition.left+a.tablewidth-b.buttonthickness;b.scrollareastart=a.firstscrollingcolleft-1+b.buttonthickness;b.scrollareaend=b.morebuttonstart-1;b.scrollareasize=b.scrollareaend-b.scrollareastart+1}};SocialCalc.TCPSDragFunctionStart=function(e,b,d){var c=d.functionobj.control.editor;var a=SocialCalc.Constants;SocialCalc.DragFunctionStart(e,b,d);b.trackingline=document.createElement("div");b.trackingline.style.height=d.vertical?a.TCPStrackinglineThickness:(c.tableheight-(c.headposition.top-c.gridposition.top))+"px";b.trackingline.style.width=d.vertical?(c.tablewidth-(c.headposition.left-c.gridposition.left))+"px":a.TCPStrackinglineThickness;b.trackingline.style.backgroundImage="url("+c.imageprefix+"trackingline-"+(d.vertical?"v":"h")+".gif)";if(a.TCPStrackinglineClass){b.trackingline.className=a.TCPStrackinglineClass}SocialCalc.setStyles(b.trackingline,a.TCPStrackinglineStyle);if(d.vertical){row=SocialCalc.Lookup(b.clientY+d.functionobj.control.sliderthickness,c.rowpositions);b.trackingline.style.top=(c.rowpositions[row]||c.headposition.top)+"px";b.trackingline.style.left=c.headposition.left+"px";if(c.context.rowpanes.length-1){c.context.SetRowPaneFirstLast(1,c.context.rowpanes[0].last+1,c.context.rowpanes[0].last+1);c.FitToEditTable();c.ScheduleRender()}}else{col=SocialCalc.Lookup(b.clientX+d.functionobj.control.sliderthickness,c.colpositions);b.trackingline.style.top=c.headposition.top+"px";b.trackingline.style.left=(c.colpositions[col]||c.headposition.left)+"px";if(c.context.colpanes.length-1){c.context.SetColPaneFirstLast(1,c.context.colpanes[0].last+1,c.context.colpanes[0].last+1);c.FitToEditTable();c.ScheduleRender()}}c.griddiv.appendChild(b.trackingline)};SocialCalc.TCPSDragFunctionMove=function(a,j,d){var k,c,i,e;var g=d.functionobj.control;var b=g.sliderthickness;var h=g.editor;if(d.vertical){i=g.morebuttonstart-g.minscrollingpanesize-j.offsetY;if(j.clientY>i){j.clientY=i}e=h.headposition.top-b-j.offsetY;if(j.clientY<e){j.clientY=e}k=SocialCalc.Lookup(j.clientY+b,h.rowpositions);j.trackingline.style.top=(h.rowpositions[k]||h.headposition.top)+"px"}else{i=g.morebuttonstart-g.minscrollingpanesize-j.offsetX;if(j.clientX>i){j.clientX=i}e=h.headposition.left-b-j.offsetX;if(j.clientX<e){j.clientX=e}c=SocialCalc.Lookup(j.clientX+b,h.colpositions);j.trackingline.style.left=(h.colpositions[c]||h.headposition.left)+"px"}SocialCalc.DragFunctionPosition(a,j,d)};SocialCalc.TCPSDragFunctionStop=function(a,j,d){var k,c,i,e;var g=d.functionobj.control;var b=g.sliderthickness;var h=g.editor;if(d.vertical){i=g.morebuttonstart-g.minscrollingpanesize-j.offsetY;if(j.clientY>i){j.clientY=i}e=h.headposition.top-b-j.offsetY;if(j.clientY<e){j.clientY=e}k=SocialCalc.Lookup(j.clientY+b,h.rowpositions);if(k>h.context.sheetobj.attribs.lastrow){k=h.context.sheetobj.attribs.lastrow}if(!k||k<=h.context.rowpanes[0].first){if(h.context.rowpanes.length>1){h.context.rowpanes.length=1}}else{if(h.context.rowpanes.length-1){if(!h.timeout){h.context.SetRowPaneFirstLast(0,h.context.rowpanes[0].first,k-1);h.context.SetRowPaneFirstLast(1,k,k)}}else{h.context.SetRowPaneFirstLast(0,h.context.rowpanes[0].first,k-1);h.context.SetRowPaneFirstLast(1,k,k)}}}else{i=g.morebuttonstart-g.minscrollingpanesize-j.offsetX;if(j.clientX>i){j.clientX=i}e=h.headposition.left-b-j.offsetX;if(j.clientX<e){j.clientX=e}c=SocialCalc.Lookup(j.clientX+b,h.colpositions);if(c>h.context.sheetobj.attribs.lastcol){c=h.context.sheetobj.attribs.lastcol}if(!c||c<=h.context.colpanes[0].first){if(h.context.colpanes.length>1){h.context.colpanes.length=1}}else{if(h.context.colpanes.length-1){if(!h.timeout){h.context.SetColPaneFirstLast(0,h.context.colpanes[0].first,c-1);h.context.SetColPaneFirstLast(1,c,c)}}else{h.context.SetColPaneFirstLast(0,h.context.colpanes[0].first,c-1);h.context.SetColPaneFirstLast(1,c,c)}}}h.FitToEditTable();h.griddiv.removeChild(j.trackingline);h.ScheduleRender()};SocialCalc.TCTDragFunctionStart=function(a,k,e){var j,i,l,c;var g=e.functionobj.control;var h=g.editor;var d=SocialCalc.Constants;SocialCalc.DragFunctionStart(a,k,e);if(k.thumbstatus){if(k.thumbstatus.rowmsgele){k.thumbstatus.rowmsgele=null}if(k.thumbstatus.rowpreviewele){k.thumbstatus.rowpreviewele=null}h.toplevel.removeChild(k.thumbstatus);k.thumbstatus=null}k.thumbstatus=document.createElement("div");if(e.vertical){if(d.TCTDFSthumbstatusvClass){k.thumbstatus.className=d.TCTDFSthumbstatusvClass}SocialCalc.setStyles(k.thumbstatus,d.TCTDFSthumbstatusvStyle);k.thumbstatus.style.top=(k.clientY+d.TCTDFStopOffsetv)+"px";k.thumbstatus.style.left=(g.controlborder-10-(h.tablewidth/2))+"px";k.thumbstatus.style.width=(h.tablewidth/2)+"px";k.thumbcontext=new SocialCalc.RenderContext(h.context.sheetobj);k.thumbcontext.showGrid=true;k.thumbcontext.rowpanes=[{first:1,last:1}];var b=h.context.colpanes[h.context.colpanes.length-1];k.thumbcontext.colpanes=[{first:b.first,last:b.last}];k.thumbstatus.innerHTML='<table cellspacing="0" cellpadding="0"><tr><td valign="top" style="'+d.TCTDFSthumbstatusrownumStyle+'" class="'+d.TCTDFSthumbstatusrownumClass+'"><div>msg</div></td><td valign="top"><div style="overflow:hidden;">preview</div></td></tr></table>';k.thumbstatus.rowmsgele=k.thumbstatus.firstChild.firstChild.firstChild.firstChild.firstChild;k.thumbstatus.rowpreviewele=k.thumbstatus.firstChild.firstChild.firstChild.childNodes[1].firstChild;h.toplevel.appendChild(k.thumbstatus);SocialCalc.TCTDragFunctionRowSetStatus(k,h,h.firstscrollingrow||1)}else{if(d.TCTDFSthumbstatushClass){k.thumbstatus.className=d.TCTDFSthumbstatushClass}SocialCalc.setStyles(k.thumbstatus,d.TCTDFSthumbstatushStyle);k.thumbstatus.style.top=(g.controlborder+d.TCTDFStopOffseth)+"px";k.thumbstatus.style.left=(k.clientX+d.TCTDFSleftOffseth)+"px";h.toplevel.appendChild(k.thumbstatus);k.thumbstatus.innerHTML=d.s_TCTDFthumbstatusPrefixh+SocialCalc.rcColname(h.firstscrollingcol)}};SocialCalc.TCTDragFunctionRowSetStatus=function(b,c,g){var a=SocialCalc.Constants;var e=a.s_TCTDFthumbstatusPrefixv+g+" ";b.thumbstatus.rowmsgele.innerHTML=e;b.thumbcontext.rowpanes=[{first:g,last:g}];b.thumbrowshown=g;var d=b.thumbcontext.RenderSheet(b.thumbstatus.rowpreviewele.firstChild,{type:"html"})};SocialCalc.TCTDragFunctionMove=function(a,j,d){var g,b;var e=d.functionobj.control;var i=e.thumbthickness;var h=e.editor;var c=SocialCalc.Constants;if(d.vertical){if(j.clientY>e.scrollareaend-j.offsetY-e.thumbthickness+2){j.clientY=e.scrollareaend-j.offsetY-e.thumbthickness+2}if(j.clientY<e.scrollareastart-j.offsetY-1){j.clientY=e.scrollareastart-j.offsetY-1}j.thumbstatus.style.top=j.clientY+"px";g=((j.clientY+j.offsetY-e.scrollareastart+1)/(e.scrollareasize-e.thumbthickness))*(h.context.sheetobj.attribs.lastrow-h.lastnonscrollingrow)+h.lastnonscrollingrow+1;g=Math.floor(g);if(g<=h.lastnonscrollingrow){g=h.lastnonscrollingrow+1}if(g>h.context.sheetobj.attribs.lastrow){g=h.context.sheetobj.attribs.lastrow}if(g!=j.thumbrowshown){SocialCalc.TCTDragFunctionRowSetStatus(j,h,g)}}else{if(j.clientX>e.scrollareaend-j.offsetX-e.thumbthickness+2){j.clientX=e.scrollareaend-j.offsetX-e.thumbthickness+2}if(j.clientX<e.scrollareastart-j.offsetX-1){j.clientX=e.scrollareastart-j.offsetX-1}j.thumbstatus.style.left=j.clientX+"px";g=((j.clientX+j.offsetX-e.scrollareastart+1)/(e.scrollareasize-e.thumbthickness))*(h.context.sheetobj.attribs.lastcol-h.lastnonscrollingcol)+h.lastnonscrollingcol+1;g=Math.floor(g);if(g<=h.lastnonscrollingcol){g=h.lastnonscrollingcol+1}if(g>h.context.sheetobj.attribs.lastcol){g=h.context.sheetobj.attribs.lastcol}b=c.s_TCTDFthumbstatusPrefixh+SocialCalc.rcColname(g);j.thumbstatus.innerHTML=b}SocialCalc.DragFunctionPosition(a,j,d)};SocialCalc.TCTDragFunctionStop=function(d,a,c){var g;var e=c.functionobj.control;var b=e.editor;if(c.vertical){g=((a.clientY+a.offsetY-e.scrollareastart+1)/(e.scrollareasize-e.thumbthickness))*(b.context.sheetobj.attribs.lastrow-b.lastnonscrollingrow)+b.lastnonscrollingrow+1;g=Math.floor(g);if(g<=b.lastnonscrollingrow){g=b.lastnonscrollingrow+1}if(g>b.context.sheetobj.attribs.lastrow){g=b.context.sheetobj.attribs.lastrow}b.context.SetRowPaneFirstLast(b.context.rowpanes.length-1,g,g+1)}else{g=((a.clientX+a.offsetX-e.scrollareastart+1)/(e.scrollareasize-e.thumbthickness))*(b.context.sheetobj.attribs.lastcol-b.lastnonscrollingcol)+b.lastnonscrollingcol+1;g=Math.floor(g);if(g<=b.lastnonscrollingcol){g=b.lastnonscrollingcol+1}if(g>b.context.sheetobj.attribs.lastcol){g=b.context.sheetobj.attribs.lastcol}b.context.SetColPaneFirstLast(b.context.colpanes.length-1,g,g+1)}b.FitToEditTable();if(a.thumbstatus.rowmsgele){a.thumbstatus.rowmsgele=null}if(a.thumbstatus.rowpreviewele){a.thumbstatus.rowpreviewele=null}b.toplevel.removeChild(a.thumbstatus);a.thumbstatus=null;b.ScheduleRender()};SocialCalc.DragInfo={registeredElements:[],draggingElement:null,startX:0,startY:0,startZ:0,clientX:0,clientY:0,offsetX:0,offsetY:0,horizontalScroll:0,verticalScroll:0};SocialCalc.DragRegister=function(e,d,c,b){var a=SocialCalc.DragInfo;if(!b){b={MouseDown:SocialCalc.DragFunctionStart,MouseMove:SocialCalc.DragFunctionPosition,MouseUp:SocialCalc.DragFunctionPosition,Disabled:null}}a.registeredElements.push({element:e,vertical:d,horizontal:c,functionobj:b});if(e.addEventListener){e.addEventListener("mousedown",SocialCalc.DragMouseDown,false)}else{if(e.attachEvent){e.attachEvent("onmousedown",SocialCalc.DragMouseDown)}else{throw SocialCalc.Constants.s_BrowserNotSupported}}};SocialCalc.DragUnregister=function(c){var a=SocialCalc.DragInfo;var b;if(!c){return}for(b=0;b<a.registeredElements.length;b++){if(a.registeredElements[b].element==c){a.registeredElements.splice(b,1);if(c.removeEventListener){c.removeEventListener("mousedown",SocialCalc.DragMouseDown,false)}else{c.detachEvent("onmousedown",SocialCalc.DragMouseDown)}return}}return};SocialCalc.DragMouseDown=function(c){var g=c||window.event;var a=SocialCalc.DragInfo;var b=SocialCalc.LookupElement(g.target||g.srcElement,a.registeredElements);if(!b){return}if(b&&b.functionobj&&b.functionobj.Disabled){if(b.functionobj.Disabled(g,a,b)){return}}a.draggingElement=b;var d=SocialCalc.GetViewportInfo();a.horizontalScroll=d.horizontalScroll;a.verticalScroll=d.verticalScroll;a.clientX=g.clientX+a.horizontalScroll;a.clientY=g.clientY+a.verticalScroll;a.startX=a.clientX;a.startY=a.clientY;a.startZ=b.element.style.zIndex;a.offsetX=0;a.offsetY=0;b.element.style.zIndex="100";if(document.addEventListener){document.addEventListener("mousemove",SocialCalc.DragMouseMove,true);document.addEventListener("mouseup",SocialCalc.DragMouseUp,true)}else{if(b.element.attachEvent){b.element.setCapture();b.element.attachEvent("onmousemove",SocialCalc.DragMouseMove);b.element.attachEvent("onmouseup",SocialCalc.DragMouseUp);b.element.attachEvent("onlosecapture",SocialCalc.DragMouseUp)}}if(g.stopPropagation){g.stopPropagation()}else{g.cancelBubble=true}if(g.preventDefault){g.preventDefault()}else{g.returnValue=false}if(b&&b.functionobj&&b.functionobj.MouseDown){b.functionobj.MouseDown(g,a,b)}return false};SocialCalc.DragMouseMove=function(c){var d=c||window.event;var a=SocialCalc.DragInfo;a.clientX=d.clientX+a.horizontalScroll;a.clientY=d.clientY+a.verticalScroll;var b=a.draggingElement;if(d.stopPropagation){d.stopPropagation()}else{d.cancelBubble=true}if(b&&b.functionobj&&b.functionobj.MouseMove){b.functionobj.MouseMove(d,a,b)}return false};SocialCalc.DragMouseUp=function(c){var d=c||window.event;var a=SocialCalc.DragInfo;a.clientX=d.clientX+a.horizontalScroll;a.clientY=d.clientY+a.verticalScroll;var b=a.draggingElement;b.element.style.zIndex=a.startZ;if(b&&b.functionobj&&b.functionobj.MouseUp){b.functionobj.MouseUp(d,a,b)}if(d.stopPropagation){d.stopPropagation()}else{d.cancelBubble=true}if(document.removeEventListener){document.removeEventListener("mousemove",SocialCalc.DragMouseMove,true);document.removeEventListener("mouseup",SocialCalc.DragMouseUp,true)}else{if(b.element.detachEvent){b.element.detachEvent("onlosecapture",SocialCalc.DragMouseUp);b.element.detachEvent("onmouseup",SocialCalc.DragMouseUp);b.element.detachEvent("onmousemove",SocialCalc.DragMouseMove);b.element.releaseCapture()}}a.draggingElement=null;return false};SocialCalc.DragFunctionStart=function(d,a,c){var e;var b=c.functionobj.positionobj||c.element;e=b.style.top.match(/\d*/);a.offsetY=(e?e[0]-0:0)-a.clientY;e=b.style.left.match(/\d*/);a.offsetX=(e?e[0]-0:0)-a.clientX};SocialCalc.DragFunctionPosition=function(d,a,c){var b=c.functionobj.positionobj||c.element;if(c.vertical){b.style.top=(a.clientY+a.offsetY)+"px"}if(c.horizontal){b.style.left=(a.clientX+a.offsetX)+"px"}};SocialCalc.TooltipInfo={registeredElements:[],registered:false,tooltipElement:null,timer:null,popupElement:null,clientX:0,clientY:0,offsetX:SocialCalc.Constants.TooltipOffsetX,offsetY:SocialCalc.Constants.TooltipOffsetY};SocialCalc.TooltipRegister=function(d,c,b){var a=SocialCalc.TooltipInfo;a.registeredElements.push({element:d,tiptext:c,functionobj:b});if(a.registered){return}if(document.addEventListener){document.addEventListener("mousemove",SocialCalc.TooltipMouseMove,false)}else{if(document.attachEvent){document.attachEvent("onmousemove",SocialCalc.TooltipMouseMove)}else{throw SocialCalc.Constants.s_BrowserNotSupported}}a.registered=true;return};SocialCalc.TooltipMouseMove=function(c){var d=c||window.event;var a=SocialCalc.TooltipInfo;a.viewport=SocialCalc.GetViewportInfo();a.clientX=d.clientX+a.viewport.horizontalScroll;a.clientY=d.clientY+a.viewport.verticalScroll;var b=SocialCalc.LookupElement(d.target||d.srcElement,a.registeredElements);if(a.timer){window.clearTimeout(a.timer);a.timer=null}if(a.popupElement){SocialCalc.TooltipHide()}a.tooltipElement=b||null;if(!b||SocialCalc.ButtonInfo.buttonDown){return}a.timer=window.setTimeout(SocialCalc.TooltipWaitDone,700);if(a.tooltipElement.element.addEventListener){a.tooltipElement.element.addEventListener("mousedown",SocialCalc.TooltipMouseDown,false)}else{if(a.tooltipElement.element.attachEvent){a.tooltipElement.element.attachEvent("onmousedown",SocialCalc.TooltipMouseDown)}}return};SocialCalc.TooltipMouseDown=function(b){var c=b||window.event;var a=SocialCalc.TooltipInfo;if(a.timer){window.clearTimeout(a.timer);a.timer=null}if(a.popupElement){SocialCalc.TooltipHide()}if(a.tooltipElement){if(a.tooltipElement.element.removeEventListener){a.tooltipElement.element.removeEventListener("mousedown",SocialCalc.TooltipMouseDown,false)}else{if(a.tooltipElement.element.attachEvent){a.tooltipElement.element.detachEvent("onmousedown",SocialCalc.TooltipMouseDown)}}a.tooltipElement=null}return};SocialCalc.TooltipDisplay=function(d){var b=SocialCalc.TooltipInfo;var c=SocialCalc.Constants;var a=(d.functionobj&&((typeof d.functionobj.offsetx)=="number"))?d.functionobj.offsetx:b.offsetX;var e=(d.functionobj&&((typeof d.functionobj.offsety)=="number"))?d.functionobj.offsety:b.offsetY;b.popupElement=document.createElement("div");if(c.TDpopupElementClass){b.popupElement.className=c.TDpopupElementClass}SocialCalc.setStyles(b.popupElement,c.TDpopupElementStyle);b.popupElement.innerHTML=d.tiptext;if(b.clientX>b.viewport.width/2){b.popupElement.style.bottom=(b.viewport.height-b.clientY+e)+"px";b.popupElement.style.right=(b.viewport.width-b.clientX+a)+"px"}else{b.popupElement.style.bottom=(b.viewport.height-b.clientY+e)+"px";b.popupElement.style.left=(b.clientX+a)+"px"}if(b.clientY<50){b.popupElement.style.bottom=(b.viewport.height-b.clientY+e-50)+"px"}document.body.appendChild(b.popupElement)};SocialCalc.TooltipHide=function(){var a=SocialCalc.TooltipInfo;if(a.popupElement){a.popupElement.parentNode.removeChild(a.popupElement);a.popupElement=null}};SocialCalc.TooltipWaitDone=function(){var a=SocialCalc.TooltipInfo;a.timer=null;SocialCalc.TooltipDisplay(a.tooltipElement)};SocialCalc.ButtonInfo={registeredElements:[],buttonElement:null,doingHover:false,buttonDown:false,timer:null,horizontalScroll:0,verticalScroll:0,clientX:0,clientY:0};SocialCalc.ButtonRegister=function(b,d,a){var c=SocialCalc.ButtonInfo;if(!d){d={}}c.registeredElements.push({name:d.name,element:b,normalstyle:d.normalstyle,hoverstyle:d.hoverstyle,downstyle:d.downstyle,repeatwait:d.repeatwait,repeatinterval:d.repeatinterval,functionobj:a});if(b.addEventListener){b.addEventListener("mousedown",SocialCalc.ButtonMouseDown,false);b.addEventListener("mouseover",SocialCalc.ButtonMouseOver,false);b.addEventListener("mouseout",SocialCalc.ButtonMouseOut,false)}else{if(b.attachEvent){b.attachEvent("onmousedown",SocialCalc.ButtonMouseDown);b.attachEvent("onmouseover",SocialCalc.ButtonMouseOver);b.attachEvent("onmouseout",SocialCalc.ButtonMouseOut)}else{throw SocialCalc.Constants.s_BrowserNotSupported}}return};SocialCalc.ButtonMouseOver=function(b){var d=b||window.event;var c=SocialCalc.ButtonInfo;var a=SocialCalc.LookupElement(d.target||d.srcElement,c.registeredElements);if(!a){return}if(c.buttonDown){if(c.buttonElement==a){c.doingHover=true}return}if(c.buttonElement&&c.buttonElement!=a&&c.doingHover){SocialCalc.setStyles(c.buttonElement.element,c.buttonElement.normalstyle)}c.buttonElement=a;c.doingHover=true;SocialCalc.setStyles(a.element,a.hoverstyle);if(a&&a.functionobj&&a.functionobj.MouseOver){a.functionobj.MouseOver(d,c,a)}return};SocialCalc.ButtonMouseOut=function(b){var d=b||window.event;var c=SocialCalc.ButtonInfo;if(c.buttonDown){c.doingHover=false;return}var a=SocialCalc.LookupElement(d.target||d.srcElement,c.registeredElements);if(c.doingHover){if(c.buttonElement){SocialCalc.setStyles(c.buttonElement.element,c.buttonElement.normalstyle)}c.buttonElement=null;c.doingHover=false}if(a&&a.functionobj&&a.functionobj.MouseOut){a.functionobj.MouseOut(d,c,a)}return};SocialCalc.ButtonMouseDown=function(b){var g=b||window.event;var d=SocialCalc.ButtonInfo;var c=SocialCalc.GetViewportInfo();var a=SocialCalc.LookupElement(g.target||g.srcElement,d.registeredElements);if(!a){return}if(a&&a.functionobj&&a.functionobj.Disabled){if(a.functionobj.Disabled(g,d,a)){return}}d.buttonElement=a;d.buttonDown=true;SocialCalc.setStyles(a.element,d.buttonElement.downstyle);if(document.addEventListener){document.addEventListener("mouseup",SocialCalc.ButtonMouseUp,true)}else{if(a.element.attachEvent){a.element.setCapture();a.element.attachEvent("onmouseup",SocialCalc.ButtonMouseUp);a.element.attachEvent("onlosecapture",SocialCalc.ButtonMouseUp)}}if(g.stopPropagation){g.stopPropagation()}else{g.cancelBubble=true}if(g.preventDefault){g.preventDefault()}else{g.returnValue=false}d.horizontalScroll=c.horizontalScroll;d.verticalScroll=c.verticalScroll;d.clientX=g.clientX+d.horizontalScroll;d.clientY=g.clientY+d.verticalScroll;if(a&&a.functionobj&&a.functionobj.MouseDown){a.functionobj.MouseDown(g,d,a)}if(a.repeatwait){d.timer=window.setTimeout(SocialCalc.ButtonRepeat,a.repeatwait)}return};SocialCalc.ButtonMouseUp=function(b){var d=b||window.event;var c=SocialCalc.ButtonInfo;var a=c.buttonElement;if(c.timer){window.clearTimeout(c.timer);c.timer=null}if(!c.buttonDown){return}if(d.stopPropagation){d.stopPropagation()}else{d.cancelBubble=true}if(d.preventDefault){d.preventDefault()}else{d.returnValue=false}if(document.removeEventListener){document.removeEventListener("mouseup",SocialCalc.ButtonMouseUp,true)}else{if(document.detachEvent){a.element.detachEvent("onlosecapture",SocialCalc.ButtonMouseUp);a.element.detachEvent("onmouseup",SocialCalc.ButtonMouseUp);a.element.releaseCapture()}}if(c.buttonElement.downstyle){if(c.doingHover){SocialCalc.setStyles(a.element,c.buttonElement.hoverstyle)}else{SocialCalc.setStyles(a.element,c.buttonElement.normalstyle)}}c.buttonDown=false;if(a&&a.functionobj&&a.functionobj.MouseUp){a.functionobj.MouseUp(d,c,a)}};SocialCalc.ButtonRepeat=function(){var b=SocialCalc.ButtonInfo;var a=b.buttonElement;if(!a){return}if(a&&a.functionobj&&a.functionobj.Repeat){a.functionobj.Repeat(null,b,a)}b.timer=window.setTimeout(SocialCalc.ButtonRepeat,a.repeatinterval||100)};SocialCalc.MouseWheelInfo={registeredElements:[]};SocialCalc.MouseWheelRegister=function(c,b){var a=SocialCalc.MouseWheelInfo;a.registeredElements.push({element:c,functionobj:b});if(c.addEventListener){c.addEventListener("DOMMouseScroll",SocialCalc.ProcessMouseWheel,false);c.addEventListener("mousewheel",SocialCalc.ProcessMouseWheel,false)}else{if(c.attachEvent){c.attachEvent("onmousewheel",SocialCalc.ProcessMouseWheel)}else{throw SocialCalc.Constants.s_BrowserNotSupported}}return};SocialCalc.ProcessMouseWheel=function(g){var c=g||window.event;var h;if(SocialCalc.Keyboard.passThru){return}var a=SocialCalc.MouseWheelInfo;var d=c.target||c.srcElement;var b;for(b=null;!b&&d;d=d.parentNode){b=SocialCalc.LookupElement(d,a.registeredElements)}if(!b){return}if(c.wheelDelta){h=c.wheelDelta/120}else{h=-c.detail/3}if(!h){h=0}if(b.functionobj&&b.functionobj.WheelMove){b.functionobj.WheelMove(c,h,a,b)}if(c.preventDefault){c.preventDefault()}c.returnValue=false};SocialCalc.keyboardTables={specialKeysCommon:{8:"[backspace]",9:"[tab]",13:"[enter]",25:"[tab]",27:"[esc]",33:"[pgup]",34:"[pgdn]",35:"[end]",36:"[home]",37:"[aleft]",38:"[aup]",39:"[aright]",40:"[adown]",45:"[ins]",46:"[del]",113:"[f2]"},specialKeysIE:{8:"[backspace]",9:"[tab]",13:"[enter]",25:"[tab]",27:"[esc]",33:"[pgup]",34:"[pgdn]",35:"[end]",36:"[home]",37:"[aleft]",38:"[aup]",39:"[aright]",40:"[adown]",45:"[ins]",46:"[del]",113:"[f2]"},controlKeysIE:{67:"[ctrl-c]",83:"[ctrl-s]",86:"[ctrl-v]",88:"[ctrl-x]",90:"[ctrl-z]"},specialKeysOpera:{8:"[backspace]",9:"[tab]",13:"[enter]",25:"[tab]",27:"[esc]",33:"[pgup]",34:"[pgdn]",35:"[end]",36:"[home]",37:"[aleft]",38:"[aup]",39:"[aright]",40:"[adown]",45:"[ins]",46:"[del]",113:"[f2]"},controlKeysOpera:{67:"[ctrl-c]",83:"[ctrl-s]",86:"[ctrl-v]",88:"[ctrl-x]",90:"[ctrl-z]"},specialKeysSafari:{8:"[backspace]",9:"[tab]",13:"[enter]",25:"[tab]",27:"[esc]",63232:"[aup]",63233:"[adown]",63234:"[aleft]",63235:"[aright]",63272:"[del]",63273:"[home]",63275:"[end]",63276:"[pgup]",63277:"[pgdn]",63237:"[f2]"},controlKeysSafari:{99:"[ctrl-c]",115:"[ctrl-s]",118:"[ctrl-v]",120:"[ctrl-x]",122:"[ctrl-z]"},ignoreKeysSafari:{63236:"[f1]",63238:"[f3]",63239:"[f4]",63240:"[f5]",63241:"[f6]",63242:"[f7]",63243:"[f8]",63244:"[f9]",63245:"[f10]",63246:"[f11]",63247:"[f12]",63289:"[numlock]"},specialKeysFirefox:{8:"[backspace]",9:"[tab]",13:"[enter]",25:"[tab]",27:"[esc]",33:"[pgup]",34:"[pgdn]",35:"[end]",36:"[home]",37:"[aleft]",38:"[aup]",39:"[aright]",40:"[adown]",45:"[ins]",46:"[del]",113:"[f2]"},controlKeysFirefox:{99:"[ctrl-c]",115:"[ctrl-s]",118:"[ctrl-v]",120:"[ctrl-x]",122:"[ctrl-z]"},ignoreKeysFirefox:{16:"[shift]",17:"[ctrl]",18:"[alt]",20:"[capslock]",19:"[pause]",44:"[printscreen]",91:"[windows]",92:"[windows]",112:"[f1]",114:"[f3]",115:"[f4]",116:"[f5]",117:"[f6]",118:"[f7]",119:"[f8]",120:"[f9]",121:"[f10]",122:"[f11]",123:"[f12]",144:"[numlock]",145:"[scrolllock]",224:"[cmd]"}};SocialCalc.Keyboard={areListener:false,focusTable:null,passThru:null,didProcessKey:false,statusFromProcessKey:false,repeatingKeyPress:false,chForProcessKey:""};SocialCalc.KeyboardSetFocus=function(a){SocialCalc.Keyboard.focusTable=a;if(!SocialCalc.Keyboard.areListener){document.onkeydown=SocialCalc.ProcessKeyDown;document.onkeypress=SocialCalc.ProcessKeyPress;SocialCalc.Keyboard.areListener=true}if(SocialCalc.Keyboard.passThru){if(SocialCalc.Keyboard.passThru.blur){SocialCalc.Keyboard.passThru.blur()}SocialCalc.Keyboard.passThru=null}window.focus()};SocialCalc.KeyboardFocus=function(){SocialCalc.Keyboard.passThru=null;window.focus()};SocialCalc.ProcessKeyDown=function(c){var d=SocialCalc.keyboardTables;d.didProcessKey=false;d.statusFromProcessKey=false;d.repeatingKeyPress=false;var b="";var a=true;if(SocialCalc.Keyboard.passThru){return}c=c||window.event;if(c.which==undefined||(typeof c.keyIdentifier=="string")){b=d.specialKeysCommon[c.keyCode];if(!b){if(c.ctrlKey){b=d.controlKeysIE[c.keyCode]}if(!b){return true}}a=SocialCalc.ProcessKey(b,c);if(!a){if(c.preventDefault){c.preventDefault()}c.returnValue=false}}else{b=d.specialKeysCommon[c.keyCode];if(!b){if(c.ctrlKey||c.metaKey){b=d.controlKeysIE[c.keyCode]}if(!b){return true}}a=SocialCalc.ProcessKey(b,c);d.didProcessKey=true;d.statusFromProcessKey=a;d.chForProcessKey=b}return a};SocialCalc.ProcessKeyPress=function(c){var d=SocialCalc.keyboardTables;var b="";c=c||window.event;if(SocialCalc.Keyboard.passThru){return}if(d.didProcessKey){if(d.repeatingKeyPress){return SocialCalc.ProcessKey(d.chForProcessKey,c)}else{d.repeatingKeyPress=true;return d.statusFromProcessKey}}if(c.which==undefined){b=String.fromCharCode(c.keyCode)}else{if(!c.which){return false}if(c.charCode==undefined){if(c.which!=0){if(c.which<32||c.which==144){b=d.specialKeysOpera[c.which];if(b){return true}}else{if(c.ctrlKey){b=d.controlKeysOpera[c.keyCode]}else{b=String.fromCharCode(c.which)}}}else{return true}}else{if(c.keyCode==0&&c.charCode==0){return}else{if(c.keyCode==c.charCode){b=d.specialKeysSafari[c.keyCode];if(!b){if(d.ignoreKeysSafari[c.keyCode]){return true}if(c.metaKey){b=d.controlKeysSafari[c.keyCode]}else{b=String.fromCharCode(c.which)}}}else{if(d.specialKeysFirefox[c.keyCode]){return true}b=String.fromCharCode(c.which);if(c.ctrlKey||c.metaKey){b=d.controlKeysFirefox[c.which]}}}}}var a=SocialCalc.ProcessKey(b,c);if(!a){if(c.preventDefault){c.preventDefault()}c.returnValue=false}return a};SocialCalc.ProcessKey=function(a,b){var c=SocialCalc.Keyboard.focusTable;if(!c){return true}return c.EditorProcessKey(a,b)};