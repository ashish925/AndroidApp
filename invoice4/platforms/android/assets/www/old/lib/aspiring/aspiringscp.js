var SocialCalc;if(!SocialCalc){SocialCalc={}}SocialCalc.Popup={};SocialCalc.Popup.Types={};SocialCalc.Popup.Controls={};SocialCalc.Popup.Current={};SocialCalc.Popup.imagePrefix="images/sc-";SocialCalc.Popup.LocalizeString=function(a){return a};SocialCalc.Popup.Create=function(a,d,c){var b=SocialCalc.Popup.Types[a];if(b&&b.Create){b.Create(a,d,c)}};SocialCalc.Popup.SetValue=function(h,e){var d=SocialCalc.Popup;var g=d.Types;var c=d.Controls;if(!c[h]){alert("Unknown control "+h);return}var b=c[h].type;var f=g[b];var a=c[h].data;if(f&&f.Create){f.SetValue(b,h,e);if(a.attribs&&a.attribs.changedcallback){a.attribs.changedcallback(a.attribs,h,e)}}};SocialCalc.Popup.SetDisabled=function(g,c){var d=SocialCalc.Popup;var f=d.Types;var b=d.Controls;if(!b[g]){alert("Unknown control "+g);return}var a=b[g].type;var e=f[a];if(e&&e.Create){if(d.Current.id&&g==d.Current.id){e.Hide(a,d.Current.id);d.Current.id=null}e.SetDisabled(a,g,c)}};SocialCalc.Popup.GetValue=function(f){var c=SocialCalc.Popup;var e=c.Types;var b=c.Controls;if(!b[f]){alert("Unknown control "+f);return}var a=b[f].type;var d=e[a];if(d&&d.Create){return d.GetValue(a,f)}return null};SocialCalc.Popup.Initialize=function(g,d){var c=SocialCalc.Popup;var f=c.Types;var b=c.Controls;if(!b[g]){alert("Unknown control "+g);return}var a=b[g].type;var e=f[a];if(e&&e.Initialize){e.Initialize(a,g,d)}};SocialCalc.Popup.Reset=function(b){var c=SocialCalc.Popup;var d=c.Types;var a=c.Controls;if(d[b].Reset){d[b].Reset(b)}};SocialCalc.Popup.CClick=function(f){var c=SocialCalc.Popup;var e=c.Types;var b=c.Controls;if(!b[f]){alert("Unknown control "+f);return}if(b[f].data&&b[f].data.disabled){return}var a=b[f].type;var d=e[a];if(c.Current.id){e[b[c.Current.id].type].Hide(a,c.Current.id);if(f==c.Current.id){c.Current.id=null;return}}if(d&&d.Show){d.Show(a,f)}c.Current.id=f};SocialCalc.Popup.Close=function(){var b=SocialCalc.Popup;var c=b.Types;var a=b.Controls;if(!b.Current.id){return}b.CClick(b.Current.id)};SocialCalc.Popup.Cancel=function(){var c=SocialCalc.Popup;var e=c.Types;var b=c.Controls;if(!c.Current.id){return}var a=b[c.Current.id].type;var d=e[a];d.Cancel(a,c.Current.id);c.Current.id=null};SocialCalc.Popup.CreatePopupDiv=function(h,f){var g,e;var d=SocialCalc.Popup;var c=d.Controls;var b=c[h].data;var a=document.createElement("div");a.style.position="absolute";g=SocialCalc.GetElementPositionWithScroll(b.mainele);a.style.top=(g.top+b.mainele.offsetHeight)+"px";a.style.left=(g.left)+"px";a.style.zIndex=100;a.style.backgroundColor="#FFF";a.style.border="1px solid black";if(f.width){a.style.width=f.width}b.mainele.appendChild(a);if(f.title){a.innerHTML='<table cellspacing="0" cellpadding="0" style="border-bottom:1px solid black;"><tr><td style="font-size:10px;cursor:default;width:100%;background-color:#999;color:#FFF;">'+f.title+'</td><td style="font-size:10px;cursor:default;color:#666;" onclick="SocialCalc.Popup.Cancel();">&nbsp;X&nbsp;</td></tr></table>';if(f.moveable){b.dragregistered=a.firstChild.firstChild.firstChild.firstChild;SocialCalc.DragRegister(b.dragregistered,true,true,{MouseDown:SocialCalc.DragFunctionStart,MouseMove:SocialCalc.DragFunctionPosition,MouseUp:SocialCalc.DragFunctionPosition,Disabled:null,positionobj:a})}}return a};SocialCalc.Popup.EnsurePosition=function(e,a){var f=SocialCalc.Popup;var l=f.Controls;var k=l[e].data;var i=k.mainele.firstChild;if(!i){alert("No main popup element firstChild.");return}var b=k.popupele;function g(m){var c=SocialCalc.GetElementPositionWithScroll(m);c.height=m.offsetHeight;c.width=m.offsetWidth;c.bottom=c.top+c.height;c.right=c.left+c.width;return c}var d=g(b);var j=g(a);var h=g(i);var n=0;if(h.bottom+d.height<j.bottom&&h.left+d.width<j.right){b.style.top=h.bottom+"px";b.style.left=h.left+"px";n=1}else{if(h.top-d.height>j.top&&h.left+d.width<j.right){b.style.top=(h.top-d.height)+"px";b.style.left=h.left+"px";n=2}else{if(h.bottom+d.height<j.bottom&&h.right-d.width>j.left){b.style.top=h.bottom+"px";b.style.left=(h.right-d.width)+"px";n=3}else{if(h.top-d.height>j.top&&h.right-d.width>j.left){b.style.top=(h.top-d.height)+"px";b.style.left=(h.right-d.width)+"px";n=4}else{if(h.bottom+d.height<j.bottom&&d.width<j.width){b.style.top=h.bottom+"px";b.style.left=(j.left+Math.floor((j.width-d.width)/2))+"px";n=5}else{if(h.top-d.height>j.top&&d.width<j.width){b.style.top=(h.top-d.height)+"px";b.style.left=(j.left+Math.floor((j.width-d.width)/2))+"px";n=6}else{if(d.height<j.height&&h.right+d.width<j.right){b.style.top=(j.top+Math.floor((j.height-d.height)/2))+"px";b.style.left=h.right+"px";n=7}else{if(d.height<j.height&&h.left-d.width>j.left){b.style.top=(j.top+Math.floor((j.height-d.height)/2))+"px";b.style.left=(h.left-d.width)+"px";n=8}else{}}}}}}}}};SocialCalc.Popup.DestroyPopupDiv=function(a,b){if(!a){return}a.innerHTML="";SocialCalc.DragUnregister(b);if(a.parentNode){a.parentNode.removeChild(a)}};SocialCalc.Popup.RGBToHex=function(c){var b=SocialCalc.Popup;if(c==""){return"000000"}var a=c.match(/(\d+)\D+(\d+)\D+(\d+)/);if(a){return b.ToHex(a[1])+b.ToHex(a[2])+b.ToHex(a[3])}else{return"000000"}};SocialCalc.Popup.HexDigits="0123456789ABCDEF";SocialCalc.Popup.ToHex=function(b){var c=SocialCalc.Popup;var d=Math.floor(b/16);var a=b%16;return c.HexDigits.charAt(d)+c.HexDigits.charAt(a)};SocialCalc.Popup.FromHex=function(d){var b=SocialCalc.Popup;var c=b.HexDigits.indexOf(d.charAt(0).toUpperCase());var a=b.HexDigits.indexOf(d.charAt(1).toUpperCase());return((c>=0)?c:0)*16+((a>=0)?a:0)};SocialCalc.Popup.HexToRGB=function(b){var a=SocialCalc.Popup;return"rgb("+a.FromHex(b.substring(1,3))+","+a.FromHex(b.substring(3,5))+","+a.FromHex(b.substring(5,7))+")"};SocialCalc.Popup.makeRGB=function(d,c,a){return"rgb("+(d>0?d:0)+","+(c>0?c:0)+","+(a>0?a:0)+")"};SocialCalc.Popup.splitRGB=function(a){var b=a.match(/(\d+)\D+(\d+)\D+(\d+)\D/);if(!b){return{r:0,g:0,b:0}}else{return{r:b[1]-0,g:b[2]-0,b:b[3]-0}}};SocialCalc.Popup.Types.List={};SocialCalc.Popup.Types.List.Create=function(e,b,a){var c=SocialCalc.Popup;var i=c.Types;var g=c.Controls;var d={type:e,value:"",display:"",data:{}};if(g[b]){alert("Already created "+b);return}g[b]=d;var f=d.data;f.attribs=a||{};var h=document.getElementById(b);if(!h){alert("Missing element "+b);return}f.mainele=h;h.innerHTML='<input style="cursor:pointer;width:'+(f.attribs.inputWidth||"100px")+';font-size:smaller;" onfocus="this.blur();" onclick="SocialCalc.Popup.CClick(\''+b+'\');" value="">';f.options=[]};SocialCalc.Popup.Types.List.SetValue=function(d,h,f){var b;var e=SocialCalc.Popup;var g=e.Types;var c=e.Controls;var a=c[h].data;a.value=f;a.custom=false;for(b=0;b<a.options.length;b++){o=a.options[b];if(o.a){if(o.a.skip||o.a.custom||o.a.cancel){continue}}if(o.v==a.value){a.display=o.o;break}}if(b==a.options.length){a.display="Custom";a.custom=true}if(a.mainele&&a.mainele.firstChild){a.mainele.firstChild.value=a.display}};SocialCalc.Popup.Types.List.SetDisabled=function(e,h,d){var b;var f=SocialCalc.Popup;var g=f.Types;var c=f.Controls;var a=c[h].data;a.disabled=d;if(a.mainele&&a.mainele.firstChild){a.mainele.firstChild.disabled=d}};SocialCalc.Popup.Types.List.GetValue=function(c,f){var d=SocialCalc.Popup;var e=d.Types;var b=d.Controls;var a=b[f].data;return a.value};SocialCalc.Popup.Types.List.Initialize=function(e,i,g){var b;var f=SocialCalc.Popup;var h=f.Types;var d=f.Controls;var c=d[i].data;for(b in g.attribs){c.attribs[b]=g.attribs[b]}c.options=g?g.options:[];if(g.value){f.SetValue(i,g.value)}};SocialCalc.Popup.Types.List.Reset=function(b){var c=SocialCalc.Popup;var d=c.Types;var a=c.Controls;if(c.Current.id&&a[c.Current.id].type==b){d[b].Hide(b,c.Current.id);c.Current.id=null}};SocialCalc.Popup.Types.List.Show=function(h,a){var d,l,c,e;var b=SocialCalc.Popup;var k=b.Types;var j=b.Controls;var g=j[a].data;var f="";g.popupele=b.CreatePopupDiv(a,g.attribs);if(g.custom){f=SocialCalc.Popup.Types.List.MakeCustom(h,a);l=document.createElement("div");l.innerHTML='<div style="cursor:default;padding:4px;background-color:#CCC;">'+f+"</div>";g.customele=l.firstChild.firstChild.childNodes[1];g.listdiv=null;g.contentele=l}else{f=SocialCalc.Popup.Types.List.MakeList(h,a);l=document.createElement("div");l.innerHTML='<div style="cursor:default;padding:4px;">'+f+"</div>";g.customele=null;g.listdiv=l.firstChild;g.contentele=l}if(g.mainele&&g.mainele.firstChild){g.mainele.firstChild.disabled=true}g.popupele.appendChild(l);if(g.attribs.ensureWithin){SocialCalc.Popup.EnsurePosition(a,g.attribs.ensureWithin)}};SocialCalc.Popup.Types.List.MakeList=function(j,a){var e,m,c,f;var b=SocialCalc.Popup;var l=b.Types;var k=b.Controls;var h=k[a].data;var g='<table cellspacing="0" cellpadding="0"><tr>';var d='<td style="vertical-align:top;">';g+=d;h.ncols=1;for(e=0;e<h.options.length;e++){c=h.options[e];if(c.a){if(c.a.newcol){g+="</td>"+d+"&nbsp;&nbsp;&nbsp;&nbsp;</td>"+d;h.ncols+=1;continue}if(c.a.skip){g+='<div style="font-size:x-small;white-space:nowrap;">'+c.o+"</div>";continue}}if(c.v==h.value&&!(c.a&&(c.a.custom||c.a.cancel))){f="background-color:#DDF;"}else{f=""}g+='<div style="font-size:x-small;white-space:nowrap;'+f+'" onclick="SocialCalc.Popup.Types.List.ItemClicked(\''+a+"','"+e+"');\" onmousemove=\"SocialCalc.Popup.Types.List.MouseMove('"+a+"',this);\">"+c.o+"</div>"}g+="</td></tr></table>";return g};SocialCalc.Popup.Types.List.MakeCustom=function(l,b){var h=SocialCalc.Popup.LocalizeString;var f,p,d,g;var c=SocialCalc.Popup;var n=c.Types;var m=c.Controls;var k=m[b].data;var a='style="font-size:smaller;"';var j="";var e=k.value;e=SocialCalc.special_chars(e);j='<div style="white-space:nowrap;"><br><input id="customvalue" value="'+e+'"><br><br><input '+a+' type="button" value="'+h("OK")+'" onclick="SocialCalc.Popup.Types.List.CustomOK(\''+b+"');return false;\"><input "+a+' type="button" value="'+h("List")+'" onclick="SocialCalc.Popup.Types.List.CustomToList(\''+b+"');\"><input "+a+' type="button" value="'+h("Cancel")+'" onclick="SocialCalc.Popup.Close();"><br></div>';return j};SocialCalc.Popup.Types.List.ItemClicked=function(c,f){var b,h,e;var d=SocialCalc.Popup;var k=d.Types;var i=d.Controls;var g=i[c].data;var j=g.options[f].a;if(j&&j.custom){b=g.contentele;h=SocialCalc.Popup.Types.List.MakeCustom("List",c);e=document.createElement("div");e.innerHTML='<div style="cursor:default;padding:4px;background-color:#CCC;">'+h+"</div>";g.customele=e.firstChild.firstChild.childNodes[1];g.listdiv=null;g.contentele=e;g.popupele.replaceChild(e,b);if(g.attribs.ensureWithin){SocialCalc.Popup.EnsurePosition(c,g.attribs.ensureWithin)}return}if(j&&j.cancel){SocialCalc.Popup.Close();return}SocialCalc.Popup.SetValue(c,g.options[f].v);SocialCalc.Popup.Close()};SocialCalc.Popup.Types.List.CustomToList=function(h){var b,f,e;var d=SocialCalc.Popup;var g=d.Types;var c=d.Controls;var a=c[h].data;b=a.contentele;f=SocialCalc.Popup.Types.List.MakeList("List",h);e=document.createElement("div");e.innerHTML='<div style="cursor:default;padding:4px;">'+f+"</div>";a.customele=null;a.listdiv=e.firstChild;a.contentele=e;a.popupele.replaceChild(e,b);if(a.attribs.ensureWithin){SocialCalc.Popup.EnsurePosition(h,a.attribs.ensureWithin)}};SocialCalc.Popup.Types.List.CustomOK=function(h){var b,g;var e=SocialCalc.Popup;var f=e.Types;var d=e.Controls;var a=d[h].data;SocialCalc.Popup.SetValue(h,a.customele.value);SocialCalc.Popup.Close()};SocialCalc.Popup.Types.List.MouseMove=function(a,m){var d,f,j;var b=SocialCalc.Popup;var l=b.Types;var k=b.Controls;var h=k[a].data;var g=h.listdiv;if(!g){return}var e=g.firstChild.firstChild.firstChild;for(d=0;d<h.ncols;d++){for(f=0;f<e.childNodes[d*2].childNodes.length;f++){e.childNodes[d*2].childNodes[f].style.backgroundColor="#FFF"}}m.style.backgroundColor="#DDF"};SocialCalc.Popup.Types.List.Hide=function(c,f){var d=SocialCalc.Popup;var e=d.Types;var b=d.Controls;var a=b[f].data;d.DestroyPopupDiv(a.popupele,a.dragregistered);a.popupele=null;if(a.mainele&&a.mainele.firstChild){a.mainele.firstChild.disabled=false}};SocialCalc.Popup.Types.List.Cancel=function(a,b){SocialCalc.Popup.Types.List.Hide(a,b)};SocialCalc.Popup.Types.ColorChooser={};SocialCalc.Popup.Types.ColorChooser.Create=function(f,b,a){var c=SocialCalc.Popup;var j=c.Types;var h=c.Controls;var d={type:f,value:"",display:"",data:{}};if(h[b]){alert("Already created "+b);return}h[b]=d;var g=d.data;g.attribs=a||{};var e=g.attribs;g.value="";var i=document.getElementById(b);if(!i){alert("Missing element "+b);return}g.mainele=i;i.innerHTML='<div style="cursor:pointer;border:1px solid black;vertical-align:top;width:'+(e.sampleWidth||"15px")+";height:"+(e.sampleHeight||"15px")+';" onclick="SocialCalc.Popup.Types.ColorChooser.ControlClicked(\''+b+"');\">&nbsp;</div>"};SocialCalc.Popup.Types.ColorChooser.SetValue=function(g,a,k){var c,d,j;var b=SocialCalc.Popup;var l=b.Types;var h=b.Controls;var f=h[a].data;var e=f.attribs;f.value=k;f.custom=false;if(f.mainele&&f.mainele.firstChild){if(f.value){f.mainele.firstChild.style.backgroundColor=f.value;if(e.backgroundImage){d="url("+b.imagePrefix+e.backgroundImage+")"}else{d=""}j="center center"}else{f.mainele.firstChild.style.backgroundColor="#FFF";if(e.backgroundImageDefault){d="url("+b.imagePrefix+e.backgroundImageDefault+")";j="center center"}else{d="url("+b.imagePrefix+"defaultcolor.gif)";j="left top"}}f.mainele.firstChild.style.backgroundPosition=j;f.mainele.firstChild.style.backgroundImage=d}};SocialCalc.Popup.Types.ColorChooser.SetDisabled=function(f,a,c){var d;var b=SocialCalc.Popup;var j=b.Types;var h=b.Controls;var g=h[a].data;var e=g.attribs;g.disabled=c;if(g.mainele&&g.mainele.firstChild){if(c){g.mainele.firstChild.style.backgroundColor="#DDD";if(e.backgroundImageDisabled){img="url("+b.imagePrefix+e.backgroundImageDisabled+")";pos="center center"}else{img="url("+b.imagePrefix+"defaultcolor.gif)";pos="left top"}g.mainele.firstChild.style.backgroundPosition=pos;g.mainele.firstChild.style.backgroundImage=img}else{b.SetValue(a,g.value)}}};SocialCalc.Popup.Types.ColorChooser.GetValue=function(c,f){var d=SocialCalc.Popup;var e=d.Types;var b=d.Controls;var a=b[f].data;return a.value};SocialCalc.Popup.Types.ColorChooser.Initialize=function(e,i,g){var b;var f=SocialCalc.Popup;var h=f.Types;var d=f.Controls;var c=d[i].data;for(b in g.attribs){c.attribs[b]=g.attribs[b]}if(g.value){f.SetValue(i,g.value)}};SocialCalc.Popup.Types.ColorChooser.Reset=function(b){var c=SocialCalc.Popup;var d=c.Types;var a=c.Controls;if(c.Current.id&&a[c.Current.id].type==b){d[b].Hide(b,c.Current.id);c.Current.id=null}};SocialCalc.Popup.Types.ColorChooser.Show=function(g,b){var d,k,a;var c=SocialCalc.Popup;var j=c.Types;var h=c.Controls;var f=h[b].data;var e="";f.oldvalue=f.value;f.popupele=c.CreatePopupDiv(b,f.attribs);if(f.custom){e=SocialCalc.Popup.Types.ColorChooser.MakeCustom(g,b);k=document.createElement("div");k.innerHTML='<div style="cursor:default;padding:4px;background-color:#CCC;">'+e+"</div>";f.customele=k.firstChild.firstChild.childNodes[2];f.contentele=k}else{a=SocialCalc.Popup.Types.ColorChooser.CreateGrid(g,b);k=document.createElement("div");k.style.padding="3px";k.style.backgroundColor="#CCC";k.appendChild(a);f.customele=null;f.contentele=k}f.popupele.appendChild(k);if(f.attribs.ensureWithin){SocialCalc.Popup.EnsurePosition(b,f.attribs.ensureWithin)}};SocialCalc.Popup.Types.ColorChooser.MakeCustom=function(k,b){var e,n,d,f;var c=SocialCalc.Popup;var m=c.Types;var l=c.Controls;var j=l[b].data;var g=c.LocalizeString;var a='style="font-size:smaller;"';var h="";h='<div style="white-space:nowrap;"><br>#<input id="customvalue" style="width:75px;" value="'+j.value+'"><br><br><input '+a+' type="button" value="'+g("OK")+'" onclick="SocialCalc.Popup.Types.ColorChooser.CustomOK(\''+b+"');return false;\"><input "+a+' type="button" value="'+g("Grid")+'" onclick="SocialCalc.Popup.Types.ColorChooser.CustomToGrid(\''+b+"');\"><br></div>";return h};SocialCalc.Popup.Types.ColorChooser.ItemClicked=function(b,e){var a,g,d;var c=SocialCalc.Popup;var i=c.Types;var h=c.Controls;var f=h[b].data;SocialCalc.Popup.Close()};SocialCalc.Popup.Types.ColorChooser.CustomToList=function(h){var b,f,e;var d=SocialCalc.Popup;var g=d.Types;var c=d.Controls;var a=c[h].data};SocialCalc.Popup.Types.ColorChooser.CustomOK=function(h){var b,g;var e=SocialCalc.Popup;var f=e.Types;var d=e.Controls;var a=d[h].data;e.SetValue(h,a.customele.value);e.Close()};SocialCalc.Popup.Types.ColorChooser.Hide=function(c,f){var d=SocialCalc.Popup;var e=d.Types;var b=d.Controls;var a=b[f].data;d.DestroyPopupDiv(a.popupele,a.dragregistered);a.popupele=null};SocialCalc.Popup.Types.ColorChooser.Cancel=function(c,f){var d=SocialCalc.Popup;var e=d.Types;var b=d.Controls;var a=b[f].data;d.SetValue(f,a.oldvalue);SocialCalc.Popup.Types.ColorChooser.Hide(c,f)};SocialCalc.Popup.Types.ColorChooser.CreateGrid=function(k,d){var q,m,p,f,e,i;var c=SocialCalc.Popup;var n=c.Types;var l=c.Controls;var h=c.LocalizeString;var j=l[d].data;j.grid={};var a=j.grid;var b=document.createElement("div");q=document.createElement("table");q.cellSpacing=0;q.cellPadding=0;q.style.width="100px";a.table=q;q=document.createElement("tbody");a.table.appendChild(q);a.tbody=q;for(p=0;p<16;p++){f=document.createElement("tr");for(e=0;e<5;e++){i={};a[p+","+e]=i;q=document.createElement("td");q.style.fontSize="1px";q.innerHTML="&nbsp;";q.style.height="10px";if(e<=1){q.style.width="17px";q.style.borderRight="3px solid white"}else{q.style.width="20px";q.style.backgroundRepeat="no-repeat"}f.appendChild(q);i.ele=q}a.tbody.appendChild(f)}b.appendChild(a.table);q=document.createElement("div");q.style.marginTop="3px";q.innerHTML='<table cellspacing="0" cellpadding="0"><tr><td style="width:17px;background-color:#FFF;background-image:url('+c.imagePrefix+'defaultcolor.gif);height:16px;font-size:10px;cursor:pointer;" title="'+h("Default")+'">&nbsp;</td><td style="width:23px;height:16px;font-size:10px;text-align:center;cursor:pointer;" title="'+h("Custom")+'">#</td><td style="width:60px;height:16px;font-size:10px;text-align:center;cursor:pointer;">'+h("OK")+"</td></tr></table>";a.defaultbox=q.firstChild.firstChild.firstChild.childNodes[0];a.defaultbox.onclick=n.ColorChooser.DefaultClicked;a.custom=q.firstChild.firstChild.firstChild.childNodes[1];a.custom.onclick=n.ColorChooser.CustomClicked;a.msg=q.firstChild.firstChild.firstChild.childNodes[2];a.msg.onclick=n.ColorChooser.CloseOK;b.appendChild(q);a.table.onmousedown=n.ColorChooser.GridMouseDown;n.ColorChooser.DetermineColors(d);n.ColorChooser.SetColors(d);return b};SocialCalc.Popup.Types.ColorChooser.gridToG=function(b,c,a){return b[c+","+a]};SocialCalc.Popup.Types.ColorChooser.DetermineColors=function(b){var c=SocialCalc.Popup;var n=c.Types;var g=n.ColorChooser;var j=c.Controls;var h=j[b].data;var a=h.grid;var d,m;var f=c.splitRGB(h.value);var e;d=2;m=16-Math.floor((f.r+16)/16);a["selectedrow"+d]=m;for(m=0;m<16;m++){g.gridToG(a,m,d).rgb=c.makeRGB(17*(15-m),0,0)}d=3;m=16-Math.floor((f.g+16)/16);a["selectedrow"+d]=m;for(m=0;m<16;m++){g.gridToG(a,m,d).rgb=c.makeRGB(0,17*(15-m),0)}d=4;m=16-Math.floor((f.b+16)/16);a["selectedrow"+d]=m;for(m=0;m<16;m++){g.gridToG(a,m,d).rgb=c.makeRGB(0,0,17*(15-m))}d=1;for(m=0;m<16;m++){g.gridToG(a,m,d).rgb=c.makeRGB(17*(15-m),17*(15-m),17*(15-m))}d=0;var i=[0,68,153,204,255];var l=["400","310","420","440","442","340","040","042","032","044","024","004","204","314","402","414"];var k;for(m=0;m<16;m++){k=l[m];g.gridToG(a,m,d).rgb="rgb("+i[k.charAt(0)-0]+","+i[k.charAt(1)-0]+","+i[k.charAt(2)-0]+")"}};SocialCalc.Popup.Types.ColorChooser.SetColors=function(b){var l,d,e,m,i;var c=SocialCalc.Popup;var k=c.Types;var h=k.ColorChooser;var j=c.Controls;var f=j[b].data;var a=f.grid;for(l=0;l<16;l++){for(d=0;d<5;d++){e=h.gridToG(a,l,d);e.ele.style.backgroundColor=e.rgb;e.ele.title=c.RGBToHex(e.rgb);if(a["selectedrow"+d]==l){e.ele.style.backgroundImage="url("+c.imagePrefix+"chooserarrow.gif)"}else{e.ele.style.backgroundImage=""}}}c.SetValue(b,f.value);a.msg.style.backgroundColor=f.value;i=c.splitRGB(f.value||"rgb(255,255,255)");if(i.r+i.g+i.b<220){a.msg.style.color="#FFF"}else{a.msg.style.color="#000"}if(!f.value){a.msg.style.backgroundColor="#FFF";a.msg.style.backgroundImage="url("+c.imagePrefix+"defaultcolor.gif)";a.msg.title="Default"}else{a.msg.style.backgroundImage="";a.msg.title=c.RGBToHex(f.value)}};SocialCalc.Popup.Types.ColorChooser.GridMouseDown=function(s){var q=s||window.event;var r=SocialCalc.Popup;var d=r.Types;var h=d.ColorChooser;var m=r.Controls;var j=r.Current.id;if(!j){return}var g=m[j].data;var a=g.grid;switch(q.type){case"mousedown":a.mousedown=true;break;case"mouseup":a.mousedown=false;break;case"mousemove":if(!a.mousedown){return}break}var t=SocialCalc.GetViewportInfo();var n=q.clientX+t.horizontalScroll;var k=q.clientY+t.verticalScroll;var l=SocialCalc.GetElementPosition(a.table);var f=Math.floor((k-l.top-2)/10);f=f<0?0:f;var c=Math.floor((n-l.left)/20);f=f<0?0:(f>15?15:f);c=c<0?0:(c>4?4:c);var p=h.gridToG(a,f,c).ele.style.backgroundColor;var i=r.splitRGB(p);var b=r.splitRGB(g.value);switch(c){case 2:g.value=r.makeRGB(i.r,b.g,b.b);break;case 3:g.value=r.makeRGB(b.r,i.g,b.b);break;case 4:g.value=r.makeRGB(b.r,b.g,i.b);break;case 0:case 1:g.value=p}h.DetermineColors(j);h.SetColors(j)};SocialCalc.Popup.Types.ColorChooser.ControlClicked=function(f){var b=SocialCalc.Popup;var e=b.Types;var d=e.ColorChooser;var a=b.Controls;var c=b.Current.id;if(!c||f!=c){b.CClick(f);return}d.CloseOK()};SocialCalc.Popup.Types.ColorChooser.DefaultClicked=function(f){var c=f||window.event;var d=SocialCalc.Popup;var i=d.Types;var h=i.ColorChooser;var b=d.Controls;var g=d.Current.id;if(!g){return}var a=b[g].data;a.value="";SocialCalc.Popup.SetValue(g,a.value);SocialCalc.Popup.Close()};SocialCalc.Popup.Types.ColorChooser.CustomClicked=function(g){var b=g||window.event;var d=SocialCalc.Popup;var l=d.Types;var i=l.ColorChooser;var k=d.Controls;var c=d.Current.id;if(!c){return}var j=k[c].data;var a,h,f;a=j.contentele;h=SocialCalc.Popup.Types.ColorChooser.MakeCustom("ColorChooser",c);f=document.createElement("div");f.innerHTML='<div style="cursor:default;padding:4px;background-color:#CCC;">'+h+"</div>";j.customele=f.firstChild.firstChild.childNodes[2];j.contentele=f;j.popupele.replaceChild(f,a);j.customele.value=d.RGBToHex(j.value);if(j.attribs.ensureWithin){SocialCalc.Popup.EnsurePosition(c,j.attribs.ensureWithin)}};SocialCalc.Popup.Types.ColorChooser.CustomToGrid=function(c){var a,f,e;var d=SocialCalc.Popup;var i=d.Types;var h=d.Controls;var g=h[c].data;SocialCalc.Popup.SetValue(c,d.HexToRGB("#"+g.customele.value));var a,b,e;a=g.contentele;b=SocialCalc.Popup.Types.ColorChooser.CreateGrid("ColorChooser",c);e=document.createElement("div");e.style.padding="3px";e.style.backgroundColor="#CCC";e.appendChild(b);g.customele=null;g.contentele=e;g.popupele.replaceChild(e,a);if(g.attribs.ensureWithin){SocialCalc.Popup.EnsurePosition(c,g.attribs.ensureWithin)}};SocialCalc.Popup.Types.ColorChooser.CustomOK=function(h){var b,g;var e=SocialCalc.Popup;var f=e.Types;var d=e.Controls;var a=d[h].data;SocialCalc.Popup.SetValue(h,e.HexToRGB("#"+a.customele.value));SocialCalc.Popup.Close()};SocialCalc.Popup.Types.ColorChooser.CloseOK=function(f){var c=f||window.event;var d=SocialCalc.Popup;var i=d.Types;var h=i.ColorChooser;var b=d.Controls;var g=d.Current.id;if(!g){return}var a=b[g].data;SocialCalc.Popup.SetValue(g,a.value);SocialCalc.Popup.Close()};